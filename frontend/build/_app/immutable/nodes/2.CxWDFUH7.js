import{s as Ce,n as we,r as Pe,e as he,o as Ie,a as xe,f as M,h as et,b as Ee}from"../chunks/scheduler.CTimOCLo.js";import{S as Re,i as Ae,g as f,s as F,h as g,j as R,c as V,y as de,f as m,k as d,l as se,a as ne,x as l,z as ge,A as ie,B as $e,C as tt,m as ee,n as te,o as ae,r as Fe,u as Ve,v as Le,d as Ye,t as He,w as qe,e as Me}from"../chunks/index.CRnmY6F2.js";import{w as Ne}from"../chunks/index.BXnrS5-F.js";import{_ as nt}from"../chunks/preload-helper.CRk0x-X1.js";function ze(o){return o?.length!==void 0?o:Array.from(o)}const ot={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},st={id:null,name:"",room:null,player:null},le=Ne(ot),ce=Ne(st),$=Ne("idle");function Je(o,t,s){const e=o.slice();return e[23]=t[s],e}function Xe(o){let t,s,e;return{c(){t=f("div"),s=f("p"),e=ee(o[4]),this.h()},l(n){t=g(n,"DIV",{class:!0});var p=R(t);s=g(p,"P",{});var c=R(s);e=te(c,o[4]),c.forEach(m),p.forEach(m),this.h()},h(){d(t,"class","error-message svelte-18y7b0k")},m(n,p){ne(n,t,p),l(t,s),l(s,e)},p(n,p){p&16&&ae(e,n[4])},d(n){n&&m(t)}}}function Ge(o){let t,s,e,n,p=o[23].name+"",c,v,P,E,A=Math.abs(o[23].ballSpeedX)+"",h,u,b,L=Object.keys(o[23].gameState.players).length+"",T,_,j,B,w,D="JOIN",Y,C,U;function y(){return o[12](o[23])}return{c(){t=f("div"),s=f("div"),e=f("div"),n=f("span"),c=ee(p),v=F(),P=f("span"),E=ee("Ball speed : "),h=ee(A),u=F(),b=f("span"),T=ee(L),_=ee("/2 Players"),j=F(),B=f("div"),w=f("button"),w.textContent=D,Y=F(),this.h()},l(k){t=g(k,"DIV",{class:!0});var r=R(t);s=g(r,"DIV",{class:!0});var a=R(s);e=g(a,"DIV",{class:!0});var I=R(e);n=g(I,"SPAN",{});var O=R(n);c=te(O,p),O.forEach(m),I.forEach(m),v=V(a),P=g(a,"SPAN",{class:!0});var H=R(P);E=te(H,"Ball speed : "),h=te(H,A),H.forEach(m),u=V(a),b=g(a,"SPAN",{class:!0});var z=R(b);T=te(z,L),_=te(z,"/2 Players"),z.forEach(m),a.forEach(m),j=V(r),B=g(r,"DIV",{class:!0});var x=R(B);w=g(x,"BUTTON",{class:!0,"data-svelte-h":!0}),de(w)!=="svelte-120grqu"&&(w.textContent=D),x.forEach(m),Y=V(r),r.forEach(m),this.h()},h(){d(e,"class","room__name svelte-18y7b0k"),d(P,"class","room__detail svelte-18y7b0k"),d(b,"class","room__detail svelte-18y7b0k"),d(s,"class","room__info svelte-18y7b0k"),d(w,"class","button svelte-18y7b0k"),d(B,"class","room__actions"),d(t,"class","room svelte-18y7b0k")},m(k,r){ne(k,t,r),l(t,s),l(s,e),l(e,n),l(n,c),l(s,v),l(s,P),l(P,E),l(P,h),l(s,u),l(s,b),l(b,T),l(b,_),l(t,j),l(t,B),l(B,w),l(t,Y),C||(U=ie(w,"click",y),C=!0)},p(k,r){o=k,r&1&&p!==(p=o[23].name+"")&&ae(c,p),r&1&&A!==(A=Math.abs(o[23].ballSpeedX)+"")&&ae(h,A),r&1&&L!==(L=Object.keys(o[23].gameState.players).length+"")&&ae(T,L)},d(k){k&&m(t),C=!1,U()}}}function rt(o){let t,s,e,n="PONG",p,c,v,P,E,A="rename user",h,u,b,L,T,_,j,B,w,D,Y,C="Create Room",U,y,k,r="Refresh",a,I,O="",H,z,x,i,N="s",q,J,K=o[4]&&Xe(o),ue=ze(o[0]),Q=[];for(let S=0;S<ue.length;S+=1)Q[S]=Ge(Je(o,ue,S));return{c(){t=f("div"),K&&K.c(),s=F(),e=f("h1"),e.textContent=n,p=F(),c=f("div"),v=f("input"),P=F(),E=f("button"),E.textContent=A,h=F(),u=f("br"),b=F(),L=f("br"),T=F(),_=f("input"),j=F(),B=f("span"),w=f("input"),D=F(),Y=f("button"),Y.textContent=C,U=F(),y=f("p"),k=f("button"),k.textContent=r,a=F(),I=f("div"),I.innerHTML=O,H=F(),z=f("div");for(let S=0;S<Q.length;S+=1)Q[S].c();x=F(),i=f("p"),i.textContent=N,this.h()},l(S){t=g(S,"DIV",{class:!0});var X=R(t);K&&K.l(X),s=V(X),e=g(X,"H1",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1jnr5i3"&&(e.textContent=n),p=V(X),c=g(X,"DIV",{class:!0,style:!0});var W=R(c);v=g(W,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),P=V(W),E=g(W,"BUTTON",{class:!0,"data-svelte-h":!0}),de(E)!=="svelte-5cerf9"&&(E.textContent=A),h=V(W),u=g(W,"BR",{}),b=V(W),L=g(W,"BR",{}),T=V(W),_=g(W,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),j=V(W),B=g(W,"SPAN",{});var re=R(B);w=g(re,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),D=V(re),Y=g(re,"BUTTON",{class:!0,"data-svelte-h":!0}),de(Y)!=="svelte-136z9rb"&&(Y.textContent=C),re.forEach(m),W.forEach(m),U=V(X),y=g(X,"P",{});var oe=R(y);k=g(oe,"BUTTON",{class:!0,"data-svelte-h":!0}),de(k)!=="svelte-s4sqy4"&&(k.textContent=r),oe.forEach(m),a=V(X),I=g(X,"DIV",{class:!0,"data-svelte-h":!0}),de(I)!=="svelte-1hf6hku"&&(I.innerHTML=O),H=V(X),z=g(X,"DIV",{class:!0});var pe=R(z);for(let fe=0;fe<Q.length;fe+=1)Q[fe].l(pe);pe.forEach(m),X.forEach(m),x=V(S),i=g(S,"P",{style:!0,"data-svelte-h":!0}),de(i)!=="svelte-1fb4tdl"&&(i.textContent=N),this.h()},h(){d(e,"class","card__title svelte-18y7b0k"),d(v,"type","text"),d(v,"placeholder","New nickname"),d(v,"maxlength","20"),d(v,"class","svelte-18y7b0k"),d(E,"class","button-small svelte-18y7b0k"),d(_,"type","text"),_.required=!0,d(_,"placeholder","Enter room name"),d(_,"maxlength","20"),d(_,"class","svelte-18y7b0k"),d(w,"type","number"),d(w,"min","0"),d(w,"max","100"),w.required=!0,d(w,"placeholder","Ball speed"),se(w,"width","100px"),se(w,"margin-left","0"),se(w,"margin-right","10px"),d(w,"class","svelte-18y7b0k"),d(Y,"class","button-small svelte-18y7b0k"),d(c,"class","room svelte-18y7b0k"),se(c,"display","block"),d(k,"class","button svelte-18y7b0k"),d(I,"class","card__header svelte-18y7b0k"),d(z,"class","room-list svelte-18y7b0k"),d(t,"class","card svelte-18y7b0k"),se(i,"color","white")},m(S,X){ne(S,t,X),K&&K.m(t,null),l(t,s),l(t,e),l(t,p),l(t,c),l(c,v),ge(v,o[3]),l(c,P),l(c,E),l(c,h),l(c,u),l(c,b),l(c,L),l(c,T),l(c,_),ge(_,o[1]),l(c,j),l(c,B),l(B,w),ge(w,o[2]),l(B,D),l(B,Y),l(t,U),l(t,y),l(y,k),l(t,a),l(t,I),l(t,H),l(t,z);for(let W=0;W<Q.length;W+=1)Q[W]&&Q[W].m(z,null);ne(S,x,X),ne(S,i,X),q||(J=[ie(v,"input",o[9]),ie(E,"click",o[8]),ie(_,"input",o[10]),ie(w,"input",o[11]),ie(Y,"click",o[6]),ie(k,"click",o[5])],q=!0)},p(S,[X]){if(S[4]?K?K.p(S,X):(K=Xe(S),K.c(),K.m(t,s)):K&&(K.d(1),K=null),X&8&&v.value!==S[3]&&ge(v,S[3]),X&2&&_.value!==S[1]&&ge(_,S[1]),X&4&&$e(w.value)!==S[2]&&ge(w,S[2]),X&129){ue=ze(S[0]);let W;for(W=0;W<ue.length;W+=1){const re=Je(S,ue,W);Q[W]?Q[W].p(re,X):(Q[W]=Ge(re),Q[W].c(),Q[W].m(z,null))}for(;W<Q.length;W+=1)Q[W].d(1);Q.length=ue.length}},i:we,o:we,d(S){S&&(m(t),m(x),m(i)),K&&K.d(),tt(Q,S),q=!1,Pe(J)}}}function lt(o,t,s){let e,n,p;he(o,ce,y=>s(14,e=y)),he(o,$,y=>s(15,n=y)),he(o,le,y=>s(16,p=y));const v=window.location.origin;let P=[],E="",A,h=e?.name??"",u="",b;Ie(()=>{console.log("Rooms page mounted"),$.subscribe(y=>{console.log("State changed",y),(y=p.connected)&&(console.log("User",e),e.room?e.room?.id?j(e.room):j({id:e.room}):L())})}),xe(()=>{u&&(clearTimeout(b),b=setTimeout(()=>{s(4,u="")},3e3))});async function L(){const k=await(await fetch(`${v}/list_room`)).json();console.log("resJson",k),k.status=="success"?k.rooms?s(0,P=k.rooms):(console.error("Failed to get rooms",k),s(4,u="Failed to get rooms")):(console.error("Failed to get rooms",k),s(4,u=k.message??"Failed to get rooms")),console.log("got rooms",P)}function T(){L()}async function _(){if(!E||!A){console.error("Room name and ball speed are required"),s(4,u="Room name and ball speed are required");return}const y={name:E,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:A,ballSpeedY:A},k=`${v}/create_room`;console.log("Creating room...",k,y),await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).then(r=>r.json()).then(r=>{console.log("create room",r),r.status=="success"&&r.room?.id?(console.log("Room created successfully, joining...",r.room),j(r.room)):(console.error("Failed to create room",r.message),s(4,u=r.message??"Failed to create room"))}).catch(r=>{console.error("Failed to create room",r),s(4,u=r.message??"Failed to create room")}),console.log("Room created successfully"),L()}async function j(y){console.log("Joining room...",y.id);const k=`${v}/join_room`,r={room_id:y.id,user_id:e.id};await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(a=>a.json()).then(a=>{console.log("joining room",a),a.status=="success"&&a.room?.id&&a.user?.id?(console.log("Joined room successfully"),M(ce,e=a.user,e),M(ce,e.room=a.room,e),console.log("User",e),B(y)):(console.error("Failed to join room",a),M(ce,e.room=null,e),s(4,u=a.message??"Failed to join room"),L())}).catch(a=>{console.error("Failed to join room",a),s(4,u=a.message??"Failed to join room")})}function B(y){console.log("Playing room...",y),M($,n="play",n)}function w(){if(!h){console.error("Nickname is required"),s(4,u="Nickname is required");return}console.log("Renaming room...",E);const y=`${v}/login`,k={id:e.id,name:h};fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}).then(r=>r.json()).then(r=>{console.log("rename user",r),r.status=="success"&&r.user?.id?(console.log("User renamed successfully"),M(ce,e=r.user,e)):(console.error("Failed to rename user",r),s(4,u=r.message??"Failed to rename user"))}).catch(r=>{console.error("Failed to rename user",r),s(4,u=r.message??"Failed to rename user")})}function D(){h=this.value,s(3,h)}function Y(){E=this.value,s(1,E)}function C(){A=$e(this.value),s(2,A)}return[P,E,A,h,u,T,_,j,w,D,Y,C,y=>j(y)]}class it extends Re{constructor(t){super(),Ae(this,t,lt,rt,Ce,{})}}new TextEncoder;function at(o){let t,s,e,n,p=o[4]?.players?.[o[4]?.p0index]?.user?.name+"",c,v,P,E,A=o[4]?.players?.[o[4]?.p0index]?.wins+"",h,u,b,L="PONG",T,_,j,B=(o[4]?.players?.[o[4]?.p1index]?.user?.name??"...")+"",w,D,Y,C,U=(o[4]?.players?.[o[4]?.p1index]?.wins??0)+"",y,k,r,a,I,O,H,z,x=o[4]?.isRunning?"pause":"start",i,N,q,J=o[2]?"hide":"show",K,ue,Q,S,X="leave",W,re,oe,pe,fe,_e,ye,De;return{c(){t=f("div"),s=f("div"),e=f("div"),n=f("h3"),c=ee(p),v=F(),P=f("p"),E=ee("Wins: "),h=ee(A),u=F(),b=f("h1"),b.textContent=L,T=F(),_=f("div"),j=f("h3"),w=ee(B),D=F(),Y=f("p"),C=ee("Wins: "),y=ee(U),k=F(),r=f("p"),a=f("canvas"),H=F(),z=f("button"),i=ee(x),N=F(),q=f("button"),K=ee(J),ue=ee(" WS"),Q=F(),S=f("button"),S.textContent=X,W=F(),re=f("p"),oe=f("canvas"),this.h()},l(Z){t=g(Z,"DIV",{style:!0,class:!0});var G=R(t);s=g(G,"DIV",{class:!0});var me=R(s);e=g(me,"DIV",{class:!0});var ve=R(e);n=g(ve,"H3",{});var Ue=R(n);c=te(Ue,p),Ue.forEach(m),v=V(ve),P=g(ve,"P",{});var ke=R(P);E=te(ke,"Wins: "),h=te(ke,A),ke.forEach(m),ve.forEach(m),u=V(me),b=g(me,"H1",{class:!0,"data-svelte-h":!0}),de(b)!=="svelte-106hqp2"&&(b.textContent=L),T=V(me),_=g(me,"DIV",{class:!0});var be=R(_);j=g(be,"H3",{});var We=R(j);w=te(We,B),We.forEach(m),D=V(be),Y=g(be,"P",{});var Te=R(Y);C=te(Te,"Wins: "),y=te(Te,U),Te.forEach(m),be.forEach(m),me.forEach(m),k=V(G),r=g(G,"P",{});var je=R(r);a=g(je,"CANVAS",{width:!0,height:!0,style:!0}),R(a).forEach(m),je.forEach(m),H=V(G),z=g(G,"BUTTON",{style:!0,class:!0});var Oe=R(z);i=te(Oe,x),Oe.forEach(m),N=V(G),q=g(G,"BUTTON",{style:!0,class:!0});var Se=R(q);K=te(Se,J),ue=te(Se," WS"),Se.forEach(m),Q=V(G),S=g(G,"BUTTON",{style:!0,class:!0,"data-svelte-h":!0}),de(S)!=="svelte-1j2tb4n"&&(S.textContent=X),W=V(G),re=g(G,"P",{});var Be=R(re);oe=g(Be,"CANVAS",{width:!0,height:!0,style:!0}),R(oe).forEach(m),Be.forEach(m),G.forEach(m),this.h()},h(){d(e,"class","player1 svelte-1x1n3za"),d(b,"class","svelte-1x1n3za"),d(_,"class","player2 svelte-1x1n3za"),d(s,"class","scoreboard svelte-1x1n3za"),d(a,"width",I=o[3].width),d(a,"height",O=o[3].height),se(a,"background","black"),se(z,"margin-right","5px"),se(z,"margin-left","5px"),d(z,"class","svelte-1x1n3za"),se(q,"margin-right","5px"),se(q,"margin-left","5px"),d(q,"class","svelte-1x1n3za"),se(S,"margin-right","5px"),se(S,"margin-left","5px"),d(S,"class","svelte-1x1n3za"),oe.hidden=pe=!o[2],d(oe,"width",fe=o[3].width),d(oe,"height",_e=o[3].height),se(oe,"background","black"),se(t,"width","800px"),d(t,"class","cent svelte-1x1n3za")},m(Z,G){ne(Z,t,G),l(t,s),l(s,e),l(e,n),l(n,c),l(e,v),l(e,P),l(P,E),l(P,h),l(s,u),l(s,b),l(s,T),l(s,_),l(_,j),l(j,w),l(_,D),l(_,Y),l(Y,C),l(Y,y),l(t,k),l(t,r),l(r,a),o[13](a),l(t,H),l(t,z),l(z,i),l(t,N),l(t,q),l(q,K),l(q,ue),l(t,Q),l(t,S),l(t,W),l(t,re),l(re,oe),o[14](oe),ye||(De=[ie(a,"mousemove",o[5]),ie(z,"click",o[6]),ie(q,"click",o[8]),ie(S,"click",o[7])],ye=!0)},p(Z,G){G[0]&16&&p!==(p=Z[4]?.players?.[Z[4]?.p0index]?.user?.name+"")&&ae(c,p),G[0]&16&&A!==(A=Z[4]?.players?.[Z[4]?.p0index]?.wins+"")&&ae(h,A),G[0]&16&&B!==(B=(Z[4]?.players?.[Z[4]?.p1index]?.user?.name??"...")+"")&&ae(w,B),G[0]&16&&U!==(U=(Z[4]?.players?.[Z[4]?.p1index]?.wins??0)+"")&&ae(y,U),G[0]&8&&I!==(I=Z[3].width)&&d(a,"width",I),G[0]&8&&O!==(O=Z[3].height)&&d(a,"height",O),G[0]&16&&x!==(x=Z[4]?.isRunning?"pause":"start")&&ae(i,x),G[0]&4&&J!==(J=Z[2]?"hide":"show")&&ae(K,J),G[0]&4&&pe!==(pe=!Z[2])&&(oe.hidden=pe),G[0]&8&&fe!==(fe=Z[3].width)&&d(oe,"width",fe),G[0]&8&&_e!==(_e=Z[3].height)&&d(oe,"height",_e)},i:we,o:we,d(Z){Z&&m(t),o[13](null),o[14](null),ye=!1,Pe(De)}}}function ct(o,t,s){let e,n,p;he(o,ce,i=>s(21,e=i)),he(o,le,i=>s(22,n=i)),he(o,$,i=>s(23,p=i));let c,v,P,E,A,h=!1;const u=1e3/30,L=window.location.origin;let T={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},_={ballX:Math.floor(T.width/2),ballY:Math.floor(T.height/2),players:{a:{paddleY:Math.floor(T.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},b:{paddleY:Math.floor(T.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}},isRunning:!1,p0index:"a",p1index:"b"},j={..._},B={paddleY:Math.floor(T.height/2)};function w(){console.log("Initializing game"),P=c.getContext("2d"),E=v.getContext("2d"),r(P,_),r(E,j),k(),y()}function D(){_.players.findIndex(N=>N.user.id==e.id)>-1||console.error("Player not found in game state",_.players,e.id)}function Y(i){try{i.players[e.id].paddleY=B.paddleY}catch(N){console.error("Error in converting state",N)}s(4,_={...i})}function C(i){s(3,T={...i})}function U(i){s(4,_.isRunning=i,_)}async function y(){for(;;){await new Promise(i=>setTimeout(i,u));try{if(_.isRunning)if(n.connected){let i=new Uint8Array(Uint16Array.of(B.paddleY).buffer),N=[1,i[0],i[1]];const q=Uint8Array.of(...N);n.wt.send(q)}else{console.error("Connection not ready");continue}}catch(i){console.error("Error in transmit loop",i)}}}function k(){try{r(P,_),r(E,j)}catch(i){console.error("Error in draw loop",i)}A=requestAnimationFrame(k)}function r(i,N){i.clearRect(0,0,c.width,c.height),i.fillStyle="white",i.beginPath(),i.arc(N.ballX,N.ballY,T.ballRadius,0,Math.PI*2),i.fill(),Object.keys(N?.players).length>0&&(i.fillRect(0,N.players[N.p0index]?.paddleY,T.paddleWidth,T.paddleHeight),i.fillRect(c.width-T.paddleWidth,N.players[N.p1index]?.paddleY,T.paddleWidth,T.paddleHeight),i.strokeStyle="white",i.lineWidth=3,i.setLineDash([20,40]),i.beginPath(),i.moveTo(c.width/2,0),i.lineTo(c.width/2,c.height),i.stroke(),i.fillStyle="white",i.font="bold 50px Arial",i.fillText(N.players[N.p0index]?.score?.toString()??"0",c.width/2-70,70,100),i.fillText(N.players[N.p1index]?.score?.toString()??"0",c.width/2+40,70,100)),N.isRunning||(i.fillStyle="white",i.font="bold 50px Arial",i.fillText("▐▐ ",20,80,200))}Ie(()=>{w()}),et(()=>{cancelAnimationFrame(A)});function a(i){const N=c.getBoundingClientRect(),q=i.clientY-N.top-T.paddleHeight/2,J=Math.max(1,Math.min(c.height-T.paddleHeight,q));B.paddleY=J,s(4,_.players[e.id].paddleY=J,_)}function I(){console.log(n),n.connected?n.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function O(){const i={room_id:e.room.id,user_id:e.id},N=`${L}/leave_room`;console.log("Leaving room...",i,N),fetch(N,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(q=>q.json()).then(q=>{q.status=="success"&&q.user?.id&&q.room?.id?(console.log("Leave room successful"),M(ce,e=q.user,e),M($,p="harusnya mainmenu",p)):console.error("Failed to leave room",q)}).catch(q=>{console.error("Error in leave room request",q)})}n.addListener("wt",(i,N)=>{Y(N)}),n.addListener("ws",(i,N)=>{j=N}),$.subscribe(i=>{i=="play"&&(C({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),Y(e.room.gameState))});function H(){s(2,h=!h)}function z(i){Ee[i?"unshift":"push"](()=>{c=i,s(0,c)})}function x(i){Ee[i?"unshift":"push"](()=>{v=i,s(1,v)})}return[c,v,h,T,_,a,I,O,H,D,Y,C,U,z,x]}class ut extends Re{constructor(t){super(),Ae(this,t,ct,at,Ce,{setPlayerSide:9,setState:10,setRoomConfig:11,setRunning:12},null,[-1,-1])}get setPlayerSide(){return this.$$.ctx[9]}get setState(){return this.$$.ctx[10]}get setRoomConfig(){return this.$$.ctx[11]}get setRunning(){return this.$$.ctx[12]}}globalThis.__sveltekit_9qs5dk.env??(await nt(()=>import(globalThis.__sveltekit_9qs5dk.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function dt(o){let t,s;return{c(){t=f("h2"),s=ee(o[3])},l(e){t=g(e,"H2",{});var n=R(t);s=te(n,o[3]),n.forEach(m)},m(e,n){ne(e,t,n),l(t,s)},p(e,n){n&8&&ae(s,e[3])},d(e){e&&m(t)}}}function ht(o){let t,s="username",e,n,p,c,v,P,E,A,h=o[2]&&Ke(o);return{c(){t=f("h1"),t.textContent=s,e=F(),n=f("input"),p=F(),c=f("input"),v=F(),h&&h.c(),P=Me(),this.h()},l(u){t=g(u,"H1",{class:!0,"data-svelte-h":!0}),de(t)!=="svelte-18bhqtc"&&(t.textContent=s),e=V(u),n=g(u,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),p=V(u),c=g(u,"INPUT",{type:!0,class:!0}),v=V(u),h&&h.l(u),P=Me(),this.h()},h(){d(t,"class","svelte-1264fyt"),d(n,"type","text"),d(n,"placeholder","your nickname"),d(n,"autocomplete","off"),d(n,"spellcheck","false"),d(n,"maxlength","20"),d(n,"class","svelte-1264fyt"),d(c,"type","submit"),c.value="Enter",d(c,"class","svelte-1264fyt")},m(u,b){ne(u,t,b),ne(u,e,b),ne(u,n,b),ge(n,o[1]),ne(u,p,b),ne(u,c,b),ne(u,v,b),h&&h.m(u,b),ne(u,P,b),E||(A=[ie(n,"input",o[5]),ie(c,"click",o[4])],E=!0)},p(u,b){b&2&&n.value!==u[1]&&ge(n,u[1]),u[2]?h?h.p(u,b):(h=Ke(u),h.c(),h.m(P.parentNode,P)):h&&(h.d(1),h=null)},d(u){u&&(m(t),m(e),m(n),m(p),m(c),m(v),m(P)),h&&h.d(u),E=!1,Pe(A)}}}function Ke(o){let t,s,e;return{c(){t=f("div"),s=f("p"),e=ee(o[2]),this.h()},l(n){t=g(n,"DIV",{class:!0});var p=R(t);s=g(p,"P",{});var c=R(s);e=te(c,o[2]),c.forEach(m),p.forEach(m),this.h()},h(){d(t,"class","error-message svelte-1264fyt")},m(n,p){ne(n,t,p),l(t,s),l(s,e)},p(n,p){p&4&&ae(e,n[2])},d(n){n&&m(t)}}}function ft(o){let t,s,e,n,p,c,v,P,E,A,h,u,b,L,T,_,j;function B(C,U){if(C[3]==="idle")return ht;if(C[3]!=="harusnya mainmenu"&&C[3]!=="play")return dt}let w=B(o),D=w&&w(o);h=new it({});let Y={};return T=new ut({props:Y}),o[6](T),{c(){t=f("body"),s=f("div"),e=f("p"),n=ee("state = "),p=ee(o[3]),c=F(),v=f("div"),D&&D.c(),P=F(),E=f("div"),A=f("div"),Fe(h.$$.fragment),b=F(),L=f("div"),Fe(T.$$.fragment),this.h()},l(C){t=g(C,"BODY",{class:!0});var U=R(t);s=g(U,"DIV",{});var y=R(s);e=g(y,"P",{});var k=R(e);n=te(k,"state = "),p=te(k,o[3]),k.forEach(m),y.forEach(m),c=V(U),v=g(U,"DIV",{class:!0});var r=R(v);D&&D.l(r),r.forEach(m),P=V(U),E=g(U,"DIV",{});var a=R(E);A=g(a,"DIV",{class:!0});var I=R(A);Ve(h.$$.fragment,I),I.forEach(m),a.forEach(m),b=V(U),L=g(U,"DIV",{});var O=R(L);Ve(T.$$.fragment,O),O.forEach(m),U.forEach(m),this.h()},h(){d(v,"class","cent svelte-1264fyt"),d(A,"class","cent svelte-1264fyt"),E.hidden=u=o[3]!=="harusnya mainmenu",L.hidden=_=o[3]!=="play",d(t,"class","svelte-1264fyt")},m(C,U){ne(C,t,U),l(t,s),l(s,e),l(e,n),l(e,p),l(t,c),l(t,v),D&&D.m(v,null),l(t,P),l(t,E),l(E,A),Le(h,A,null),l(t,b),l(t,L),Le(T,L,null),j=!0},p(C,[U]){(!j||U&8)&&ae(p,C[3]),w===(w=B(C))&&D?D.p(C,U):(D&&D.d(1),D=w&&w(C),D&&(D.c(),D.m(v,null))),(!j||U&8&&u!==(u=C[3]!=="harusnya mainmenu"))&&(E.hidden=u);const y={};T.$set(y),(!j||U&8&&_!==(_=C[3]!=="play"))&&(L.hidden=_)},i(C){j||(Ye(h.$$.fragment,C),Ye(T.$$.fragment,C),j=!0)},o(C){He(h.$$.fragment,C),He(T.$$.fragment,C),j=!1},d(C){C&&m(t),D&&D.d(),qe(h),o[6](null),qe(T)}}}async function Qe(o){console.log("waiting for registration...",o);const t=5e3,s=new Promise((n,p)=>{const c=setInterval(()=>{o.register_status==="registered"&&(clearInterval(c),n())},100)}),e=new Promise((n,p)=>{setTimeout(()=>{p(new Error("Registration timeout"))},t)});return await Promise.race([s,e]).then(()=>(console.log("Registered successfully",o),!0)).catch(n=>!1)}function Ze(o){const s=new TextDecoder("utf-8").decode(o);return JSON.parse(s)}function gt(o){return new Promise(t=>setTimeout(t,o))}function pt(o){let t=o.replace(/:/g,"");if(t.length%2!==0)throw new Error("Invalid hex string");let s=new ArrayBuffer(t.length/2),e=new Uint8Array(s);for(let n=0;n<t.length;n+=2)e[n/2]=parseInt(t.substr(n,2),16);return s}function mt(o,t,s){let e,n,p;he(o,le,r=>s(9,e=r)),he(o,$,r=>s(3,n=r)),he(o,ce,r=>s(10,p=r));let c;const v=window.location.origin,P=v,E=v,A=v;let h="",u=null;M($,n="idle",n);let b="",L;Ie(()=>{console.log("mounted"),u=localStorage.getItem("id_user"),console.log("saved id_user",u),u&&T(),ce.subscribe(r=>{console.log("user changed",r)})}),xe(()=>{b&&(clearTimeout(L),L=setTimeout(()=>{s(2,b="")},3e3))});function T(){if(!h&&!u){s(2,b="Please enter your nickname");return}const r=`${P}/login`;u=localStorage.getItem("id_user"),console.log(`logging in... name=${h} id=${u} host=${r}`);const a={name:h,id:u??void 0};M($,n="logging in",n),fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(I=>{if(!I.ok)throw new Error("Network response was not ok");return I.json()}).then(I=>{console.log("logged in with user",I),I.code==200?(M($,n="connecting transport",n),ce.set(I.user),Y().then(()=>{localStorage.setItem("id_user",p.id)}).catch(O=>{console.error(O),M($,n="idle",n)})):(s(2,b=I.message??"Error logging in"),localStorage.clear("id_user"),u=null,ce.set(null),M($,n="idle",n))}).catch(I=>{s(2,b=I.message??"Error logging in"),console.error(I),M($,n="idle",n)})}async function _(){if(console.log("connecting transport..."),M($,n="connecting webTransport",n),await C()){if(console.log("connected webtransport"),M($,n="registering webTransport",n),!await j())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),M($,n="connecting webSocket",n),await U()){if(console.log("connected webSocket"),M($,n="registering webSocket",n),!await B())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return M(le,e.connected=!0,e),M($,n="harusnya mainmenu",n),2}async function j(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(p.id))),M(le,e.wt.register_status="registering",e),await Qe(e.wt)}async function B(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(p.id))),M(le,e.ws.register_status="registering",e),await Qe(e.ws)}M(le,e.addListener=(r,a)=>{e[r+"_listeners"]==null&&M(le,e[r+"_listeners"]=[],e);const I=e[r+"_listeners"].length;return e[r+"_listeners"].push(a),I},e),M(le,e.removeListener=(r,a)=>{M(le,e[r+"_listeners"]=null,e)},e);function w(r,a){console.log("handling message",a),r.register_status==="registering"&&(r.register_status="registered",console.log("register messsage received",r)),e[r.protocol+"_listeners"].forEach(I=>{try{I&&I(r,a)}catch(O){console.error("Error calling listener",O)}})}async function D(r){if(e.connected){console.log("handling disconnect",r);try{delete e[r?.protocol],delete e.ws}catch(a){console.log("error deleting transport",a)}M(le,e.connected=!1,e),await Y()}}async function Y(){for(console.log("reconnecting..."),M($,n="reconnecting",n);;){console.log("reconnecting...");const r=await _();if(r===2||r===1){r===1?(console.log("reconnected, but failed registering"),window.location.href="/"):console.log("reconnected"),M($,n="harusnya mainmenu",n);break}console.log("reconnecting again in 3 sec..."),await gt(3e3)}}async function C(){const r=`${E}/wt`,a=new WebTransport(r,{serverCertificateHashes:[{algorithm:"sha-256",value:pt("43:6E:11:10:0C:94:51:4C:10:FD:D8:F6:46:5F:DD:A4:18:70:EC:11:44:8E:C0:4D:A4:1A:B9:69:23:C3:7B:95")}]});if(a.closed.then(()=>{console.log("WebTransport closed",a),D(a)}).catch(J=>{console.error("WebTransport $connection died:",J,a),D(a)}),console.log("webtransport connecting...",r),!await a.ready.then(()=>(console.log("WebTransport connected",a),!0)).catch(J=>(console.error("WebTransport $connection failed:",J),!1)))return!1;const O={protocol:"wt",register_status:"unregistered",transport:a,isReading:!1},H=O.transport.datagrams,z=H.writable.getWriter(),x=H.readable.getReader();O.send=J=>{z.write(J)},async function(){for(;;){const{value:J,done:K}=await x.read();if(K){console.log("Done reading datagram, stop reading...",value);return}w(O,Ze(J))}}().catch(J=>{console.error("reading datagram failed, stop reading...:",J)});const i=await a.createBidirectionalStream(),N=i.writable.getWriter(),q=i.readable.getReader();return O.send_reliable=J=>{N.write(J)},async function(){for(;;){const{value:J,done:K}=await q.read();if(K){console.log("Done reading stream, stop reading...",value);return}w(O,Ze(J))}}().catch(J=>{console.error("reading datagram failed, stop reading...:",J)}),M(le,e.wt=O,e),!0}async function U(){const r=`${A}/ws`,a=new WebSocket(r);if(console.log("websocket connecting...",r),!await new Promise((H,z)=>{a.onopen=()=>{console.log(a,"WebSocket connected"),H(!0)},a.onerror_message=x=>{console.error("WebSocket error:",x),z(x)}}).catch(H=>(console.error("WebSocket $connection failed:",H),!1)))return!1;const O={protocol:"ws",register_status:"unregistered",transport:a,isReading:!1};return O.send=H=>{O.transport.send(H)},O.send_reliable=H=>{O.transport.send(H)},a.addEventListener("message",H=>{w(O,JSON.parse(H.data))}),a.addEventListener("close",H=>{H.wasClean?console.log("WebSocket closed",H):console.error("WebSocket $connection died",H)}),M(le,e.ws=O,e),!0}function y(){h=this.value,s(1,h)}function k(r){Ee[r?"unshift":"push"](()=>{c=r,s(0,c)})}return[c,h,b,n,T,y,k]}class yt extends Re{constructor(t){super(),Ae(this,t,mt,ft,Ce,{})}}export{yt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}