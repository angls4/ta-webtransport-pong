import{s as Ce,n as we,r as Pe,e as he,o as Ie,a as xe,f as q,h as et,b as Ee}from"../chunks/scheduler.CTimOCLo.js";import{S as Re,i as Ae,g as f,s as V,h as g,j as N,c as L,y as de,f as p,k as d,l as se,a as oe,x as l,z as ge,A as ae,B as $e,C as tt,m as x,n as $,o as ie,r as Oe,u as Ve,v as Le,d as Ye,t as He,w as qe,e as ze}from"../chunks/index.CRnmY6F2.js";import{w as Ne}from"../chunks/index.BXnrS5-F.js";import{_ as ot}from"../chunks/preload-helper.CRk0x-X1.js";function Me(s){return s?.length!==void 0?s:Array.from(s)}const nt={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},st={id:null,name:"",room:null,player:null},le=Ne(nt),ce=Ne(st),Z=Ne("idle");function Je(s,t,n){const e=s.slice();return e[23]=t[n],e}function Xe(s){let t,n,e;return{c(){t=f("div"),n=f("p"),e=x(s[4]),this.h()},l(o){t=g(o,"DIV",{class:!0});var m=N(t);n=g(m,"P",{});var c=N(n);e=$(c,s[4]),c.forEach(p),m.forEach(p),this.h()},h(){d(t,"class","error-message svelte-18y7b0k")},m(o,m){oe(o,t,m),l(t,n),l(n,e)},p(o,m){m&16&&ie(e,o[4])},d(o){o&&p(t)}}}function Ge(s){let t,n,e,o,m=s[23].name+"",c,b,I,E,D=Math.abs(s[23].ballSpeedX)+"",h,u,w,Y=s[23].gameState.players.length+"",F,_,S,O,v,W="JOIN",z,C,U;function y(){return s[12](s[23])}return{c(){t=f("div"),n=f("div"),e=f("div"),o=f("span"),c=x(m),b=V(),I=f("span"),E=x("Ball speed : "),h=x(D),u=V(),w=f("span"),F=x(Y),_=x("/2 Players"),S=V(),O=f("div"),v=f("button"),v.textContent=W,z=V(),this.h()},l(k){t=g(k,"DIV",{class:!0});var r=N(t);n=g(r,"DIV",{class:!0});var a=N(n);e=g(a,"DIV",{class:!0});var R=N(e);o=g(R,"SPAN",{});var B=N(o);c=$(B,m),B.forEach(p),R.forEach(p),b=L(a),I=g(a,"SPAN",{class:!0});var H=N(I);E=$(H,"Ball speed : "),h=$(H,D),H.forEach(p),u=L(a),w=g(a,"SPAN",{class:!0});var J=N(w);F=$(J,Y),_=$(J,"/2 Players"),J.forEach(p),a.forEach(p),S=L(r),O=g(r,"DIV",{class:!0});var Q=N(O);v=g(Q,"BUTTON",{class:!0,"data-svelte-h":!0}),de(v)!=="svelte-120grqu"&&(v.textContent=W),Q.forEach(p),z=L(r),r.forEach(p),this.h()},h(){d(e,"class","room__name svelte-18y7b0k"),d(I,"class","room__detail svelte-18y7b0k"),d(w,"class","room__detail svelte-18y7b0k"),d(n,"class","room__info svelte-18y7b0k"),d(v,"class","button svelte-18y7b0k"),d(O,"class","room__actions"),d(t,"class","room svelte-18y7b0k")},m(k,r){oe(k,t,r),l(t,n),l(n,e),l(e,o),l(o,c),l(n,b),l(n,I),l(I,E),l(I,h),l(n,u),l(n,w),l(w,F),l(w,_),l(t,S),l(t,O),l(O,v),l(t,z),C||(U=ae(v,"click",y),C=!0)},p(k,r){s=k,r&1&&m!==(m=s[23].name+"")&&ie(c,m),r&1&&D!==(D=Math.abs(s[23].ballSpeedX)+"")&&ie(h,D),r&1&&Y!==(Y=s[23].gameState.players.length+"")&&ie(F,Y)},d(k){k&&p(t),C=!1,U()}}}function rt(s){let t,n,e,o="PONG",m,c,b,I,E,D="rename user",h,u,w,Y,F,_,S,O,v,W,z,C="Create Room",U,y,k,r="Refresh",a,R,B="",H,J,Q,ee,i="s",P,A,M=s[4]&&Xe(s),ue=Me(s[0]),K=[];for(let T=0;T<ue.length;T+=1)K[T]=Ge(Je(s,ue,T));return{c(){t=f("div"),M&&M.c(),n=V(),e=f("h1"),e.textContent=o,m=V(),c=f("div"),b=f("input"),I=V(),E=f("button"),E.textContent=D,h=V(),u=f("br"),w=V(),Y=f("br"),F=V(),_=f("input"),S=V(),O=f("span"),v=f("input"),W=V(),z=f("button"),z.textContent=C,U=V(),y=f("p"),k=f("button"),k.textContent=r,a=V(),R=f("div"),R.innerHTML=B,H=V(),J=f("div");for(let T=0;T<K.length;T+=1)K[T].c();Q=V(),ee=f("p"),ee.textContent=i,this.h()},l(T){t=g(T,"DIV",{class:!0});var X=N(t);M&&M.l(X),n=L(X),e=g(X,"H1",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1jnr5i3"&&(e.textContent=o),m=L(X),c=g(X,"DIV",{class:!0,style:!0});var j=N(c);b=g(j,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),I=L(j),E=g(j,"BUTTON",{class:!0,"data-svelte-h":!0}),de(E)!=="svelte-5cerf9"&&(E.textContent=D),h=L(j),u=g(j,"BR",{}),w=L(j),Y=g(j,"BR",{}),F=L(j),_=g(j,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),S=L(j),O=g(j,"SPAN",{});var re=N(O);v=g(re,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),W=L(re),z=g(re,"BUTTON",{class:!0,"data-svelte-h":!0}),de(z)!=="svelte-136z9rb"&&(z.textContent=C),re.forEach(p),j.forEach(p),U=L(X),y=g(X,"P",{});var ne=N(y);k=g(ne,"BUTTON",{class:!0,"data-svelte-h":!0}),de(k)!=="svelte-s4sqy4"&&(k.textContent=r),ne.forEach(p),a=L(X),R=g(X,"DIV",{class:!0,"data-svelte-h":!0}),de(R)!=="svelte-1hf6hku"&&(R.innerHTML=B),H=L(X),J=g(X,"DIV",{class:!0});var me=N(J);for(let fe=0;fe<K.length;fe+=1)K[fe].l(me);me.forEach(p),X.forEach(p),Q=L(T),ee=g(T,"P",{style:!0,"data-svelte-h":!0}),de(ee)!=="svelte-1fb4tdl"&&(ee.textContent=i),this.h()},h(){d(e,"class","card__title svelte-18y7b0k"),d(b,"type","text"),d(b,"placeholder","New nickname"),d(b,"maxlength","20"),d(b,"class","svelte-18y7b0k"),d(E,"class","button-small svelte-18y7b0k"),d(_,"type","text"),_.required=!0,d(_,"placeholder","Enter room name"),d(_,"maxlength","20"),d(_,"class","svelte-18y7b0k"),d(v,"type","number"),d(v,"min","0"),d(v,"max","100"),v.required=!0,d(v,"placeholder","Ball speed"),se(v,"width","100px"),se(v,"margin-left","0"),se(v,"margin-right","10px"),d(v,"class","svelte-18y7b0k"),d(z,"class","button-small svelte-18y7b0k"),d(c,"class","room svelte-18y7b0k"),se(c,"display","block"),d(k,"class","button svelte-18y7b0k"),d(R,"class","card__header svelte-18y7b0k"),d(J,"class","room-list svelte-18y7b0k"),d(t,"class","card svelte-18y7b0k"),se(ee,"color","white")},m(T,X){oe(T,t,X),M&&M.m(t,null),l(t,n),l(t,e),l(t,m),l(t,c),l(c,b),ge(b,s[3]),l(c,I),l(c,E),l(c,h),l(c,u),l(c,w),l(c,Y),l(c,F),l(c,_),ge(_,s[1]),l(c,S),l(c,O),l(O,v),ge(v,s[2]),l(O,W),l(O,z),l(t,U),l(t,y),l(y,k),l(t,a),l(t,R),l(t,H),l(t,J);for(let j=0;j<K.length;j+=1)K[j]&&K[j].m(J,null);oe(T,Q,X),oe(T,ee,X),P||(A=[ae(b,"input",s[9]),ae(E,"click",s[8]),ae(_,"input",s[10]),ae(v,"input",s[11]),ae(z,"click",s[6]),ae(k,"click",s[5])],P=!0)},p(T,[X]){if(T[4]?M?M.p(T,X):(M=Xe(T),M.c(),M.m(t,n)):M&&(M.d(1),M=null),X&8&&b.value!==T[3]&&ge(b,T[3]),X&2&&_.value!==T[1]&&ge(_,T[1]),X&4&&$e(v.value)!==T[2]&&ge(v,T[2]),X&129){ue=Me(T[0]);let j;for(j=0;j<ue.length;j+=1){const re=Je(T,ue,j);K[j]?K[j].p(re,X):(K[j]=Ge(re),K[j].c(),K[j].m(J,null))}for(;j<K.length;j+=1)K[j].d(1);K.length=ue.length}},i:we,o:we,d(T){T&&(p(t),p(Q),p(ee)),M&&M.d(),tt(K,T),P=!1,Pe(A)}}}function lt(s,t,n){let e,o,m;he(s,ce,y=>n(14,e=y)),he(s,Z,y=>n(15,o=y)),he(s,le,y=>n(16,m=y));const b=window.location.origin;let I=[],E="",D,h=e?.name??"",u="",w;Ie(()=>{console.log("Rooms page mounted"),Z.subscribe(y=>{console.log("State changed",y),(y=m.connected)&&(console.log("User",e),e.room?e.room?.id?S(e.room):S({id:e.room}):Y())})}),xe(()=>{u&&(clearTimeout(w),w=setTimeout(()=>{n(4,u="")},3e3))});async function Y(){const k=await(await fetch(`${b}/list_room`)).json();console.log("resJson",k),k.status=="success"?k.rooms?n(0,I=k.rooms):(console.error("Failed to get rooms",k),n(4,u="Failed to get rooms")):(console.error("Failed to get rooms",k),n(4,u=k.message??"Failed to get rooms")),console.log("got rooms",I)}function F(){Y()}async function _(){if(!E||!D){console.error("Room name and ball speed are required"),n(4,u="Room name and ball speed are required");return}const y={name:E,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:D,ballSpeedY:D},k=`${b}/create_room`;console.log("Creating room...",k,y),await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).then(r=>r.json()).then(r=>{console.log("create room",r),r.status=="success"&&r.room?.id?(console.log("Room created successfully, joining...",r.room),S(r.room)):(console.error("Failed to create room",r.message),n(4,u=r.message??"Failed to create room"))}).catch(r=>{console.error("Failed to create room",r),n(4,u=r.message??"Failed to create room")}),console.log("Room created successfully"),Y()}async function S(y){console.log("Joining room...",y.id);const k=`${b}/join_room`,r={room_id:y.id,user_id:e.id};await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(a=>a.json()).then(a=>{console.log("joining room",a),a.status=="success"&&a.room?.id&&a.user?.id?(console.log("Joined room successfully"),q(ce,e=a.user,e),q(ce,e.room=a.room,e),console.log("User",e),O(y)):(console.error("Failed to join room",a),q(ce,e.room=null,e),n(4,u=a.message??"Failed to join room"),Y())}).catch(a=>{console.error("Failed to join room",a),n(4,u=a.message??"Failed to join room")})}function O(y){console.log("Playing room...",y),q(Z,o="play",o)}function v(){if(!h){console.error("Nickname is required"),n(4,u="Nickname is required");return}console.log("Renaming room...",E);const y=`${b}/login`,k={id:e.id,name:h};fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}).then(r=>r.json()).then(r=>{console.log("rename user",r),r.status=="success"&&r.user?.id?(console.log("User renamed successfully"),q(ce,e=r.user,e)):(console.error("Failed to rename user",r),n(4,u=r.message??"Failed to rename user"))}).catch(r=>{console.error("Failed to rename user",r),n(4,u=r.message??"Failed to rename user")})}function W(){h=this.value,n(3,h)}function z(){E=this.value,n(1,E)}function C(){D=$e(this.value),n(2,D)}return[I,E,D,h,u,F,_,S,v,W,z,C,y=>S(y)]}class at extends Re{constructor(t){super(),Ae(this,t,lt,rt,Ce,{})}}new TextEncoder;function it(s){let t,n,e,o,m=s[4]?.players?.[0]?.user?.name+"",c,b,I,E,D=s[4]?.players?.[0]?.wins+"",h,u,w,Y="PONG",F,_,S,O=(s[4]?.players?.[1]?.user?.name??"...")+"",v,W,z,C,U=(s[4]?.players?.[1]?.wins??0)+"",y,k,r,a,R,B,H,J,Q=s[4]?.isRunning?"pause":"start",ee,i,P,A=s[2]?"hide":"show",M,ue,K,T,X="leave",j,re,ne,me,fe,_e,ye,De;return{c(){t=f("div"),n=f("div"),e=f("div"),o=f("h3"),c=x(m),b=V(),I=f("p"),E=x("Wins: "),h=x(D),u=V(),w=f("h1"),w.textContent=Y,F=V(),_=f("div"),S=f("h3"),v=x(O),W=V(),z=f("p"),C=x("Wins: "),y=x(U),k=V(),r=f("p"),a=f("canvas"),H=V(),J=f("button"),ee=x(Q),i=V(),P=f("button"),M=x(A),ue=x(" WS"),K=V(),T=f("button"),T.textContent=X,j=V(),re=f("p"),ne=f("canvas"),this.h()},l(te){t=g(te,"DIV",{style:!0,class:!0});var G=N(t);n=g(G,"DIV",{class:!0});var pe=N(n);e=g(pe,"DIV",{class:!0});var ve=N(e);o=g(ve,"H3",{});var Ue=N(o);c=$(Ue,m),Ue.forEach(p),b=L(ve),I=g(ve,"P",{});var ke=N(I);E=$(ke,"Wins: "),h=$(ke,D),ke.forEach(p),ve.forEach(p),u=L(pe),w=g(pe,"H1",{class:!0,"data-svelte-h":!0}),de(w)!=="svelte-106hqp2"&&(w.textContent=Y),F=L(pe),_=g(pe,"DIV",{class:!0});var be=N(_);S=g(be,"H3",{});var We=N(S);v=$(We,O),We.forEach(p),W=L(be),z=g(be,"P",{});var Se=N(z);C=$(Se,"Wins: "),y=$(Se,U),Se.forEach(p),be.forEach(p),pe.forEach(p),k=L(G),r=g(G,"P",{});var je=N(r);a=g(je,"CANVAS",{width:!0,height:!0,style:!0}),N(a).forEach(p),je.forEach(p),H=L(G),J=g(G,"BUTTON",{style:!0,class:!0});var Be=N(J);ee=$(Be,Q),Be.forEach(p),i=L(G),P=g(G,"BUTTON",{style:!0,class:!0});var Te=N(P);M=$(Te,A),ue=$(Te," WS"),Te.forEach(p),K=L(G),T=g(G,"BUTTON",{style:!0,class:!0,"data-svelte-h":!0}),de(T)!=="svelte-1j2tb4n"&&(T.textContent=X),j=L(G),re=g(G,"P",{});var Fe=N(re);ne=g(Fe,"CANVAS",{width:!0,height:!0,style:!0}),N(ne).forEach(p),Fe.forEach(p),G.forEach(p),this.h()},h(){d(e,"class","player1 svelte-1x1n3za"),d(w,"class","svelte-1x1n3za"),d(_,"class","player2 svelte-1x1n3za"),d(n,"class","scoreboard svelte-1x1n3za"),d(a,"width",R=s[3].width),d(a,"height",B=s[3].height),se(a,"background","black"),se(J,"margin-right","5px"),se(J,"margin-left","5px"),d(J,"class","svelte-1x1n3za"),se(P,"margin-right","5px"),se(P,"margin-left","5px"),d(P,"class","svelte-1x1n3za"),se(T,"margin-right","5px"),se(T,"margin-left","5px"),d(T,"class","svelte-1x1n3za"),ne.hidden=me=!s[2],d(ne,"width",fe=s[3].width),d(ne,"height",_e=s[3].height),se(ne,"background","black"),se(t,"width","800px"),d(t,"class","cent svelte-1x1n3za")},m(te,G){oe(te,t,G),l(t,n),l(n,e),l(e,o),l(o,c),l(e,b),l(e,I),l(I,E),l(I,h),l(n,u),l(n,w),l(n,F),l(n,_),l(_,S),l(S,v),l(_,W),l(_,z),l(z,C),l(z,y),l(t,k),l(t,r),l(r,a),s[13](a),l(t,H),l(t,J),l(J,ee),l(t,i),l(t,P),l(P,M),l(P,ue),l(t,K),l(t,T),l(t,j),l(t,re),l(re,ne),s[14](ne),ye||(De=[ae(a,"mousemove",s[5]),ae(J,"click",s[6]),ae(P,"click",s[8]),ae(T,"click",s[7])],ye=!0)},p(te,G){G[0]&16&&m!==(m=te[4]?.players?.[0]?.user?.name+"")&&ie(c,m),G[0]&16&&D!==(D=te[4]?.players?.[0]?.wins+"")&&ie(h,D),G[0]&16&&O!==(O=(te[4]?.players?.[1]?.user?.name??"...")+"")&&ie(v,O),G[0]&16&&U!==(U=(te[4]?.players?.[1]?.wins??0)+"")&&ie(y,U),G[0]&8&&R!==(R=te[3].width)&&d(a,"width",R),G[0]&8&&B!==(B=te[3].height)&&d(a,"height",B),G[0]&16&&Q!==(Q=te[4]?.isRunning?"pause":"start")&&ie(ee,Q),G[0]&4&&A!==(A=te[2]?"hide":"show")&&ie(M,A),G[0]&4&&me!==(me=!te[2])&&(ne.hidden=me),G[0]&8&&fe!==(fe=te[3].width)&&d(ne,"width",fe),G[0]&8&&_e!==(_e=te[3].height)&&d(ne,"height",_e)},i:we,o:we,d(te){te&&p(t),s[13](null),s[14](null),ye=!1,Pe(De)}}}function ct(s,t,n){let e,o,m;he(s,ce,i=>n(21,e=i)),he(s,le,i=>n(22,o=i)),he(s,Z,i=>n(23,m=i));let c,b,I,E,D,h=!1;const u=1e3/30,Y=window.location.origin;let F=0,_={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},S={ballX:Math.floor(_.width/2),ballY:Math.floor(_.height/2),players:[{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}],isRunning:!1},O={...S},v={paddleY:Math.floor(_.height/2)};function W(){console.log("Initializing game"),I=c.getContext("2d"),E=b.getContext("2d"),a(I,S),a(E,O),r(),k()}function z(){const i=S.players.findIndex(P=>P.user.id==e.id);i>-1?F=i:console.error("Player not found in game state",S.players,e.id)}function C(i){try{i.players[F].paddleY=v.paddleY}catch(P){console.error("Error in converting state",P)}n(4,S={...i})}function U(i){n(3,_={...i})}function y(i){n(4,S.isRunning=i,S)}async function k(){for(;;){await new Promise(i=>setTimeout(i,u));try{if(S.isRunning)if(o.connected){let i=new Uint8Array(Uint16Array.of(v.paddleY).buffer),P=[1,i[0],i[1]];const A=Uint8Array.of(...P);o.wt.send(A)}else{console.error("Connection not ready");continue}}catch(i){console.error("Error in transmit loop",i)}}}function r(){try{a(I,S),a(E,O)}catch(i){console.error("Error in draw loop",i)}D=requestAnimationFrame(r)}function a(i,P){i.clearRect(0,0,c.width,c.height),i.fillStyle="white",i.beginPath(),i.arc(P.ballX,P.ballY,_.ballRadius,0,Math.PI*2),i.fill(),i.fillRect(0,P.players?.[0]?.paddleY,_.paddleWidth,_.paddleHeight),i.fillRect(c.width-_.paddleWidth,P.players?.[1]?.paddleY,_.paddleWidth,_.paddleHeight),i.strokeStyle="white",i.lineWidth=3,i.setLineDash([20,40]),i.beginPath(),i.moveTo(c.width/2,0),i.lineTo(c.width/2,c.height),i.stroke(),P.players&&P.players.length>0&&(i.fillStyle="white",i.font="bold 50px Arial",i.fillText(P.players[0]?.score?.toString()??"0",c.width/2-70,70,100),i.fillText(P.players[1]?.score?.toString()??"0",c.width/2+40,70,100)),P.isRunning||(i.fillStyle="white",i.font="bold 50px Arial",i.fillText("▐▐ ",20,80,200))}Ie(()=>{W()}),et(()=>{cancelAnimationFrame(D)});function R(i){const P=c.getBoundingClientRect(),A=i.clientY-P.top-_.paddleHeight/2,M=Math.max(1,Math.min(c.height-_.paddleHeight,A));v.paddleY=M,n(4,S.players[F].paddleY=M,S)}function B(){console.log(o),o.connected?o.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function H(){const i={room_id:e.room.id,user_id:e.id},P=`${Y}/leave_room`;console.log("Leaving room...",i,P),fetch(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(A=>A.json()).then(A=>{A.status=="success"&&A.user?.id&&A.room?.id?(console.log("Leave room successful"),q(ce,e=A.user,e),q(Z,m="harusnya mainmenu",m)):console.error("Failed to leave room",A)}).catch(A=>{console.error("Error in leave room request",A)})}o.addListener("wt",(i,P)=>{C(P)}),o.addListener("ws",(i,P)=>{O=P}),Z.subscribe(i=>{i=="play"&&(U({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),C(e.room.gameState),z())});function J(){n(2,h=!h)}function Q(i){Ee[i?"unshift":"push"](()=>{c=i,n(0,c)})}function ee(i){Ee[i?"unshift":"push"](()=>{b=i,n(1,b)})}return[c,b,h,_,S,R,B,H,J,z,C,U,y,Q,ee]}class ut extends Re{constructor(t){super(),Ae(this,t,ct,it,Ce,{setPlayerSide:9,setState:10,setRoomConfig:11,setRunning:12},null,[-1,-1])}get setPlayerSide(){return this.$$.ctx[9]}get setState(){return this.$$.ctx[10]}get setRoomConfig(){return this.$$.ctx[11]}get setRunning(){return this.$$.ctx[12]}}globalThis.__sveltekit_1x2vh1z.env??(await ot(()=>import(globalThis.__sveltekit_1x2vh1z.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function dt(s){let t,n;return{c(){t=f("h2"),n=x(s[3])},l(e){t=g(e,"H2",{});var o=N(t);n=$(o,s[3]),o.forEach(p)},m(e,o){oe(e,t,o),l(t,n)},p(e,o){o&8&&ie(n,e[3])},d(e){e&&p(t)}}}function ht(s){let t,n="username",e,o,m,c,b,I,E,D,h=s[2]&&Ke(s);return{c(){t=f("h1"),t.textContent=n,e=V(),o=f("input"),m=V(),c=f("input"),b=V(),h&&h.c(),I=ze(),this.h()},l(u){t=g(u,"H1",{class:!0,"data-svelte-h":!0}),de(t)!=="svelte-18bhqtc"&&(t.textContent=n),e=L(u),o=g(u,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),m=L(u),c=g(u,"INPUT",{type:!0,class:!0}),b=L(u),h&&h.l(u),I=ze(),this.h()},h(){d(t,"class","svelte-1264fyt"),d(o,"type","text"),d(o,"placeholder","your nickname"),d(o,"autocomplete","off"),d(o,"spellcheck","false"),d(o,"maxlength","20"),d(o,"class","svelte-1264fyt"),d(c,"type","submit"),c.value="Enter",d(c,"class","svelte-1264fyt")},m(u,w){oe(u,t,w),oe(u,e,w),oe(u,o,w),ge(o,s[1]),oe(u,m,w),oe(u,c,w),oe(u,b,w),h&&h.m(u,w),oe(u,I,w),E||(D=[ae(o,"input",s[5]),ae(c,"click",s[4])],E=!0)},p(u,w){w&2&&o.value!==u[1]&&ge(o,u[1]),u[2]?h?h.p(u,w):(h=Ke(u),h.c(),h.m(I.parentNode,I)):h&&(h.d(1),h=null)},d(u){u&&(p(t),p(e),p(o),p(m),p(c),p(b),p(I)),h&&h.d(u),E=!1,Pe(D)}}}function Ke(s){let t,n,e;return{c(){t=f("div"),n=f("p"),e=x(s[2]),this.h()},l(o){t=g(o,"DIV",{class:!0});var m=N(t);n=g(m,"P",{});var c=N(n);e=$(c,s[2]),c.forEach(p),m.forEach(p),this.h()},h(){d(t,"class","error-message svelte-1264fyt")},m(o,m){oe(o,t,m),l(t,n),l(n,e)},p(o,m){m&4&&ie(e,o[2])},d(o){o&&p(t)}}}function ft(s){let t,n,e,o,m,c,b,I,E,D,h,u,w,Y,F,_,S;function O(C,U){if(C[3]==="idle")return ht;if(C[3]!=="harusnya mainmenu"&&C[3]!=="play")return dt}let v=O(s),W=v&&v(s);h=new at({});let z={};return F=new ut({props:z}),s[6](F),{c(){t=f("body"),n=f("div"),e=f("p"),o=x("state = "),m=x(s[3]),c=V(),b=f("div"),W&&W.c(),I=V(),E=f("div"),D=f("div"),Oe(h.$$.fragment),w=V(),Y=f("div"),Oe(F.$$.fragment),this.h()},l(C){t=g(C,"BODY",{class:!0});var U=N(t);n=g(U,"DIV",{});var y=N(n);e=g(y,"P",{});var k=N(e);o=$(k,"state = "),m=$(k,s[3]),k.forEach(p),y.forEach(p),c=L(U),b=g(U,"DIV",{class:!0});var r=N(b);W&&W.l(r),r.forEach(p),I=L(U),E=g(U,"DIV",{});var a=N(E);D=g(a,"DIV",{class:!0});var R=N(D);Ve(h.$$.fragment,R),R.forEach(p),a.forEach(p),w=L(U),Y=g(U,"DIV",{});var B=N(Y);Ve(F.$$.fragment,B),B.forEach(p),U.forEach(p),this.h()},h(){d(b,"class","cent svelte-1264fyt"),d(D,"class","cent svelte-1264fyt"),E.hidden=u=s[3]!=="harusnya mainmenu",Y.hidden=_=s[3]!=="play",d(t,"class","svelte-1264fyt")},m(C,U){oe(C,t,U),l(t,n),l(n,e),l(e,o),l(e,m),l(t,c),l(t,b),W&&W.m(b,null),l(t,I),l(t,E),l(E,D),Le(h,D,null),l(t,w),l(t,Y),Le(F,Y,null),S=!0},p(C,[U]){(!S||U&8)&&ie(m,C[3]),v===(v=O(C))&&W?W.p(C,U):(W&&W.d(1),W=v&&v(C),W&&(W.c(),W.m(b,null))),(!S||U&8&&u!==(u=C[3]!=="harusnya mainmenu"))&&(E.hidden=u);const y={};F.$set(y),(!S||U&8&&_!==(_=C[3]!=="play"))&&(Y.hidden=_)},i(C){S||(Ye(h.$$.fragment,C),Ye(F.$$.fragment,C),S=!0)},o(C){He(h.$$.fragment,C),He(F.$$.fragment,C),S=!1},d(C){C&&p(t),W&&W.d(),qe(h),s[6](null),qe(F)}}}async function Qe(s){console.log("waiting for registration...",s);const t=5e3,n=new Promise((o,m)=>{const c=setInterval(()=>{s.register_status==="registered"&&(clearInterval(c),o())},100)}),e=new Promise((o,m)=>{setTimeout(()=>{m(new Error("Registration timeout"))},t)});return await Promise.race([n,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(o=>!1)}function Ze(s){const n=new TextDecoder("utf-8").decode(s);return JSON.parse(n)}function gt(s){return new Promise(t=>setTimeout(t,s))}function mt(s){let t=s.replace(/:/g,"");if(t.length%2!==0)throw new Error("Invalid hex string");let n=new ArrayBuffer(t.length/2),e=new Uint8Array(n);for(let o=0;o<t.length;o+=2)e[o/2]=parseInt(t.substr(o,2),16);return n}function pt(s,t,n){let e,o,m;he(s,le,r=>n(9,e=r)),he(s,Z,r=>n(3,o=r)),he(s,ce,r=>n(10,m=r));let c;const b=window.location.origin,I=b,E=b,D=b;let h="",u=null;q(Z,o="idle",o);let w="",Y;Ie(()=>{console.log("mounted"),u=localStorage.getItem("id_user"),console.log("saved id_user",u),u&&F(),ce.subscribe(r=>{console.log("user changed",r)})}),xe(()=>{w&&(clearTimeout(Y),Y=setTimeout(()=>{n(2,w="")},3e3))});function F(){if(!h&&!u){n(2,w="Please enter your nickname");return}const r=`${I}/login`;u=localStorage.getItem("id_user"),console.log(`logging in... name=${h} id=${u} host=${r}`);const a={name:h,id:u??void 0};q(Z,o="logging in",o),fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(R=>{if(!R.ok)throw new Error("Network response was not ok");return R.json()}).then(R=>{console.log("logged in with user",R),R.code==200?(q(Z,o="connecting transport",o),ce.set(R.user),z().then(()=>{localStorage.setItem("id_user",m.id)}).catch(B=>{console.error(B),q(Z,o="idle",o)})):(n(2,w=R.message??"Error logging in"),localStorage.clear("id_user"),u=null,ce.set(null),q(Z,o="idle",o))}).catch(R=>{n(2,w=R.message??"Error logging in"),console.error(R),q(Z,o="idle",o)})}async function _(){if(console.log("connecting transport..."),q(Z,o="connecting webTransport",o),await C()){if(console.log("connected webtransport"),q(Z,o="registering webTransport",o),!await S())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),q(Z,o="connecting webSocket",o),await U()){if(console.log("connected webSocket"),q(Z,o="registering webSocket",o),!await O())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return q(le,e.connected=!0,e),q(Z,o="harusnya mainmenu",o),2}async function S(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(m.id))),q(le,e.wt.register_status="registering",e),await Qe(e.wt)}async function O(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(m.id))),q(le,e.ws.register_status="registering",e),await Qe(e.ws)}q(le,e.addListener=(r,a)=>{e[r+"_listeners"]==null&&q(le,e[r+"_listeners"]=[],e);const R=e[r+"_listeners"].length;return e[r+"_listeners"].push(a),R},e),q(le,e.removeListener=(r,a)=>{q(le,e[r+"_listeners"]=null,e)},e);function v(r,a){console.log("handling message",a),r.register_status==="registering"&&(r.register_status="registered",console.log("register messsage received",r)),e[r.protocol+"_listeners"].forEach(R=>{try{R&&R(r,a)}catch(B){console.error("Error calling listener",B)}})}async function W(r){if(e.connected){console.log("handling disconnect",r);try{delete e[r?.protocol],delete e.ws}catch(a){console.log("error deleting transport",a)}q(le,e.connected=!1,e),await z()}}async function z(){for(console.log("reconnecting..."),q(Z,o="reconnecting",o);;){console.log("reconnecting...");const r=await _();if(r===2||r===1){r===1?(console.log("reconnected, but failed registering"),window.location.href="/"):console.log("reconnected"),q(Z,o="harusnya mainmenu",o);break}console.log("reconnecting again in 3 sec..."),await gt(3e3)}}async function C(){const r=`${E}/wt`,a=new WebTransport(r,{serverCertificateHashes:[{algorithm:"sha-256",value:mt("43:6E:11:10:0C:94:51:4C:10:FD:D8:F6:46:5F:DD:A4:18:70:EC:11:44:8E:C0:4D:A4:1A:B9:69:23:C3:7B:95")}]});if(a.closed.then(()=>{console.log("WebTransport closed",a),W(a)}).catch(A=>{console.error("WebTransport $connection died:",A,a),W(a)}),console.log("webtransport connecting...",r),!await a.ready.then(()=>(console.log("WebTransport connected",a),!0)).catch(A=>(console.error("WebTransport $connection failed:",A),!1)))return!1;const B={protocol:"wt",register_status:"unregistered",transport:a,isReading:!1},H=B.transport.datagrams,J=H.writable.getWriter(),Q=H.readable.getReader();B.send=A=>{J.write(A)},async function(){for(;;){const{value:A,done:M}=await Q.read();if(M){console.log("Done reading datagram, stop reading...",value);return}v(B,Ze(A))}}().catch(A=>{console.error("reading datagram failed, stop reading...:",A)});const ee=await a.createBidirectionalStream(),i=ee.writable.getWriter(),P=ee.readable.getReader();return B.send_reliable=A=>{i.write(A)},async function(){for(;;){const{value:A,done:M}=await P.read();if(M){console.log("Done reading stream, stop reading...",value);return}v(B,Ze(A))}}().catch(A=>{console.error("reading datagram failed, stop reading...:",A)}),q(le,e.wt=B,e),!0}async function U(){const r=`${D}/ws`,a=new WebSocket(r);if(console.log("websocket connecting...",r),!await new Promise((H,J)=>{a.onopen=()=>{console.log(a,"WebSocket connected"),H(!0)},a.onerror_message=Q=>{console.error("WebSocket error:",Q),J(Q)}}).catch(H=>(console.error("WebSocket $connection failed:",H),!1)))return!1;const B={protocol:"ws",register_status:"unregistered",transport:a,isReading:!1};return B.send=H=>{B.transport.send(H)},B.send_reliable=H=>{B.transport.send(H)},a.addEventListener("message",H=>{v(B,JSON.parse(H.data))}),a.addEventListener("close",H=>{H.wasClean?console.log("WebSocket closed",H):console.error("WebSocket $connection died",H)}),q(le,e.ws=B,e),!0}function y(){h=this.value,n(1,h)}function k(r){Ee[r?"unshift":"push"](()=>{c=r,n(0,c)})}return[c,h,w,o,F,y,k]}class yt extends Re{constructor(t){super(),Ae(this,t,pt,ft,Ce,{})}}export{yt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}