import{s as $e,n as Le,r as et,e as we,o as tt,a as Rt,f as Y,h as jt,b as xe}from"../chunks/scheduler.CTimOCLo.js";import{S as ot,i as nt,g as a,s as U,m as Q,h as c,j as y,c as W,y as ie,n as Z,f as d,k as u,l as ve,a as le,x as n,z as Ee,A as me,o as ce,B as Pt,C as Dt,r as ht,u as ft,v as mt,d as pt,t as gt,w as _t,e as vt}from"../chunks/index.CRnmY6F2.js";import{w as st}from"../chunks/index.BXnrS5-F.js";import{_ as Nt}from"../chunks/preload-helper.CRk0x-X1.js";function wt(s){return s?.length!==void 0?s:Array.from(s)}const At={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},Ot={id:null,name:"",room:null,player:null},ue=st(At),ge=st(Ot),ne=st("login page");function bt(s,t,l){const e=s.slice();return e[21]=t[l],e}function yt(s){let t,l,e;return{c(){t=a("div"),l=a("p"),e=Q(s[4]),this.h()},l(o){t=c(o,"DIV",{class:!0});var m=y(t);l=c(m,"P",{});var v=y(l);e=Z(v,s[4]),v.forEach(d),m.forEach(d),this.h()},h(){u(t,"class","error-message svelte-17jni71")},m(o,m){le(o,t,m),n(t,l),n(l,e)},p(o,m){m&16&&ce(e,o[4])},d(o){o&&d(t)}}}function Et(s){let t,l,e,o,m=s[21].name+"",v,H,k,w,T=Math.abs(s[21].ballSpeedX)+"",h,r,b,S=Object.keys(s[21].gameState.players).length+"",_,C,E,N,M,ee,V,R,A,p;function J(){return s[13](s[21])}return{c(){t=a("div"),l=a("div"),e=a("div"),o=a("span"),v=Q(m),H=U(),k=a("span"),w=Q("Ball speed : "),h=Q(T),r=U(),b=a("span"),_=Q(S),C=Q("/2 Players"),E=U(),N=a("div"),M=a("button"),ee=Q("JOIN"),R=U(),this.h()},l(q){t=c(q,"DIV",{class:!0});var L=y(t);l=c(L,"DIV",{class:!0});var g=y(l);e=c(g,"DIV",{class:!0});var I=y(e);o=c(I,"SPAN",{});var P=y(o);v=Z(P,m),P.forEach(d),I.forEach(d),H=W(g),k=c(g,"SPAN",{class:!0});var O=y(k);w=Z(O,"Ball speed : "),h=Z(O,T),O.forEach(d),r=W(g),b=c(g,"SPAN",{class:!0});var F=y(b);_=Z(F,S),C=Z(F,"/2 Players"),F.forEach(d),g.forEach(d),E=W(L),N=c(L,"DIV",{});var te=y(N);M=c(te,"BUTTON",{class:!0});var re=y(M);ee=Z(re,"JOIN"),re.forEach(d),te.forEach(d),R=W(L),L.forEach(d),this.h()},h(){u(e,"class","room__name svelte-17jni71"),u(k,"class","room__detail svelte-17jni71"),u(b,"class","room__detail svelte-17jni71"),u(l,"class","room__info svelte-17jni71"),u(M,"class","button svelte-17jni71"),M.disabled=V=Object.keys(s[21].gameState.players).length>=2,u(t,"class","room svelte-17jni71")},m(q,L){le(q,t,L),n(t,l),n(l,e),n(e,o),n(o,v),n(l,H),n(l,k),n(k,w),n(k,h),n(l,r),n(l,b),n(b,_),n(b,C),n(t,E),n(t,N),n(N,M),n(M,ee),n(t,R),A||(p=me(M,"click",J),A=!0)},p(q,L){s=q,L&1&&m!==(m=s[21].name+"")&&ce(v,m),L&1&&T!==(T=Math.abs(s[21].ballSpeedX)+"")&&ce(h,T),L&1&&S!==(S=Object.keys(s[21].gameState.players).length+"")&&ce(_,S),L&1&&V!==(V=Object.keys(s[21].gameState.players).length>=2)&&(M.disabled=V)},d(q){q&&d(t),A=!1,p()}}}function Tt(s){let t,l="<span>No rooms available</span>";return{c(){t=a("p"),t.innerHTML=l,this.h()},l(e){t=c(e,"P",{style:!0,"data-svelte-h":!0}),ie(t)!=="svelte-156qi2m"&&(t.innerHTML=l),this.h()},h(){ve(t,"color","grey")},m(e,o){le(e,t,o)},d(e){e&&d(t)}}}function Vt(s){let t,l,e,o="PONG",m,v,H,k=s[5]?.name+"",w,T,h,r,b,S,_="rename user",C,E,N,M,ee,V,R,A,p,J,q,L="Create Room",g,I,P,O="Refresh",F,te,re="",se,ae,i,f,j,he="credit: angls4",Ce,Ie,z=s[4]&&yt(s),de=wt(s[0]),oe=[];for(let D=0;D<de.length;D+=1)oe[D]=Et(bt(s,de,D));let x=s[0].length==0&&Tt();return{c(){t=a("div"),z&&z.c(),l=U(),e=a("h1"),e.textContent=o,m=U(),v=a("h2"),H=Q("Welcome, "),w=Q(k),T=U(),h=a("div"),r=a("input"),b=U(),S=a("button"),S.textContent=_,C=U(),E=a("br"),N=U(),M=a("br"),ee=U(),V=a("input"),R=U(),A=a("span"),p=a("input"),J=U(),q=a("button"),q.textContent=L,g=U(),I=a("p"),P=a("button"),P.textContent=O,F=U(),te=a("div"),te.innerHTML=re,se=U(),ae=a("div");for(let D=0;D<oe.length;D+=1)oe[D].c();i=U(),x&&x.c(),f=U(),j=a("p"),j.textContent=he,this.h()},l(D){t=c(D,"DIV",{class:!0});var B=y(t);z&&z.l(B),l=W(B),e=c(B,"H1",{class:!0,"data-svelte-h":!0}),ie(e)!=="svelte-1jnr5i3"&&(e.textContent=o),m=W(B),v=c(B,"H2",{class:!0});var G=y(v);H=Z(G,"Welcome, "),w=Z(G,k),G.forEach(d),T=W(B),h=c(B,"DIV",{class:!0,style:!0});var K=y(h);r=c(K,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),b=W(K),S=c(K,"BUTTON",{class:!0,"data-svelte-h":!0}),ie(S)!=="svelte-5cerf9"&&(S.textContent=_),C=W(K),E=c(K,"BR",{}),N=W(K),M=c(K,"BR",{}),ee=W(K),V=c(K,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),R=W(K),A=c(K,"SPAN",{});var pe=y(A);p=c(pe,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),J=W(pe),q=c(pe,"BUTTON",{class:!0,"data-svelte-h":!0}),ie(q)!=="svelte-136z9rb"&&(q.textContent=L),pe.forEach(d),K.forEach(d),g=W(B),I=c(B,"P",{});var Pe=y(I);P=c(Pe,"BUTTON",{class:!0,"data-svelte-h":!0}),ie(P)!=="svelte-1nuptru"&&(P.textContent=O),Pe.forEach(d),F=W(B),te=c(B,"DIV",{class:!0,"data-svelte-h":!0}),ie(te)!=="svelte-1hf6hku"&&(te.innerHTML=re),se=W(B),ae=c(B,"DIV",{class:!0});var _e=y(ae);for(let be=0;be<oe.length;be+=1)oe[be].l(_e);_e.forEach(d),i=W(B),x&&x.l(B),B.forEach(d),f=W(D),j=c(D,"P",{style:!0,"data-svelte-h":!0}),ie(j)!=="svelte-apo9jk"&&(j.textContent=he),this.h()},h(){u(e,"class","card__title svelte-17jni71"),u(v,"class","svelte-17jni71"),u(r,"type","text"),u(r,"placeholder","New nickname"),u(r,"maxlength","20"),u(r,"class","svelte-17jni71"),u(S,"class","button-small svelte-17jni71"),u(V,"type","text"),V.required=!0,u(V,"placeholder","Enter room name"),u(V,"maxlength","20"),u(V,"class","svelte-17jni71"),u(p,"type","number"),u(p,"min","0"),u(p,"max","100"),p.required=!0,u(p,"placeholder","Ball speed"),ve(p,"width","100px"),ve(p,"margin-left","0"),ve(p,"margin-right","10px"),u(p,"class","svelte-17jni71"),u(q,"class","button-small svelte-17jni71"),u(h,"class","room svelte-17jni71"),ve(h,"display","block"),u(P,"class","button svelte-17jni71"),u(te,"class","card__header svelte-17jni71"),u(ae,"class","room-list svelte-17jni71"),u(t,"class","card svelte-17jni71"),ve(j,"color","white")},m(D,B){le(D,t,B),z&&z.m(t,null),n(t,l),n(t,e),n(t,m),n(t,v),n(v,H),n(v,w),n(t,T),n(t,h),n(h,r),Ee(r,s[3]),n(h,b),n(h,S),n(h,C),n(h,E),n(h,N),n(h,M),n(h,ee),n(h,V),Ee(V,s[1]),n(h,R),n(h,A),n(A,p),Ee(p,s[2]),n(A,J),n(A,q),n(t,g),n(t,I),n(I,P),n(t,F),n(t,te),n(t,se),n(t,ae);for(let G=0;G<oe.length;G+=1)oe[G]&&oe[G].m(ae,null);n(t,i),x&&x.m(t,null),le(D,f,B),le(D,j,B),Ce||(Ie=[me(r,"input",s[10]),me(S,"click",s[9]),me(V,"input",s[11]),me(p,"input",s[12]),me(q,"click",s[7]),me(P,"click",s[6])],Ce=!0)},p(D,[B]){if(D[4]?z?z.p(D,B):(z=yt(D),z.c(),z.m(t,l)):z&&(z.d(1),z=null),B&32&&k!==(k=D[5]?.name+"")&&ce(w,k),B&8&&r.value!==D[3]&&Ee(r,D[3]),B&2&&V.value!==D[1]&&Ee(V,D[1]),B&4&&Pt(p.value)!==D[2]&&Ee(p,D[2]),B&257){de=wt(D[0]);let G;for(G=0;G<de.length;G+=1){const K=bt(D,de,G);oe[G]?oe[G].p(K,B):(oe[G]=Et(K),oe[G].c(),oe[G].m(ae,null))}for(;G<oe.length;G+=1)oe[G].d(1);oe.length=de.length}D[0].length==0?x||(x=Tt(),x.c(),x.m(t,null)):x&&(x.d(1),x=null)},i:Le,o:Le,d(D){D&&(d(t),d(f),d(j)),z&&z.d(),Dt(oe,D),x&&x.d(),Ce=!1,et(Ie)}}}const Ut=3e3;function Wt(s,t,l){let e,o,m;we(s,ge,R=>l(5,e=R)),we(s,ne,R=>l(15,o=R)),we(s,ue,R=>l(16,m=R));const H=window.location.origin;let k=[],w="",T,h=e?.name??"",r="",b;tt(()=>{ne.subscribe(R=>{m.connected&&(e.room?e.room?.id?C(e.room):C({id:e.room}):S())})}),Rt(()=>{r&&(clearTimeout(b),b=setTimeout(()=>{l(4,r="")},Ut))});async function S(){const A=await(await fetch(`${H}/list_room`)).json();A.status=="success"?A.rooms?l(0,k=A.rooms):(console.error("Failed to get rooms",A),l(4,r="Failed to get rooms")):(console.error("Failed to get rooms",A),l(4,r=A.message??"Failed to get rooms")),console.log("room list refreshed",k)}async function _(){if(!w||!T){console.error("Room name and ball speed are required"),l(4,r="Room name and ball speed are required");return}const R={name:w,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:T,ballSpeedY:T},A=`${H}/create_room`;console.log("Creating room...",A,R),await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)}).then(p=>p.json()).then(p=>{console.log("create room",p),p.status=="success"&&p.room?.id?(console.log("Room created successfully, joining...",p.room),C(p.room)):(console.error("Failed to create room",p.message),l(4,r=p.message??"Failed to create room"))}).catch(p=>{console.error("Failed to create room",p),l(4,r=p.message??"Failed to create room")}),console.log("Room created successfully"),S()}async function C(R){console.log("Joining room...",R.id);const A=`${H}/join_room`,p={room_id:R.id,user_id:e.id};await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(J=>J.json()).then(J=>{J.status=="success"&&J.room?.id&&J.user?.id?(console.log("Joined room successfully"),Y(ge,e=J.user,e),Y(ge,e.room=J.room,e),console.log("Playing room...",R),Y(ne,o="game room",o)):(console.error("Failed to join room",J),Y(ge,e.room=null,e),l(4,r=J.message??"Failed to join room"),S())}).catch(J=>{console.error("Failed to join room",J),l(4,r=J.message??"Failed to join room")})}function E(){if(!h){console.error("Nickname is required"),l(4,r="Nickname is required");return}console.log("Renaming room...",w);const R=`${H}/login`,A={id:e.id,name:h};fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)}).then(p=>p.json()).then(p=>{console.log("rename user",p),p.status=="success"&&p.user?.id?(console.log("User renamed successfully"),Y(ge,e=p.user,e)):(console.error("Failed to rename user",p),l(4,r=p.message??"Failed to rename user"))}).catch(p=>{console.error("Failed to rename user",p),l(4,r=p.message??"Failed to rename user")})}function N(){h=this.value,l(3,h)}function M(){w=this.value,l(1,w)}function ee(){T=Pt(this.value),l(2,T)}return[k,w,T,h,r,e,S,_,C,E,N,M,ee,R=>C(R)]}class Lt extends ot{constructor(t){super(),nt(this,t,Wt,Vt,$e,{})}}new TextEncoder;function Ft(s){let t,l,e,o,m=(s[4]?.players?.[s[4]?.p0index]?.user?.name??"...")+"",v,H,k,w,T=(s[4]?.players?.[s[4]?.p0index]?.wins??0)+"",h,r,b,S="PONG",_,C,E,N=(s[4]?.players?.[s[4]?.p1index]?.user?.name??"...")+"",M,ee,V,R,A=(s[4]?.players?.[s[4]?.p1index]?.wins??0)+"",p,J,q,L,g,I,P,O,F,te="play/pause",re,se,ae="leave",i,f,j,he,Ce="Stats",Ie,z,de,oe="WebTransport delay : ",x,D,B,G,K,pe,Pe="WebSocket delay : ",_e,be,Fe,Be,Te,Se,lt="delay difference : ",ke,De,He,Me,je,fe,Ne,Ae,Oe,Ye,rt;return{c(){t=a("div"),l=a("div"),e=a("div"),o=a("h3"),v=Q(m),H=U(),k=a("p"),w=Q("Wins: "),h=Q(T),r=U(),b=a("h1"),b.textContent=S,_=U(),C=a("div"),E=a("h3"),M=Q(N),ee=U(),V=a("p"),R=Q("Wins: "),p=Q(A),J=U(),q=a("p"),L=a("canvas"),P=U(),O=a("div"),F=a("button"),F.textContent=te,re=U(),se=a("button"),se.textContent=ae,i=U(),f=a("div"),j=a("div"),he=a("div"),he.textContent=Ce,Ie=U(),z=a("div"),de=a("div"),de.textContent=oe,x=a("div"),D=Q(s[5]),B=Q(" ms"),G=U(),K=a("div"),pe=a("div"),pe.textContent=Pe,_e=a("div"),be=Q(s[6]),Fe=Q(" ms"),Be=U(),Te=a("div"),Se=a("div"),Se.textContent=lt,ke=a("div"),De=Q(s[7]),He=Q(" ms"),Me=U(),je=a("p"),fe=a("canvas"),this.h()},l($){t=c($,"DIV",{style:!0,class:!0});var X=y(t);l=c(X,"DIV",{class:!0});var Re=y(l);e=c(Re,"DIV",{class:!0});var Ve=y(e);o=c(Ve,"H3",{});var it=y(o);v=Z(it,m),it.forEach(d),H=W(Ve),k=c(Ve,"P",{});var qe=y(k);w=Z(qe,"Wins: "),h=Z(qe,T),qe.forEach(d),Ve.forEach(d),r=W(Re),b=c(Re,"H1",{class:!0,"data-svelte-h":!0}),ie(b)!=="svelte-106hqp2"&&(b.textContent=S),_=W(Re),C=c(Re,"DIV",{class:!0});var Ue=y(C);E=c(Ue,"H3",{});var at=y(E);M=Z(at,N),at.forEach(d),ee=W(Ue),V=c(Ue,"P",{});var Je=y(V);R=Z(Je,"Wins: "),p=Z(Je,A),Je.forEach(d),Ue.forEach(d),Re.forEach(d),J=W(X),q=c(X,"P",{});var ct=y(q);L=c(ct,"CANVAS",{width:!0,height:!0,style:!0}),y(L).forEach(d),ct.forEach(d),P=W(X),O=c(X,"DIV",{});var We=y(O);F=c(We,"BUTTON",{class:!0,"data-svelte-h":!0}),ie(F)!=="svelte-18inrs7"&&(F.textContent=te),re=W(We),se=c(We,"BUTTON",{class:!0,"data-svelte-h":!0}),ie(se)!=="svelte-101srf3"&&(se.textContent=ae),We.forEach(d),i=W(X),f=c(X,"DIV",{class:!0});var dt=y(f);j=c(dt,"DIV",{class:!0});var ye=y(j);he=c(ye,"DIV",{"data-svelte-h":!0}),ie(he)!=="svelte-1rfp1m9"&&(he.textContent=Ce),Ie=W(ye),z=c(ye,"DIV",{class:!0});var Ge=y(z);de=c(Ge,"DIV",{"data-svelte-h":!0}),ie(de)!=="svelte-3vvyuo"&&(de.textContent=oe),x=c(Ge,"DIV",{});var Xe=y(x);D=Z(Xe,s[5]),B=Z(Xe," ms"),Xe.forEach(d),Ge.forEach(d),G=W(ye),K=c(ye,"DIV",{class:!0});var ze=y(K);pe=c(ze,"DIV",{"data-svelte-h":!0}),ie(pe)!=="svelte-1slursu"&&(pe.textContent=Pe),_e=c(ze,"DIV",{});var Ke=y(_e);be=Z(Ke,s[6]),Fe=Z(Ke," ms"),Ke.forEach(d),ze.forEach(d),Be=W(ye),Te=c(ye,"DIV",{class:!0});var Qe=y(Te);Se=c(Qe,"DIV",{"data-svelte-h":!0}),ie(Se)!=="svelte-16s3nmm"&&(Se.textContent=lt),ke=c(Qe,"DIV",{});var Ze=y(ke);De=Z(Ze,s[7]),He=Z(Ze," ms"),Ze.forEach(d),Qe.forEach(d),ye.forEach(d),dt.forEach(d),Me=W(X),je=c(X,"P",{});var ut=y(je);fe=c(ut,"CANVAS",{width:!0,height:!0,style:!0}),y(fe).forEach(d),ut.forEach(d),X.forEach(d),this.h()},h(){u(e,"class","player1 svelte-1ay6bd4"),u(b,"class","svelte-1ay6bd4"),u(C,"class","player2 svelte-1ay6bd4"),u(l,"class","scoreboard svelte-1ay6bd4"),u(L,"width",g=s[3].width),u(L,"height",I=s[3].height),ve(L,"background","black"),u(F,"class","game_button svelte-1ay6bd4"),u(se,"class","game_button svelte-1ay6bd4"),u(z,"class","stats-row svelte-1ay6bd4"),u(K,"class","stats-row svelte-1ay6bd4"),u(Te,"class","stats-row svelte-1ay6bd4"),u(j,"class","stats-card svelte-1ay6bd4"),u(f,"class","stats-container svelte-1ay6bd4"),fe.hidden=Ne=!s[2],u(fe,"width",Ae=s[3].width),u(fe,"height",Oe=s[3].height),ve(fe,"background","black"),ve(t,"width","800px"),u(t,"class","cent svelte-1ay6bd4")},m($,X){le($,t,X),n(t,l),n(l,e),n(e,o),n(o,v),n(e,H),n(e,k),n(k,w),n(k,h),n(l,r),n(l,b),n(l,_),n(l,C),n(C,E),n(E,M),n(C,ee),n(C,V),n(V,R),n(V,p),n(t,J),n(t,q),n(q,L),s[13](L),n(t,P),n(t,O),n(O,F),n(O,re),n(O,se),n(t,i),n(t,f),n(f,j),n(j,he),n(j,Ie),n(j,z),n(z,de),n(z,x),n(x,D),n(x,B),n(j,G),n(j,K),n(K,pe),n(K,_e),n(_e,be),n(_e,Fe),n(j,Be),n(j,Te),n(Te,Se),n(Te,ke),n(ke,De),n(ke,He),n(t,Me),n(t,je),n(je,fe),s[14](fe),Ye||(rt=[me(L,"mousemove",s[8]),me(F,"click",s[9]),me(se,"click",s[10])],Ye=!0)},p($,X){X[0]&16&&m!==(m=($[4]?.players?.[$[4]?.p0index]?.user?.name??"...")+"")&&ce(v,m),X[0]&16&&T!==(T=($[4]?.players?.[$[4]?.p0index]?.wins??0)+"")&&ce(h,T),X[0]&16&&N!==(N=($[4]?.players?.[$[4]?.p1index]?.user?.name??"...")+"")&&ce(M,N),X[0]&16&&A!==(A=($[4]?.players?.[$[4]?.p1index]?.wins??0)+"")&&ce(p,A),X[0]&8&&g!==(g=$[3].width)&&u(L,"width",g),X[0]&8&&I!==(I=$[3].height)&&u(L,"height",I),X[0]&32&&ce(D,$[5]),X[0]&64&&ce(be,$[6]),X[0]&128&&ce(De,$[7]),X[0]&4&&Ne!==(Ne=!$[2])&&(fe.hidden=Ne),X[0]&8&&Ae!==(Ae=$[3].width)&&u(fe,"width",Ae),X[0]&8&&Oe!==(Oe=$[3].height)&&u(fe,"height",Oe)},i:Le,o:Le,d($){$&&d(t),s[13](null),s[14](null),Ye=!1,et(rt)}}}function Bt(s,t,l){let e,o,m;we(s,ge,i=>l(22,e=i)),we(s,ue,i=>l(23,o=i)),we(s,ne,i=>l(24,m=i));const v=1e3/60,k=window.location.origin;let w,T,h,r,b,S=!0,_={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},C={ballX:Math.floor(_.width/2),ballY:Math.floor(_.height/2),players:{a:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},b:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}},isRunning:!1,p0index:"a",p1index:"b"},E={...C},N={paddleY:Math.floor(_.height/2)};function M(i){l(3,_={...i})}async function ee(){for(;m=="game room";){await new Promise(i=>setTimeout(i,v));try{if(C.isRunning)if(o.connected){let i=new Uint8Array(Uint16Array.of(N.paddleY).buffer),f=[1,i[0],i[1]];const j=Uint8Array.of(...f);o.wt.send(j)}else{console.error("Connection not ready");continue}}catch(i){console.error("Error in transmit loop",i)}}}function V(){if(m!="game room"){cancelAnimationFrame(b);return}try{R(h,C),R(r,E)}catch(i){console.error("Error in draw loop",i)}b=requestAnimationFrame(V)}function R(i,f){i.clearRect(0,0,w.width,w.height),i.fillStyle="white",i.beginPath(),i.arc(f.ballX,f.ballY,_.ballRadius,0,Math.PI*2),i.fill(),Object.keys(f?.players??{}).length>0&&(i.fillRect(0,f.players[f.p0index]?.paddleY,_.paddleWidth,_.paddleHeight),i.fillRect(w.width-_.paddleWidth,f.players[f.p1index]?.paddleY,_.paddleWidth,_.paddleHeight),i.strokeStyle="white",i.lineWidth=3,i.setLineDash([20,40]),i.beginPath(),i.moveTo(w.width/2,0),i.lineTo(w.width/2,w.height),i.stroke(),i.fillStyle="white",i.font="bold 50px Arial",i.fillText(f.players[f.p0index]?.score?.toString()??"0",w.width/2-70,70,100),i.fillText(f.players[f.p1index]?.score?.toString()??"0",w.width/2+40,70,100)),f.isRunning||(i.fillStyle="white",i.font="bold 50px Arial",i.fillText("▐▐ ",20,80,200))}tt(()=>{h=w.getContext("2d"),r=T.getContext("2d")}),jt(()=>{cancelAnimationFrame(b)});function A(i){const f=w.getBoundingClientRect(),j=i.clientY-f.top-_.paddleHeight/2,he=Math.max(1,Math.min(w.height-_.paddleHeight,j));N.paddleY=he,l(4,C.players[e.id].paddleY=he,C)}function p(){console.log("play/pause ing..."),o.connected?o.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function J(){const i={room_id:e.room.id,user_id:e.id},f=`${k}/leave_room`;console.log("Leaving room...",i,f),fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(j=>j.json()).then(j=>{j.status=="success"&&j.user?.id&&j.room?.id?(console.log("Leave room successful, returning to room list..."),Y(ge,e=j.user,e),Y(ne,m="room list",m)):console.error("Failed to leave room",j)}).catch(j=>{console.error("Error in leave room request",j)})}function q(i){try{i.players[e.id].paddleY=N.paddleY}catch(f){console.error("Error in converting state",f)}l(4,C=i)}let L=0,g=0,I=0;const P=[0],O=[0];let F=Date.now(),te=Date.now();o.addListener("wt",(i,f)=>{C.isRunning&&(F=f.timestamp),q({...f.state})}),o.addListener("ws",(i,f)=>{C.isRunning&&(te=f.timestamp),E={...f.state}}),setInterval(()=>{if(C.isRunning){P.length>40&&P.shift(),O.length>40&&O.shift();const i=Date.now();P.push(i-F),O.push(i-te)}},50),setInterval(()=>{C.isRunning&&(l(5,L=Math.round(P.reduce((i,f)=>i+f,0)/P.length)),l(6,g=Math.round(O.reduce((i,f)=>i+f,0)/O.length)),l(7,I=g-L)),L>3e3&&l(4,C.isRunning=!1,C)},200);function re(){console.log("starting loops"),V(),ee()}ne.subscribe(i=>{i=="game room"&&(M({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),q(e.room.gameState),re())});function se(i){xe[i?"unshift":"push"](()=>{w=i,l(0,w)})}function ae(i){xe[i?"unshift":"push"](()=>{T=i,l(1,T)})}return[w,T,S,_,C,L,g,I,A,p,J,M,q,se,ae]}class Ht extends ot{constructor(t){super(),nt(this,t,Bt,Ft,$e,{setRoomConfig:11,setState:12},null,[-1,-1])}get setRoomConfig(){return this.$$.ctx[11]}get setState(){return this.$$.ctx[12]}}const Ct=globalThis.__sveltekit_atla0p.env??(await Nt(()=>import(globalThis.__sveltekit_atla0p.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function Mt(s){let t,l;return{c(){t=a("h2"),l=Q(s[3])},l(e){t=c(e,"H2",{});var o=y(t);l=Z(o,s[3]),o.forEach(d)},m(e,o){le(e,t,o),n(t,l)},p(e,o){o&8&&ce(l,e[3])},d(e){e&&d(t)}}}function Yt(s){let t,l="PONG",e,o,m,v,H,k,w,T,h=s[2]&&It(s);return{c(){t=a("h1"),t.textContent=l,e=U(),o=a("input"),m=U(),v=a("input"),H=U(),h&&h.c(),k=vt(),this.h()},l(r){t=c(r,"H1",{class:!0,"data-svelte-h":!0}),ie(t)!=="svelte-106hqp2"&&(t.textContent=l),e=W(r),o=c(r,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),m=W(r),v=c(r,"INPUT",{type:!0,class:!0}),H=W(r),h&&h.l(r),k=vt(),this.h()},h(){u(t,"class","svelte-1av3m61"),u(o,"type","text"),u(o,"placeholder","your nickname"),u(o,"autocomplete","off"),u(o,"spellcheck","false"),u(o,"maxlength","20"),u(o,"class","svelte-1av3m61"),u(v,"type","submit"),v.value="Enter",u(v,"class","svelte-1av3m61")},m(r,b){le(r,t,b),le(r,e,b),le(r,o,b),Ee(o,s[1]),le(r,m,b),le(r,v,b),le(r,H,b),h&&h.m(r,b),le(r,k,b),w||(T=[me(o,"input",s[5]),me(v,"click",s[4])],w=!0)},p(r,b){b&2&&o.value!==r[1]&&Ee(o,r[1]),r[2]?h?h.p(r,b):(h=It(r),h.c(),h.m(k.parentNode,k)):h&&(h.d(1),h=null)},d(r){r&&(d(t),d(e),d(o),d(m),d(v),d(H),d(k)),h&&h.d(r),w=!1,et(T)}}}function It(s){let t,l,e;return{c(){t=a("div"),l=a("p"),e=Q(s[2]),this.h()},l(o){t=c(o,"DIV",{class:!0});var m=y(t);l=c(m,"P",{});var v=y(l);e=Z(v,s[2]),v.forEach(d),m.forEach(d),this.h()},h(){u(t,"class","error-message svelte-1av3m61")},m(o,m){le(o,t,m),n(t,l),n(l,e)},p(o,m){m&4&&ce(e,o[2])},d(o){o&&d(t)}}}function qt(s){let t,l,e,o,m,v,H,k,w,T,h,r;function b(E,N){if(E[3]==="login page")return Yt;if(E[3]!=="room list"&&E[3]!=="game room")return Mt}let S=b(s),_=S&&S(s);v=new Lt({});let C={};return T=new Ht({props:C}),s[6](T),{c(){t=a("body"),l=a("div"),_&&_.c(),e=U(),o=a("div"),m=a("div"),ht(v.$$.fragment),k=U(),w=a("div"),ht(T.$$.fragment),this.h()},l(E){t=c(E,"BODY",{class:!0});var N=y(t);l=c(N,"DIV",{class:!0});var M=y(l);_&&_.l(M),M.forEach(d),e=W(N),o=c(N,"DIV",{});var ee=y(o);m=c(ee,"DIV",{class:!0});var V=y(m);ft(v.$$.fragment,V),V.forEach(d),ee.forEach(d),k=W(N),w=c(N,"DIV",{});var R=y(w);ft(T.$$.fragment,R),R.forEach(d),N.forEach(d),this.h()},h(){u(l,"class","cent svelte-1av3m61"),u(m,"class","cent svelte-1av3m61"),o.hidden=H=s[3]!=="room list",w.hidden=h=s[3]!=="game room",u(t,"class","svelte-1av3m61")},m(E,N){le(E,t,N),n(t,l),_&&_.m(l,null),n(t,e),n(t,o),n(o,m),mt(v,m,null),n(t,k),n(t,w),mt(T,w,null),r=!0},p(E,[N]){S===(S=b(E))&&_?_.p(E,N):(_&&_.d(1),_=S&&S(E),_&&(_.c(),_.m(l,null))),(!r||N&8&&H!==(H=E[3]!=="room list"))&&(o.hidden=H);const M={};T.$set(M),(!r||N&8&&h!==(h=E[3]!=="game room"))&&(w.hidden=h)},i(E){r||(pt(v.$$.fragment,E),pt(T.$$.fragment,E),r=!0)},o(E){gt(v.$$.fragment,E),gt(T.$$.fragment,E),r=!1},d(E){E&&d(t),_&&_.d(),_t(v),s[6](null),_t(T)}}}const Jt=1,Gt=2,Xt=3e3,zt=5e3;async function St(s){console.log("waiting for registration...",s);const t=zt,l=new Promise((o,m)=>{const v=setInterval(()=>{s.register_status==="registered"&&(clearInterval(v),o())},100)}),e=new Promise((o,m)=>{setTimeout(()=>{m(new Error("Registration timeout"))},t)});return await Promise.race([l,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(o=>!1)}function kt(s){const l=new TextDecoder("utf-8").decode(s);return JSON.parse(l)}function Kt(s){return new Promise(t=>setTimeout(t,s))}function Qt(s){let t=s.replace(/:/g,"");if(t.length%2!==0)throw new Error("Invalid hex string");let l=new ArrayBuffer(t.length/2),e=new Uint8Array(l);for(let o=0;o<t.length;o+=2)e[o/2]=parseInt(t.substr(o,2),16);return l}function Zt(s,t,l){let e,o,m;we(s,ue,g=>l(9,e=g)),we(s,ne,g=>l(3,o=g)),we(s,ge,g=>l(10,m=g));const v=Ct.PUBLIC_RECONNECT_INTERVAL??3,H=window.location.origin,k=H,w=H,T=H,h=Ct.PUBLIC_HTTP3_CERTIFICATE_FINGERPRINT??"06:B0:F3:64:3A:61:E6:39:82:6F:E5:9E:D5:7E:8D:DC:A0:E6:7C:A9:4E:5D:00:2C:BC:60:13:05:63:1B:3C:78";let r,b="",S=null,_="",C;tt(()=>{S=localStorage.getItem("user_id"),S&&(console.log("logging in with saved user_id...",S),E())}),Rt(()=>{_&&(clearTimeout(C),C=setTimeout(()=>{l(2,_="")},Xt))});function E(){if(!b&&!S){l(2,_="Please enter your nickname");return}const g=`${k}/login`;S=localStorage.getItem("user_id"),console.log(`logging in... name=${b} id=${S} host=${g}`);const I={name:b,id:S??void 0};Y(ne,o="logging in",o),fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)}).then(P=>{if(!P.ok)throw new Error("Network response was not ok");return P.json()}).then(P=>{console.log("logged in with user",P),P.code==200?(Y(ne,o="connecting transport",o),ge.set(P.user),A().then(()=>{localStorage.setItem("user_id",m.id)}).catch(O=>{console.error(O),Y(ne,o="login page",o)})):(l(2,_=P.message??"Error logging in"),localStorage.clear("user_id"),S=null,ge.set(null),Y(ne,o="login page",o))}).catch(P=>{l(2,_=P.message??"Error logging in"),console.error(P),Y(ne,o="login page",o)})}async function N(){if(console.log("connecting transport..."),Y(ne,o="connecting webTransport",o),await p()){if(console.log("connected webtransport"),Y(ne,o="registering webTransport",o),!await M())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),Y(ne,o="connecting webSocket",o),await J()){if(console.log("connected webSocket"),Y(ne,o="registering webSocket",o),!await ee())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return Y(ue,e.connected=!0,e),Y(ne,o="room list",o),2}async function M(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(m.id))),Y(ue,e.wt.register_status="registering",e),await St(e.wt)}async function ee(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(m.id))),Y(ue,e.ws.register_status="registering",e),await St(e.ws)}Y(ue,e.addListener=(g,I)=>{e[g+"_listeners"]==null&&Y(ue,e[g+"_listeners"]=[],e);const P=e[g+"_listeners"].length;return e[g+"_listeners"].push(I),P},e),Y(ue,e.removeListener=(g,I)=>{Y(ue,e[g+"_listeners"]=null,e)},e);function V(g,I){g.register_status==="registering"&&(g.register_status="registered",console.log("register messsage received",g)),e[g.protocol+"_listeners"].forEach(P=>{try{P&&P(g,I)}catch(O){console.error("Error calling listener",O)}})}async function R(g){if(e.connected){console.log("webtransport disconnected, handling...");try{delete e.wt,delete e.ws}catch(I){console.log("error deleting transport",I)}Y(ue,e.connected=!1,e),await A()}}async function A(){for(Y(ne,o="reconnecting",o);;){console.log("reconnecting...");const g=await N();if(g==Jt)console.log("reconnected, but failed registering. returning to login page..."),window.location.href="/";else if(g==Gt){console.log("reconnected"),Y(ne,o="room list",o);break}console.log(`reconnecting again in ${v} sec...`),await Kt(v*1e3)}}async function p(){const g=`${w}/wt`,I=new WebTransport(g,{serverCertificateHashes:[{algorithm:"sha-256",value:Qt(h)}]});if(I.closed.then(()=>{console.log("WebTransport closed",I),R()}).catch(f=>{console.error("WebTransport connection died:",f,I),R()}),console.log("webtransport connecting...",g),!await I.ready.then(()=>(console.log("WebTransport connected",I),!0)).catch(f=>(console.error("WebTransport connection failed:",f),!1)))return!1;const O={protocol:"wt",register_status:"unregistered",transport:I},F=O.transport.datagrams,te=F.writable.getWriter(),re=F.readable.getReader();O.send=f=>{te.write(f)},async function(){for(;;){const{value:f,done:j}=await re.read();if(j){console.log("Done reading datagram, stop reading...",value);return}V(O,kt(f))}}().catch(f=>{console.error("reading datagram failed, stop reading...:",f)});const se=await I.createBidirectionalStream(),ae=se.writable.getWriter(),i=se.readable.getReader();return O.send_reliable=f=>{ae.write(f)},async function(){for(;;){const{value:f,done:j}=await i.read();if(j){console.log("Done reading stream, stop reading...",value);return}V(O,kt(f))}}().catch(f=>{console.error("reading datagram failed, stop reading...:",f)}),Y(ue,e.wt=O,e),!0}async function J(){const g=`${T}/ws`,I=new WebSocket(g);if(console.log("websocket connecting...",g),!await new Promise((F,te)=>{I.onopen=()=>{console.log(I,"WebSocket connected"),F(!0)},I.onerror_message=re=>{console.error("WebSocket error:",re),te(re)}}).catch(F=>(console.error("WebSocket $connection failed:",F),!1)))return!1;const O={protocol:"ws",register_status:"unregistered",transport:I};return O.send_reliable=F=>{O.transport.send(F)},I.addEventListener("message",F=>{V(O,JSON.parse(F.data))}),I.addEventListener("close",F=>{F.wasClean?console.log("WebSocket closed",F):console.error("WebSocket $connection died",F)}),Y(ue,e.ws=O,e),!0}function q(){b=this.value,l(1,b)}function L(g){xe[g?"unshift":"push"](()=>{r=g,l(0,r)})}return[r,b,_,o,E,q,L]}class oo extends ot{constructor(t){super(),nt(this,t,Zt,qt,$e,{})}}export{oo as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}