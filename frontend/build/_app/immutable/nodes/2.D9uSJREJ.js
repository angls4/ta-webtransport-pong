import{s as De,n as Se,r as Oe,e as ve,o as Ue,a as it,f as H,h as ct,b as Ae}from"../chunks/scheduler.CTimOCLo.js";import{S as We,i as Le,g as u,s as L,m as oe,h,j as k,c as V,y as de,n as ne,f as m,k as d,l as _e,a as se,x as l,z as we,A as ue,o as he,B as at,C as dt,r as Je,u as Xe,v as Ge,d as ze,t as Ke,w as Qe,e as Ze}from"../chunks/index.CRnmY6F2.js";import{w as Ve}from"../chunks/index.BXnrS5-F.js";import{_ as ut}from"../chunks/preload-helper.CRk0x-X1.js";function xe(s){return s?.length!==void 0?s:Array.from(s)}const ht={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},ft={id:null,name:"",room:null,player:null},ce=Ve(ht),pe=Ve(ft),te=Ve("login page");function $e(s,t,n){const e=s.slice();return e[21]=t[n],e}function et(s){let t,n,e;return{c(){t=u("div"),n=u("p"),e=oe(s[4]),this.h()},l(o){t=h(o,"DIV",{class:!0});var f=k(t);n=h(f,"P",{});var v=k(n);e=ne(v,s[4]),v.forEach(m),f.forEach(m),this.h()},h(){d(t,"class","error-message svelte-17jni71")},m(o,f){se(o,t,f),l(t,n),l(n,e)},p(o,f){f&16&&he(e,o[4])},d(o){o&&m(t)}}}function tt(s){let t,n,e,o,f=s[21].name+"",v,F,S,w,E=Math.abs(s[21].ballSpeedX)+"",c,i,g,j=Object.keys(s[21].gameState.players).length+"",_,C,T,N,B,Q,U,R,D,p;function q(){return s[13](s[21])}return{c(){t=u("div"),n=u("div"),e=u("div"),o=u("span"),v=oe(f),F=L(),S=u("span"),w=oe("Ball speed : "),c=oe(E),i=L(),g=u("span"),_=oe(j),C=oe("/2 Players"),T=L(),N=u("div"),B=u("button"),Q=oe("JOIN"),R=L(),this.h()},l(Y){t=h(Y,"DIV",{class:!0});var a=k(t);n=h(a,"DIV",{class:!0});var y=k(n);e=h(y,"DIV",{class:!0});var W=k(e);o=h(W,"SPAN",{});var A=k(o);v=ne(A,f),A.forEach(m),W.forEach(m),F=V(y),S=h(y,"SPAN",{class:!0});var O=k(S);w=ne(O,"Ball speed : "),c=ne(O,E),O.forEach(m),i=V(y),g=h(y,"SPAN",{class:!0});var G=k(g);_=ne(G,j),C=ne(G,"/2 Players"),G.forEach(m),y.forEach(m),T=V(a),N=h(a,"DIV",{});var Z=k(N);B=h(Z,"BUTTON",{class:!0});var re=k(B);Q=ne(re,"JOIN"),re.forEach(m),Z.forEach(m),R=V(a),a.forEach(m),this.h()},h(){d(e,"class","room__name svelte-17jni71"),d(S,"class","room__detail svelte-17jni71"),d(g,"class","room__detail svelte-17jni71"),d(n,"class","room__info svelte-17jni71"),d(B,"class","button svelte-17jni71"),B.disabled=U=Object.keys(s[21].gameState.players).length>=2,d(t,"class","room svelte-17jni71")},m(Y,a){se(Y,t,a),l(t,n),l(n,e),l(e,o),l(o,v),l(n,F),l(n,S),l(S,w),l(S,c),l(n,i),l(n,g),l(g,_),l(g,C),l(t,T),l(t,N),l(N,B),l(B,Q),l(t,R),D||(p=ue(B,"click",q),D=!0)},p(Y,a){s=Y,a&1&&f!==(f=s[21].name+"")&&he(v,f),a&1&&E!==(E=Math.abs(s[21].ballSpeedX)+"")&&he(c,E),a&1&&j!==(j=Object.keys(s[21].gameState.players).length+"")&&he(_,j),a&1&&U!==(U=Object.keys(s[21].gameState.players).length>=2)&&(B.disabled=U)},d(Y){Y&&m(t),D=!1,p()}}}function ot(s){let t,n="<span>No rooms available</span>";return{c(){t=u("p"),t.innerHTML=n,this.h()},l(e){t=h(e,"P",{style:!0,"data-svelte-h":!0}),de(t)!=="svelte-156qi2m"&&(t.innerHTML=n),this.h()},h(){_e(t,"color","grey")},m(e,o){se(e,t,o)},d(e){e&&m(t)}}}function mt(s){let t,n,e,o="PONG",f,v,F,S=s[5]?.name+"",w,E,c,i,g,j,_="rename user",C,T,N,B,Q,U,R,D,p,q,Y,a="Create Room",y,W,A,O="Refresh",G,Z,re="",le,ie,r,b,M,ae="credit: angls4",me,Ee,z=s[4]&&et(s),fe=xe(s[0]),x=[];for(let P=0;P<fe.length;P+=1)x[P]=tt($e(s,fe,P));let ee=s[0].length==0&&ot();return{c(){t=u("div"),z&&z.c(),n=L(),e=u("h1"),e.textContent=o,f=L(),v=u("h2"),F=oe("Welcome, "),w=oe(S),E=L(),c=u("div"),i=u("input"),g=L(),j=u("button"),j.textContent=_,C=L(),T=u("br"),N=L(),B=u("br"),Q=L(),U=u("input"),R=L(),D=u("span"),p=u("input"),q=L(),Y=u("button"),Y.textContent=a,y=L(),W=u("p"),A=u("button"),A.textContent=O,G=L(),Z=u("div"),Z.innerHTML=re,le=L(),ie=u("div");for(let P=0;P<x.length;P+=1)x[P].c();r=L(),ee&&ee.c(),b=L(),M=u("p"),M.textContent=ae,this.h()},l(P){t=h(P,"DIV",{class:!0});var I=k(t);z&&z.l(I),n=V(I),e=h(I,"H1",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1jnr5i3"&&(e.textContent=o),f=V(I),v=h(I,"H2",{class:!0});var J=k(v);F=ne(J,"Welcome, "),w=ne(J,S),J.forEach(m),E=V(I),c=h(I,"DIV",{class:!0,style:!0});var $=k(c);i=h($,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),g=V($),j=h($,"BUTTON",{class:!0,"data-svelte-h":!0}),de(j)!=="svelte-5cerf9"&&(j.textContent=_),C=V($),T=h($,"BR",{}),N=V($),B=h($,"BR",{}),Q=V($),U=h($,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),R=V($),D=h($,"SPAN",{});var ge=k(D);p=h(ge,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),q=V(ge),Y=h(ge,"BUTTON",{class:!0,"data-svelte-h":!0}),de(Y)!=="svelte-136z9rb"&&(Y.textContent=a),ge.forEach(m),$.forEach(m),y=V(I),W=h(I,"P",{});var be=k(W);A=h(be,"BUTTON",{class:!0,"data-svelte-h":!0}),de(A)!=="svelte-1nuptru"&&(A.textContent=O),be.forEach(m),G=V(I),Z=h(I,"DIV",{class:!0,"data-svelte-h":!0}),de(Z)!=="svelte-1hf6hku"&&(Z.innerHTML=re),le=V(I),ie=h(I,"DIV",{class:!0});var Te=k(ie);for(let X=0;X<x.length;X+=1)x[X].l(Te);Te.forEach(m),r=V(I),ee&&ee.l(I),I.forEach(m),b=V(P),M=h(P,"P",{style:!0,"data-svelte-h":!0}),de(M)!=="svelte-apo9jk"&&(M.textContent=ae),this.h()},h(){d(e,"class","card__title svelte-17jni71"),d(v,"class","svelte-17jni71"),d(i,"type","text"),d(i,"placeholder","New nickname"),d(i,"maxlength","20"),d(i,"class","svelte-17jni71"),d(j,"class","button-small svelte-17jni71"),d(U,"type","text"),U.required=!0,d(U,"placeholder","Enter room name"),d(U,"maxlength","20"),d(U,"class","svelte-17jni71"),d(p,"type","number"),d(p,"min","0"),d(p,"max","100"),p.required=!0,d(p,"placeholder","Ball speed"),_e(p,"width","100px"),_e(p,"margin-left","0"),_e(p,"margin-right","10px"),d(p,"class","svelte-17jni71"),d(Y,"class","button-small svelte-17jni71"),d(c,"class","room svelte-17jni71"),_e(c,"display","block"),d(A,"class","button svelte-17jni71"),d(Z,"class","card__header svelte-17jni71"),d(ie,"class","room-list svelte-17jni71"),d(t,"class","card svelte-17jni71"),_e(M,"color","white")},m(P,I){se(P,t,I),z&&z.m(t,null),l(t,n),l(t,e),l(t,f),l(t,v),l(v,F),l(v,w),l(t,E),l(t,c),l(c,i),we(i,s[3]),l(c,g),l(c,j),l(c,C),l(c,T),l(c,N),l(c,B),l(c,Q),l(c,U),we(U,s[1]),l(c,R),l(c,D),l(D,p),we(p,s[2]),l(D,q),l(D,Y),l(t,y),l(t,W),l(W,A),l(t,G),l(t,Z),l(t,le),l(t,ie);for(let J=0;J<x.length;J+=1)x[J]&&x[J].m(ie,null);l(t,r),ee&&ee.m(t,null),se(P,b,I),se(P,M,I),me||(Ee=[ue(i,"input",s[10]),ue(j,"click",s[9]),ue(U,"input",s[11]),ue(p,"input",s[12]),ue(Y,"click",s[7]),ue(A,"click",s[6])],me=!0)},p(P,[I]){if(P[4]?z?z.p(P,I):(z=et(P),z.c(),z.m(t,n)):z&&(z.d(1),z=null),I&32&&S!==(S=P[5]?.name+"")&&he(w,S),I&8&&i.value!==P[3]&&we(i,P[3]),I&2&&U.value!==P[1]&&we(U,P[1]),I&4&&at(p.value)!==P[2]&&we(p,P[2]),I&257){fe=xe(P[0]);let J;for(J=0;J<fe.length;J+=1){const $=$e(P,fe,J);x[J]?x[J].p($,I):(x[J]=tt($),x[J].c(),x[J].m(ie,null))}for(;J<x.length;J+=1)x[J].d(1);x.length=fe.length}P[0].length==0?ee||(ee=ot(),ee.c(),ee.m(t,null)):ee&&(ee.d(1),ee=null)},i:Se,o:Se,d(P){P&&(m(t),m(b),m(M)),z&&z.d(),dt(x,P),ee&&ee.d(),me=!1,Oe(Ee)}}}const pt=3e3;function gt(s,t,n){let e,o,f;ve(s,pe,R=>n(5,e=R)),ve(s,te,R=>n(15,o=R)),ve(s,ce,R=>n(16,f=R));const F=window.location.origin;let S=[],w="",E,c=e?.name??"",i="",g;Ue(()=>{te.subscribe(R=>{f.connected&&(e.room?e.room?.id?C(e.room):C({id:e.room}):j())})}),it(()=>{i&&(clearTimeout(g),g=setTimeout(()=>{n(4,i="")},pt))});async function j(){const D=await(await fetch(`${F}/list_room`)).json();D.status=="success"?D.rooms?n(0,S=D.rooms):(console.error("Failed to get rooms",D),n(4,i="Failed to get rooms")):(console.error("Failed to get rooms",D),n(4,i=D.message??"Failed to get rooms")),console.log("room list refreshed",S)}async function _(){if(!w||!E){console.error("Room name and ball speed are required"),n(4,i="Room name and ball speed are required");return}const R={name:w,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:E,ballSpeedY:E},D=`${F}/create_room`;console.log("Creating room...",D,R),await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)}).then(p=>p.json()).then(p=>{console.log("create room",p),p.status=="success"&&p.room?.id?(console.log("Room created successfully, joining...",p.room),C(p.room)):(console.error("Failed to create room",p.message),n(4,i=p.message??"Failed to create room"))}).catch(p=>{console.error("Failed to create room",p),n(4,i=p.message??"Failed to create room")}),console.log("Room created successfully"),j()}async function C(R){console.log("Joining room...",R.id);const D=`${F}/join_room`,p={room_id:R.id,user_id:e.id};await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(q=>q.json()).then(q=>{q.status=="success"&&q.room?.id&&q.user?.id?(console.log("Joined room successfully"),H(pe,e=q.user,e),H(pe,e.room=q.room,e),console.log("Playing room...",R),H(te,o="game room",o)):(console.error("Failed to join room",q),H(pe,e.room=null,e),n(4,i=q.message??"Failed to join room"),j())}).catch(q=>{console.error("Failed to join room",q),n(4,i=q.message??"Failed to join room")})}function T(){if(!c){console.error("Nickname is required"),n(4,i="Nickname is required");return}console.log("Renaming room...",w);const R=`${F}/login`,D={id:e.id,name:c};fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)}).then(p=>p.json()).then(p=>{console.log("rename user",p),p.status=="success"&&p.user?.id?(console.log("User renamed successfully"),H(pe,e=p.user,e)):(console.error("Failed to rename user",p),n(4,i=p.message??"Failed to rename user"))}).catch(p=>{console.error("Failed to rename user",p),n(4,i=p.message??"Failed to rename user")})}function N(){c=this.value,n(3,c)}function B(){w=this.value,n(1,w)}function Q(){E=at(this.value),n(2,E)}return[S,w,E,c,i,e,j,_,C,T,N,B,Q,R=>C(R)]}class _t extends We{constructor(t){super(),Le(this,t,gt,mt,De,{})}}new TextEncoder;function vt(s){let t,n,e,o,f=(s[4]?.players?.[s[4]?.p0index]?.user?.name??"...")+"",v,F,S,w,E=(s[4]?.players?.[s[4]?.p0index]?.wins??0)+"",c,i,g,j="PONG",_,C,T,N=(s[4]?.players?.[s[4]?.p1index]?.user?.name??"...")+"",B,Q,U,R,D=(s[4]?.players?.[s[4]?.p1index]?.wins??0)+"",p,q,Y,a,y,W,A,O,G,Z="play/pause",re,le,ie="leave",r,b,M,ae,me,Ee="latency difference : ",z,fe,x,ee,P,I,J,$,ge,be,Te;return{c(){t=u("div"),n=u("div"),e=u("div"),o=u("h3"),v=oe(f),F=L(),S=u("p"),w=oe("Wins: "),c=oe(E),i=L(),g=u("h1"),g.textContent=j,_=L(),C=u("div"),T=u("h3"),B=oe(N),Q=L(),U=u("p"),R=oe("Wins: "),p=oe(D),q=L(),Y=u("p"),a=u("canvas"),A=L(),O=u("div"),G=u("button"),G.textContent=Z,re=L(),le=u("button"),le.textContent=ie,r=L(),b=u("div"),M=u("div"),ae=u("div"),me=u("div"),me.textContent=Ee,z=u("div"),fe=oe(s[5]),x=oe(" ms"),ee=L(),P=u("p"),I=u("canvas"),this.h()},l(X){t=h(X,"DIV",{style:!0,class:!0});var K=k(t);n=h(K,"DIV",{class:!0});var ye=k(n);e=h(ye,"DIV",{class:!0});var Ce=k(e);o=h(Ce,"H3",{});var Fe=k(o);v=ne(Fe,f),Fe.forEach(m),F=V(Ce),S=h(Ce,"P",{});var Re=k(S);w=ne(Re,"Wins: "),c=ne(Re,E),Re.forEach(m),Ce.forEach(m),i=V(ye),g=h(ye,"H1",{class:!0,"data-svelte-h":!0}),de(g)!=="svelte-106hqp2"&&(g.textContent=j),_=V(ye),C=h(ye,"DIV",{class:!0});var Ie=k(C);T=h(Ie,"H3",{});var Be=k(T);B=ne(Be,N),Be.forEach(m),Q=V(Ie),U=h(Ie,"P",{});var Pe=k(U);R=ne(Pe,"Wins: "),p=ne(Pe,D),Pe.forEach(m),Ie.forEach(m),ye.forEach(m),q=V(K),Y=h(K,"P",{});var Me=k(Y);a=h(Me,"CANVAS",{width:!0,height:!0,style:!0}),k(a).forEach(m),Me.forEach(m),A=V(K),O=h(K,"DIV",{});var ke=k(O);G=h(ke,"BUTTON",{class:!0,"data-svelte-h":!0}),de(G)!=="svelte-18inrs7"&&(G.textContent=Z),re=V(ke),le=h(ke,"BUTTON",{class:!0,"data-svelte-h":!0}),de(le)!=="svelte-101srf3"&&(le.textContent=ie),ke.forEach(m),r=V(K),b=h(K,"DIV",{class:!0});var He=k(b);M=h(He,"DIV",{class:!0});var Ye=k(M);ae=h(Ye,"DIV",{class:!0});var je=k(ae);me=h(je,"DIV",{"data-svelte-h":!0}),de(me)!=="svelte-4lk6wz"&&(me.textContent=Ee),z=h(je,"DIV",{});var Ne=k(z);fe=ne(Ne,s[5]),x=ne(Ne," ms"),Ne.forEach(m),je.forEach(m),Ye.forEach(m),He.forEach(m),ee=V(K),P=h(K,"P",{});var qe=k(P);I=h(qe,"CANVAS",{width:!0,height:!0,style:!0}),k(I).forEach(m),qe.forEach(m),K.forEach(m),this.h()},h(){d(e,"class","player1 svelte-1ay6bd4"),d(g,"class","svelte-1ay6bd4"),d(C,"class","player2 svelte-1ay6bd4"),d(n,"class","scoreboard svelte-1ay6bd4"),d(a,"width",y=s[3].width),d(a,"height",W=s[3].height),_e(a,"background","black"),d(G,"class","game_button svelte-1ay6bd4"),d(le,"class","game_button svelte-1ay6bd4"),d(ae,"class","stats-row svelte-1ay6bd4"),d(M,"class","stats-card svelte-1ay6bd4"),d(b,"class","stats-container svelte-1ay6bd4"),I.hidden=J=!s[2],d(I,"width",$=s[3].width),d(I,"height",ge=s[3].height),_e(I,"background","black"),_e(t,"width","800px"),d(t,"class","cent svelte-1ay6bd4")},m(X,K){se(X,t,K),l(t,n),l(n,e),l(e,o),l(o,v),l(e,F),l(e,S),l(S,w),l(S,c),l(n,i),l(n,g),l(n,_),l(n,C),l(C,T),l(T,B),l(C,Q),l(C,U),l(U,R),l(U,p),l(t,q),l(t,Y),l(Y,a),s[11](a),l(t,A),l(t,O),l(O,G),l(O,re),l(O,le),l(t,r),l(t,b),l(b,M),l(M,ae),l(ae,me),l(ae,z),l(z,fe),l(z,x),l(t,ee),l(t,P),l(P,I),s[12](I),be||(Te=[ue(a,"mousemove",s[6]),ue(G,"click",s[7]),ue(le,"click",s[8])],be=!0)},p(X,K){K[0]&16&&f!==(f=(X[4]?.players?.[X[4]?.p0index]?.user?.name??"...")+"")&&he(v,f),K[0]&16&&E!==(E=(X[4]?.players?.[X[4]?.p0index]?.wins??0)+"")&&he(c,E),K[0]&16&&N!==(N=(X[4]?.players?.[X[4]?.p1index]?.user?.name??"...")+"")&&he(B,N),K[0]&16&&D!==(D=(X[4]?.players?.[X[4]?.p1index]?.wins??0)+"")&&he(p,D),K[0]&8&&y!==(y=X[3].width)&&d(a,"width",y),K[0]&8&&W!==(W=X[3].height)&&d(a,"height",W),K[0]&32&&he(fe,X[5]),K[0]&4&&J!==(J=!X[2])&&(I.hidden=J),K[0]&8&&$!==($=X[3].width)&&d(I,"width",$),K[0]&8&&ge!==(ge=X[3].height)&&d(I,"height",ge)},i:Se,o:Se,d(X){X&&m(t),s[11](null),s[12](null),be=!1,Oe(Te)}}}function wt(s,t,n){let e,o,f;ve(s,pe,r=>n(22,e=r)),ve(s,ce,r=>n(23,o=r)),ve(s,te,r=>n(24,f=r));const v=1e3/60,S=window.location.origin;let w,E,c,i,g,j=!0,_={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},C={ballX:Math.floor(_.width/2),ballY:Math.floor(_.height/2),players:{a:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},b:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}},isRunning:!1,p0index:"a",p1index:"b"},T={...C},N={paddleY:Math.floor(_.height/2)};function B(r){n(3,_={...r})}async function Q(){for(;f=="game room";){await new Promise(r=>setTimeout(r,v));try{if(C.isRunning)if(o.connected){let r=new Uint8Array(Uint16Array.of(N.paddleY).buffer),b=[1,r[0],r[1]];const M=Uint8Array.of(...b);o.wt.send(M)}else{console.error("Connection not ready");continue}}catch(r){console.error("Error in transmit loop",r)}}}function U(){if(f!="game room"){cancelAnimationFrame(g);return}try{R(c,C),R(i,T)}catch(r){console.error("Error in draw loop",r)}g=requestAnimationFrame(U)}function R(r,b){r.clearRect(0,0,w.width,w.height),r.fillStyle="white",r.beginPath(),r.arc(b.ballX,b.ballY,_.ballRadius,0,Math.PI*2),r.fill(),Object.keys(b?.players??{}).length>0&&(r.fillRect(0,b.players[b.p0index]?.paddleY,_.paddleWidth,_.paddleHeight),r.fillRect(w.width-_.paddleWidth,b.players[b.p1index]?.paddleY,_.paddleWidth,_.paddleHeight),r.strokeStyle="white",r.lineWidth=3,r.setLineDash([20,40]),r.beginPath(),r.moveTo(w.width/2,0),r.lineTo(w.width/2,w.height),r.stroke(),r.fillStyle="white",r.font="bold 50px Arial",r.fillText(b.players[b.p0index]?.score?.toString()??"0",w.width/2-70,70,100),r.fillText(b.players[b.p1index]?.score?.toString()??"0",w.width/2+40,70,100)),b.isRunning||(r.fillStyle="white",r.font="bold 50px Arial",r.fillText("▐▐ ",20,80,200))}Ue(()=>{c=w.getContext("2d"),i=E.getContext("2d")}),ct(()=>{cancelAnimationFrame(g)});function D(r){const b=w.getBoundingClientRect(),M=r.clientY-b.top-_.paddleHeight/2,ae=Math.max(1,Math.min(w.height-_.paddleHeight,M));N.paddleY=ae,n(4,C.players[e.id].paddleY=ae,C)}function p(){console.log("play/pause ing..."),o.connected?o.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function q(){const r={room_id:e.room.id,user_id:e.id},b=`${S}/leave_room`;console.log("Leaving room...",r,b),fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(M=>M.json()).then(M=>{M.status=="success"&&M.user?.id&&M.room?.id?(console.log("Leave room successful, returning to room list..."),H(pe,e=M.user,e),H(te,f="room list",f)):console.error("Failed to leave room",M)}).catch(M=>{console.error("Error in leave room request",M)})}function Y(r){try{r.players[e.id].paddleY=N.paddleY}catch(b){console.error("Error in converting state",b)}n(4,C=r)}let a=0,y=0,W=0;const A=[0],O=[0];let G=Date.now(),Z=Date.now();o.addListener("wt",(r,b)=>{C.isRunning&&(G=b.timestamp),Y({...b.state})}),o.addListener("ws",(r,b)=>{C.isRunning&&(Z=b.timestamp),T={...b.state}}),setInterval(()=>{if(C.isRunning){A.length>200&&A.shift(),O.length>200&&O.shift();const r=Date.now();A.push(r-G),O.push(r-Z)}},50),setInterval(()=>{C.isRunning&&(a=Math.round(A.reduce((r,b)=>r+b,0)/A.length),y=Math.round(O.reduce((r,b)=>r+b,0)/O.length),n(5,W=y-a)),a>3e3&&n(4,C.isRunning=!1,C)},200);function re(){console.log("starting loops"),U(),Q()}te.subscribe(r=>{r=="game room"&&(B({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),Y(e.room.gameState),re())});function le(r){Ae[r?"unshift":"push"](()=>{w=r,n(0,w)})}function ie(r){Ae[r?"unshift":"push"](()=>{E=r,n(1,E)})}return[w,E,j,_,C,W,D,p,q,B,Y,le,ie]}class bt extends We{constructor(t){super(),Le(this,t,wt,vt,De,{setRoomConfig:9,setState:10},null,[-1,-1])}get setRoomConfig(){return this.$$.ctx[9]}get setState(){return this.$$.ctx[10]}}const nt=globalThis.__sveltekit_1hm8a1n.env??(await ut(()=>import(globalThis.__sveltekit_1hm8a1n.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function yt(s){let t,n;return{c(){t=u("h2"),n=oe(s[3])},l(e){t=h(e,"H2",{});var o=k(t);n=ne(o,s[3]),o.forEach(m)},m(e,o){se(e,t,o),l(t,n)},p(e,o){o&8&&he(n,e[3])},d(e){e&&m(t)}}}function Et(s){let t,n="PONG",e,o,f,v,F,S,w,E,c=s[2]&&st(s);return{c(){t=u("h1"),t.textContent=n,e=L(),o=u("input"),f=L(),v=u("input"),F=L(),c&&c.c(),S=Ze(),this.h()},l(i){t=h(i,"H1",{class:!0,"data-svelte-h":!0}),de(t)!=="svelte-106hqp2"&&(t.textContent=n),e=V(i),o=h(i,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),f=V(i),v=h(i,"INPUT",{type:!0,class:!0}),F=V(i),c&&c.l(i),S=Ze(),this.h()},h(){d(t,"class","svelte-1av3m61"),d(o,"type","text"),d(o,"placeholder","your nickname"),d(o,"autocomplete","off"),d(o,"spellcheck","false"),d(o,"maxlength","20"),d(o,"class","svelte-1av3m61"),d(v,"type","submit"),v.value="Enter",d(v,"class","svelte-1av3m61")},m(i,g){se(i,t,g),se(i,e,g),se(i,o,g),we(o,s[1]),se(i,f,g),se(i,v,g),se(i,F,g),c&&c.m(i,g),se(i,S,g),w||(E=[ue(o,"input",s[5]),ue(v,"click",s[4])],w=!0)},p(i,g){g&2&&o.value!==i[1]&&we(o,i[1]),i[2]?c?c.p(i,g):(c=st(i),c.c(),c.m(S.parentNode,S)):c&&(c.d(1),c=null)},d(i){i&&(m(t),m(e),m(o),m(f),m(v),m(F),m(S)),c&&c.d(i),w=!1,Oe(E)}}}function st(s){let t,n,e;return{c(){t=u("div"),n=u("p"),e=oe(s[2]),this.h()},l(o){t=h(o,"DIV",{class:!0});var f=k(t);n=h(f,"P",{});var v=k(n);e=ne(v,s[2]),v.forEach(m),f.forEach(m),this.h()},h(){d(t,"class","error-message svelte-1av3m61")},m(o,f){se(o,t,f),l(t,n),l(n,e)},p(o,f){f&4&&he(e,o[2])},d(o){o&&m(t)}}}function Tt(s){let t,n,e,o,f,v,F,S,w,E,c,i;function g(T,N){if(T[3]==="login page")return Et;if(T[3]!=="room list"&&T[3]!=="game room")return yt}let j=g(s),_=j&&j(s);v=new _t({});let C={};return E=new bt({props:C}),s[6](E),{c(){t=u("body"),n=u("div"),_&&_.c(),e=L(),o=u("div"),f=u("div"),Je(v.$$.fragment),S=L(),w=u("div"),Je(E.$$.fragment),this.h()},l(T){t=h(T,"BODY",{class:!0});var N=k(t);n=h(N,"DIV",{class:!0});var B=k(n);_&&_.l(B),B.forEach(m),e=V(N),o=h(N,"DIV",{});var Q=k(o);f=h(Q,"DIV",{class:!0});var U=k(f);Xe(v.$$.fragment,U),U.forEach(m),Q.forEach(m),S=V(N),w=h(N,"DIV",{});var R=k(w);Xe(E.$$.fragment,R),R.forEach(m),N.forEach(m),this.h()},h(){d(n,"class","cent svelte-1av3m61"),d(f,"class","cent svelte-1av3m61"),o.hidden=F=s[3]!=="room list",w.hidden=c=s[3]!=="game room",d(t,"class","svelte-1av3m61")},m(T,N){se(T,t,N),l(t,n),_&&_.m(n,null),l(t,e),l(t,o),l(o,f),Ge(v,f,null),l(t,S),l(t,w),Ge(E,w,null),i=!0},p(T,[N]){j===(j=g(T))&&_?_.p(T,N):(_&&_.d(1),_=j&&j(T),_&&(_.c(),_.m(n,null))),(!i||N&8&&F!==(F=T[3]!=="room list"))&&(o.hidden=F);const B={};E.$set(B),(!i||N&8&&c!==(c=T[3]!=="game room"))&&(w.hidden=c)},i(T){i||(ze(v.$$.fragment,T),ze(E.$$.fragment,T),i=!0)},o(T){Ke(v.$$.fragment,T),Ke(E.$$.fragment,T),i=!1},d(T){T&&m(t),_&&_.d(),Qe(v),s[6](null),Qe(E)}}}const Ct=1,It=2,kt=3e3,St=5e3;async function lt(s){console.log("waiting for registration...",s);const t=St,n=new Promise((o,f)=>{const v=setInterval(()=>{s.register_status==="registered"&&(clearInterval(v),o())},100)}),e=new Promise((o,f)=>{setTimeout(()=>{f(new Error("Registration timeout"))},t)});return await Promise.race([n,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(o=>!1)}function rt(s){const n=new TextDecoder("utf-8").decode(s);return JSON.parse(n)}function Rt(s){return new Promise(t=>setTimeout(t,s))}function Pt(s,t,n){let e,o,f;ve(s,ce,a=>n(9,e=a)),ve(s,te,a=>n(3,o=a)),ve(s,pe,a=>n(10,f=a));const v=nt.PUBLIC_RECONNECT_INTERVAL??3,F=window.location.origin,S=F,w=F,E=F;nt.PUBLIC_HTTP3_CERTIFICATE_FINGERPRINT;let c,i="",g=null,j="",_;Ue(()=>{g=localStorage.getItem("user_id"),g&&(console.log("logging in with saved user_id...",g),C())}),it(()=>{j&&(clearTimeout(_),_=setTimeout(()=>{n(2,j="")},kt))});function C(){if(!i&&!g){n(2,j="Please enter your nickname");return}const a=`${S}/login`;g=localStorage.getItem("user_id"),console.log(`logging in... name=${i} id=${g} host=${a}`);const y={name:i,id:g??void 0};H(te,o="logging in",o),fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).then(W=>{if(!W.ok)throw new Error("Network response was not ok");return W.json()}).then(W=>{console.log("logged in with user",W),W.code==200?(H(te,o="connecting transport",o),pe.set(W.user),R().then(()=>{localStorage.setItem("user_id",f.id)}).catch(A=>{console.error(A),H(te,o="login page",o)})):(n(2,j=W.message??"Error logging in"),localStorage.clear("user_id"),g=null,pe.set(null),H(te,o="login page",o))}).catch(W=>{n(2,j=W.message??"Error logging in"),console.error(W),H(te,o="login page",o)})}async function T(){if(console.log("connecting transport..."),H(te,o="connecting webTransport",o),await D()){if(console.log("connected webtransport"),H(te,o="registering webTransport",o),!await N())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),H(te,o="connecting webSocket",o),await p()){if(console.log("connected webSocket"),H(te,o="registering webSocket",o),!await B())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return H(ce,e.connected=!0,e),H(te,o="room list",o),2}async function N(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(f.id))),H(ce,e.wt.register_status="registering",e),await lt(e.wt)}async function B(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(f.id))),H(ce,e.ws.register_status="registering",e),await lt(e.ws)}H(ce,e.addListener=(a,y)=>{e[a+"_listeners"]==null&&H(ce,e[a+"_listeners"]=[],e);const W=e[a+"_listeners"].length;return e[a+"_listeners"].push(y),W},e),H(ce,e.removeListener=(a,y)=>{H(ce,e[a+"_listeners"]=null,e)},e);function Q(a,y){a.register_status==="registering"&&(a.register_status="registered",console.log("register messsage received",a)),e[a.protocol+"_listeners"].forEach(W=>{try{W&&W(a,y)}catch(A){console.error("Error calling listener",A)}})}async function U(a){if(e.connected){console.log("webtransport disconnected, handling...");try{delete e.wt,delete e.ws}catch(y){console.log("error deleting transport",y)}H(ce,e.connected=!1,e),await R()}}async function R(){for(H(te,o="reconnecting",o);;){console.log("reconnecting...");const a=await T();if(a==Ct)console.log("reconnected, but failed registering. returning to login page..."),window.location.href="/";else if(a==It){console.log("reconnected"),H(te,o="room list",o);break}console.log(`reconnecting again in ${v} sec...`),await Rt(v*1e3)}}async function D(){const a=`${w}/wt`,y=new WebTransport(a);if(y.closed.then(()=>{console.log("WebTransport closed",y),U()}).catch(r=>{console.error("WebTransport connection died:",r,y),U()}),console.log("webtransport connecting...",a),!await y.ready.then(()=>(console.log("WebTransport connected",y),!0)).catch(r=>(console.error("WebTransport connection failed:",r),!1)))return!1;const A={protocol:"wt",register_status:"unregistered",transport:y},O=A.transport.datagrams,G=O.writable.getWriter(),Z=O.readable.getReader();A.send=r=>{G.write(r)},async function(){for(;;){const{value:r,done:b}=await Z.read();if(b){console.log("Done reading datagram, stop reading...",value);return}Q(A,rt(r))}}().catch(r=>{console.error("reading datagram failed, stop reading...:",r)});const re=await y.createBidirectionalStream(),le=re.writable.getWriter(),ie=re.readable.getReader();return A.send_reliable=r=>{le.write(r)},async function(){for(;;){const{value:r,done:b}=await ie.read();if(b){console.log("Done reading stream, stop reading...",value);return}Q(A,rt(r))}}().catch(r=>{console.error("reading datagram failed, stop reading...:",r)}),H(ce,e.wt=A,e),!0}async function p(){const a=`${E}/ws`,y=new WebSocket(a);if(console.log("websocket connecting...",a),!await new Promise((O,G)=>{y.onopen=()=>{console.log(y,"WebSocket connected"),O(!0)},y.onerror_message=Z=>{console.error("WebSocket error:",Z),G(Z)}}).catch(O=>(console.error("WebSocket $connection failed:",O),!1)))return!1;const A={protocol:"ws",register_status:"unregistered",transport:y};return A.send_reliable=O=>{A.transport.send(O)},y.addEventListener("message",O=>{Q(A,JSON.parse(O.data))}),y.addEventListener("close",O=>{O.wasClean?console.log("WebSocket closed",O):console.error("WebSocket $connection died",O)}),H(ce,e.ws=A,e),!0}function q(){i=this.value,n(1,i)}function Y(a){Ae[a?"unshift":"push"](()=>{c=a,n(0,c)})}return[c,i,j,o,C,q,Y]}class Ot extends We{constructor(t){super(),Le(this,t,Pt,Tt,De,{})}}export{Ot as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}