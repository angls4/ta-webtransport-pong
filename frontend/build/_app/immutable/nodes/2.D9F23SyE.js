import{s as De,n as Se,r as Oe,e as ve,o as Ue,a as it,f as Y,h as ct,b as Ae}from"../chunks/scheduler.CTimOCLo.js";import{S as We,i as Le,g as d,s as F,m as oe,h as u,j as k,c as B,y as de,n as ne,f as m,k as c,l as _e,a as le,x as l,z as we,A as ue,o as he,B as at,C as dt,r as Je,u as Ge,v as Xe,d as ze,t as Ke,w as Qe,e as Ze}from"../chunks/index.CRnmY6F2.js";import{w as Ve}from"../chunks/index.BXnrS5-F.js";import{_ as ut}from"../chunks/preload-helper.CRk0x-X1.js";function xe(s){return s?.length!==void 0?s:Array.from(s)}const ht={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},ft={id:null,name:"",room:null,player:null},ce=Ve(ht),ge=Ve(ft),te=Ve("login page");function $e(s,t,n){const e=s.slice();return e[21]=t[n],e}function et(s){let t,n,e;return{c(){t=d("div"),n=d("p"),e=oe(s[4]),this.h()},l(o){t=u(o,"DIV",{class:!0});var f=k(t);n=u(f,"P",{});var v=k(n);e=ne(v,s[4]),v.forEach(m),f.forEach(m),this.h()},h(){c(t,"class","error-message svelte-17jni71")},m(o,f){le(o,t,f),l(t,n),l(n,e)},p(o,f){f&16&&he(e,o[4])},d(o){o&&m(t)}}}function tt(s){let t,n,e,o,f=s[21].name+"",v,H,R,w,E=Math.abs(s[21].ballSpeedX)+"",a,r,b,S=Object.keys(s[21].gameState.players).length+"",_,T,y,A,M,Z,U,P,D,g;function J(){return s[13](s[21])}return{c(){t=d("div"),n=d("div"),e=d("div"),o=d("span"),v=oe(f),H=F(),R=d("span"),w=oe("Ball speed : "),a=oe(E),r=F(),b=d("span"),_=oe(S),T=oe("/2 Players"),y=F(),A=d("div"),M=d("button"),Z=oe("JOIN"),P=F(),this.h()},l(q){t=u(q,"DIV",{class:!0});var L=k(t);n=u(L,"DIV",{class:!0});var p=k(n);e=u(p,"DIV",{class:!0});var C=k(e);o=u(C,"SPAN",{});var j=k(o);v=ne(j,f),j.forEach(m),C.forEach(m),H=B(p),R=u(p,"SPAN",{class:!0});var O=k(R);w=ne(O,"Ball speed : "),a=ne(O,E),O.forEach(m),r=B(p),b=u(p,"SPAN",{class:!0});var W=k(b);_=ne(W,S),T=ne(W,"/2 Players"),W.forEach(m),p.forEach(m),y=B(L),A=u(L,"DIV",{});var x=k(A);M=u(x,"BUTTON",{class:!0});var re=k(M);Z=ne(re,"JOIN"),re.forEach(m),x.forEach(m),P=B(L),L.forEach(m),this.h()},h(){c(e,"class","room__name svelte-17jni71"),c(R,"class","room__detail svelte-17jni71"),c(b,"class","room__detail svelte-17jni71"),c(n,"class","room__info svelte-17jni71"),c(M,"class","button svelte-17jni71"),M.disabled=U=Object.keys(s[21].gameState.players).length>=2,c(t,"class","room svelte-17jni71")},m(q,L){le(q,t,L),l(t,n),l(n,e),l(e,o),l(o,v),l(n,H),l(n,R),l(R,w),l(R,a),l(n,r),l(n,b),l(b,_),l(b,T),l(t,y),l(t,A),l(A,M),l(M,Z),l(t,P),D||(g=ue(M,"click",J),D=!0)},p(q,L){s=q,L&1&&f!==(f=s[21].name+"")&&he(v,f),L&1&&E!==(E=Math.abs(s[21].ballSpeedX)+"")&&he(a,E),L&1&&S!==(S=Object.keys(s[21].gameState.players).length+"")&&he(_,S),L&1&&U!==(U=Object.keys(s[21].gameState.players).length>=2)&&(M.disabled=U)},d(q){q&&m(t),D=!1,g()}}}function ot(s){let t,n="<span>No rooms available</span>";return{c(){t=d("p"),t.innerHTML=n,this.h()},l(e){t=u(e,"P",{style:!0,"data-svelte-h":!0}),de(t)!=="svelte-156qi2m"&&(t.innerHTML=n),this.h()},h(){_e(t,"color","grey")},m(e,o){le(e,t,o)},d(e){e&&m(t)}}}function mt(s){let t,n,e,o="PONG",f,v,H,R=s[5]?.name+"",w,E,a,r,b,S,_="rename user",T,y,A,M,Z,U,P,D,g,J,q,L="Create Room",p,C,j,O="Refresh",W,x,re="",se,ie,i,h,V,ae="credit: angls4",me,Ee,z=s[4]&&et(s),fe=xe(s[0]),Q=[];for(let N=0;N<fe.length;N+=1)Q[N]=tt($e(s,fe,N));let ee=s[0].length==0&&ot();return{c(){t=d("div"),z&&z.c(),n=F(),e=d("h1"),e.textContent=o,f=F(),v=d("h2"),H=oe("Welcome, "),w=oe(R),E=F(),a=d("div"),r=d("input"),b=F(),S=d("button"),S.textContent=_,T=F(),y=d("br"),A=F(),M=d("br"),Z=F(),U=d("input"),P=F(),D=d("span"),g=d("input"),J=F(),q=d("button"),q.textContent=L,p=F(),C=d("p"),j=d("button"),j.textContent=O,W=F(),x=d("div"),x.innerHTML=re,se=F(),ie=d("div");for(let N=0;N<Q.length;N+=1)Q[N].c();i=F(),ee&&ee.c(),h=F(),V=d("p"),V.textContent=ae,this.h()},l(N){t=u(N,"DIV",{class:!0});var I=k(t);z&&z.l(I),n=B(I),e=u(I,"H1",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1jnr5i3"&&(e.textContent=o),f=B(I),v=u(I,"H2",{class:!0});var G=k(v);H=ne(G,"Welcome, "),w=ne(G,R),G.forEach(m),E=B(I),a=u(I,"DIV",{class:!0,style:!0});var $=k(a);r=u($,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),b=B($),S=u($,"BUTTON",{class:!0,"data-svelte-h":!0}),de(S)!=="svelte-5cerf9"&&(S.textContent=_),T=B($),y=u($,"BR",{}),A=B($),M=u($,"BR",{}),Z=B($),U=u($,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),P=B($),D=u($,"SPAN",{});var pe=k(D);g=u(pe,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),J=B(pe),q=u(pe,"BUTTON",{class:!0,"data-svelte-h":!0}),de(q)!=="svelte-136z9rb"&&(q.textContent=L),pe.forEach(m),$.forEach(m),p=B(I),C=u(I,"P",{});var be=k(C);j=u(be,"BUTTON",{class:!0,"data-svelte-h":!0}),de(j)!=="svelte-1nuptru"&&(j.textContent=O),be.forEach(m),W=B(I),x=u(I,"DIV",{class:!0,"data-svelte-h":!0}),de(x)!=="svelte-1hf6hku"&&(x.innerHTML=re),se=B(I),ie=u(I,"DIV",{class:!0});var Te=k(ie);for(let X=0;X<Q.length;X+=1)Q[X].l(Te);Te.forEach(m),i=B(I),ee&&ee.l(I),I.forEach(m),h=B(N),V=u(N,"P",{style:!0,"data-svelte-h":!0}),de(V)!=="svelte-apo9jk"&&(V.textContent=ae),this.h()},h(){c(e,"class","card__title svelte-17jni71"),c(v,"class","svelte-17jni71"),c(r,"type","text"),c(r,"placeholder","New nickname"),c(r,"maxlength","20"),c(r,"class","svelte-17jni71"),c(S,"class","button-small svelte-17jni71"),c(U,"type","text"),U.required=!0,c(U,"placeholder","Enter room name"),c(U,"maxlength","20"),c(U,"class","svelte-17jni71"),c(g,"type","number"),c(g,"min","0"),c(g,"max","100"),g.required=!0,c(g,"placeholder","Ball speed"),_e(g,"width","100px"),_e(g,"margin-left","0"),_e(g,"margin-right","10px"),c(g,"class","svelte-17jni71"),c(q,"class","button-small svelte-17jni71"),c(a,"class","room svelte-17jni71"),_e(a,"display","block"),c(j,"class","button svelte-17jni71"),c(x,"class","card__header svelte-17jni71"),c(ie,"class","room-list svelte-17jni71"),c(t,"class","card svelte-17jni71"),_e(V,"color","white")},m(N,I){le(N,t,I),z&&z.m(t,null),l(t,n),l(t,e),l(t,f),l(t,v),l(v,H),l(v,w),l(t,E),l(t,a),l(a,r),we(r,s[3]),l(a,b),l(a,S),l(a,T),l(a,y),l(a,A),l(a,M),l(a,Z),l(a,U),we(U,s[1]),l(a,P),l(a,D),l(D,g),we(g,s[2]),l(D,J),l(D,q),l(t,p),l(t,C),l(C,j),l(t,W),l(t,x),l(t,se),l(t,ie);for(let G=0;G<Q.length;G+=1)Q[G]&&Q[G].m(ie,null);l(t,i),ee&&ee.m(t,null),le(N,h,I),le(N,V,I),me||(Ee=[ue(r,"input",s[10]),ue(S,"click",s[9]),ue(U,"input",s[11]),ue(g,"input",s[12]),ue(q,"click",s[7]),ue(j,"click",s[6])],me=!0)},p(N,[I]){if(N[4]?z?z.p(N,I):(z=et(N),z.c(),z.m(t,n)):z&&(z.d(1),z=null),I&32&&R!==(R=N[5]?.name+"")&&he(w,R),I&8&&r.value!==N[3]&&we(r,N[3]),I&2&&U.value!==N[1]&&we(U,N[1]),I&4&&at(g.value)!==N[2]&&we(g,N[2]),I&257){fe=xe(N[0]);let G;for(G=0;G<fe.length;G+=1){const $=$e(N,fe,G);Q[G]?Q[G].p($,I):(Q[G]=tt($),Q[G].c(),Q[G].m(ie,null))}for(;G<Q.length;G+=1)Q[G].d(1);Q.length=fe.length}N[0].length==0?ee||(ee=ot(),ee.c(),ee.m(t,null)):ee&&(ee.d(1),ee=null)},i:Se,o:Se,d(N){N&&(m(t),m(h),m(V)),z&&z.d(),dt(Q,N),ee&&ee.d(),me=!1,Oe(Ee)}}}const gt=3e3;function pt(s,t,n){let e,o,f;ve(s,ge,P=>n(5,e=P)),ve(s,te,P=>n(15,o=P)),ve(s,ce,P=>n(16,f=P));const H=window.location.origin;let R=[],w="",E,a=e?.name??"",r="",b;Ue(()=>{te.subscribe(P=>{f.connected&&(e.room?e.room?.id?T(e.room):T({id:e.room}):S())})}),it(()=>{r&&(clearTimeout(b),b=setTimeout(()=>{n(4,r="")},gt))});async function S(){const D=await(await fetch(`${H}/list_room`)).json();D.status=="success"?D.rooms?n(0,R=D.rooms):(console.error("Failed to get rooms",D),n(4,r="Failed to get rooms")):(console.error("Failed to get rooms",D),n(4,r=D.message??"Failed to get rooms")),console.log("room list refreshed",R)}async function _(){if(!w||!E){console.error("Room name and ball speed are required"),n(4,r="Room name and ball speed are required");return}const P={name:w,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:E,ballSpeedY:E},D=`${H}/create_room`;console.log("Creating room...",D,P),await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)}).then(g=>g.json()).then(g=>{console.log("create room",g),g.status=="success"&&g.room?.id?(console.log("Room created successfully, joining...",g.room),T(g.room)):(console.error("Failed to create room",g.message),n(4,r=g.message??"Failed to create room"))}).catch(g=>{console.error("Failed to create room",g),n(4,r=g.message??"Failed to create room")}),console.log("Room created successfully"),S()}async function T(P){console.log("Joining room...",P.id);const D=`${H}/join_room`,g={room_id:P.id,user_id:e.id};await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}).then(J=>J.json()).then(J=>{J.status=="success"&&J.room?.id&&J.user?.id?(console.log("Joined room successfully"),Y(ge,e=J.user,e),Y(ge,e.room=J.room,e),console.log("Playing room...",P),Y(te,o="game room",o)):(console.error("Failed to join room",J),Y(ge,e.room=null,e),n(4,r=J.message??"Failed to join room"),S())}).catch(J=>{console.error("Failed to join room",J),n(4,r=J.message??"Failed to join room")})}function y(){if(!a){console.error("Nickname is required"),n(4,r="Nickname is required");return}console.log("Renaming room...",w);const P=`${H}/login`,D={id:e.id,name:a};fetch(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)}).then(g=>g.json()).then(g=>{console.log("rename user",g),g.status=="success"&&g.user?.id?(console.log("User renamed successfully"),Y(ge,e=g.user,e)):(console.error("Failed to rename user",g),n(4,r=g.message??"Failed to rename user"))}).catch(g=>{console.error("Failed to rename user",g),n(4,r=g.message??"Failed to rename user")})}function A(){a=this.value,n(3,a)}function M(){w=this.value,n(1,w)}function Z(){E=at(this.value),n(2,E)}return[R,w,E,a,r,e,S,_,T,y,A,M,Z,P=>T(P)]}class _t extends We{constructor(t){super(),Le(this,t,pt,mt,De,{})}}new TextEncoder;function vt(s){let t,n,e,o,f=(s[4]?.players?.[s[4]?.p0index]?.user?.name??"...")+"",v,H,R,w,E=(s[4]?.players?.[s[4]?.p0index]?.wins??0)+"",a,r,b,S="PONG",_,T,y,A=(s[4]?.players?.[s[4]?.p1index]?.user?.name??"...")+"",M,Z,U,P,D=(s[4]?.players?.[s[4]?.p1index]?.wins??0)+"",g,J,q,L,p,C,j,O,W,x="play/pause",re,se,ie="leave",i,h,V,ae,me,Ee="latency difference : ",z,fe,Q,ee,N,I,G,$,pe,be,Te;return{c(){t=d("div"),n=d("div"),e=d("div"),o=d("h3"),v=oe(f),H=F(),R=d("p"),w=oe("Wins: "),a=oe(E),r=F(),b=d("h1"),b.textContent=S,_=F(),T=d("div"),y=d("h3"),M=oe(A),Z=F(),U=d("p"),P=oe("Wins: "),g=oe(D),J=F(),q=d("p"),L=d("canvas"),j=F(),O=d("div"),W=d("button"),W.textContent=x,re=F(),se=d("button"),se.textContent=ie,i=F(),h=d("div"),V=d("div"),ae=d("div"),me=d("div"),me.textContent=Ee,z=d("div"),fe=oe(s[5]),Q=oe(" ms"),ee=F(),N=d("p"),I=d("canvas"),this.h()},l(X){t=u(X,"DIV",{style:!0,class:!0});var K=k(t);n=u(K,"DIV",{class:!0});var ye=k(n);e=u(ye,"DIV",{class:!0});var Ce=k(e);o=u(Ce,"H3",{});var Fe=k(o);v=ne(Fe,f),Fe.forEach(m),H=B(Ce),R=u(Ce,"P",{});var Re=k(R);w=ne(Re,"Wins: "),a=ne(Re,E),Re.forEach(m),Ce.forEach(m),r=B(ye),b=u(ye,"H1",{class:!0,"data-svelte-h":!0}),de(b)!=="svelte-106hqp2"&&(b.textContent=S),_=B(ye),T=u(ye,"DIV",{class:!0});var Ie=k(T);y=u(Ie,"H3",{});var Be=k(y);M=ne(Be,A),Be.forEach(m),Z=B(Ie),U=u(Ie,"P",{});var Pe=k(U);P=ne(Pe,"Wins: "),g=ne(Pe,D),Pe.forEach(m),Ie.forEach(m),ye.forEach(m),J=B(K),q=u(K,"P",{});var He=k(q);L=u(He,"CANVAS",{width:!0,height:!0,style:!0}),k(L).forEach(m),He.forEach(m),j=B(K),O=u(K,"DIV",{});var ke=k(O);W=u(ke,"BUTTON",{class:!0,"data-svelte-h":!0}),de(W)!=="svelte-18inrs7"&&(W.textContent=x),re=B(ke),se=u(ke,"BUTTON",{class:!0,"data-svelte-h":!0}),de(se)!=="svelte-101srf3"&&(se.textContent=ie),ke.forEach(m),i=B(K),h=u(K,"DIV",{class:!0});var Me=k(h);V=u(Me,"DIV",{class:!0});var Ye=k(V);ae=u(Ye,"DIV",{class:!0});var je=k(ae);me=u(je,"DIV",{"data-svelte-h":!0}),de(me)!=="svelte-4lk6wz"&&(me.textContent=Ee),z=u(je,"DIV",{});var Ne=k(z);fe=ne(Ne,s[5]),Q=ne(Ne," ms"),Ne.forEach(m),je.forEach(m),Ye.forEach(m),Me.forEach(m),ee=B(K),N=u(K,"P",{});var qe=k(N);I=u(qe,"CANVAS",{width:!0,height:!0,style:!0}),k(I).forEach(m),qe.forEach(m),K.forEach(m),this.h()},h(){c(e,"class","player1 svelte-1ay6bd4"),c(b,"class","svelte-1ay6bd4"),c(T,"class","player2 svelte-1ay6bd4"),c(n,"class","scoreboard svelte-1ay6bd4"),c(L,"width",p=s[3].width),c(L,"height",C=s[3].height),_e(L,"background","black"),c(W,"class","game_button svelte-1ay6bd4"),c(se,"class","game_button svelte-1ay6bd4"),c(ae,"class","stats-row svelte-1ay6bd4"),c(V,"class","stats-card svelte-1ay6bd4"),c(h,"class","stats-container svelte-1ay6bd4"),I.hidden=G=!s[2],c(I,"width",$=s[3].width),c(I,"height",pe=s[3].height),_e(I,"background","black"),_e(t,"width","800px"),c(t,"class","cent svelte-1ay6bd4")},m(X,K){le(X,t,K),l(t,n),l(n,e),l(e,o),l(o,v),l(e,H),l(e,R),l(R,w),l(R,a),l(n,r),l(n,b),l(n,_),l(n,T),l(T,y),l(y,M),l(T,Z),l(T,U),l(U,P),l(U,g),l(t,J),l(t,q),l(q,L),s[11](L),l(t,j),l(t,O),l(O,W),l(O,re),l(O,se),l(t,i),l(t,h),l(h,V),l(V,ae),l(ae,me),l(ae,z),l(z,fe),l(z,Q),l(t,ee),l(t,N),l(N,I),s[12](I),be||(Te=[ue(L,"mousemove",s[6]),ue(W,"click",s[7]),ue(se,"click",s[8])],be=!0)},p(X,K){K[0]&16&&f!==(f=(X[4]?.players?.[X[4]?.p0index]?.user?.name??"...")+"")&&he(v,f),K[0]&16&&E!==(E=(X[4]?.players?.[X[4]?.p0index]?.wins??0)+"")&&he(a,E),K[0]&16&&A!==(A=(X[4]?.players?.[X[4]?.p1index]?.user?.name??"...")+"")&&he(M,A),K[0]&16&&D!==(D=(X[4]?.players?.[X[4]?.p1index]?.wins??0)+"")&&he(g,D),K[0]&8&&p!==(p=X[3].width)&&c(L,"width",p),K[0]&8&&C!==(C=X[3].height)&&c(L,"height",C),K[0]&32&&he(fe,X[5]),K[0]&4&&G!==(G=!X[2])&&(I.hidden=G),K[0]&8&&$!==($=X[3].width)&&c(I,"width",$),K[0]&8&&pe!==(pe=X[3].height)&&c(I,"height",pe)},i:Se,o:Se,d(X){X&&m(t),s[11](null),s[12](null),be=!1,Oe(Te)}}}function wt(s,t,n){let e,o,f;ve(s,ge,i=>n(22,e=i)),ve(s,ce,i=>n(23,o=i)),ve(s,te,i=>n(24,f=i));const v=1e3/60,R=window.location.origin;let w,E,a,r,b,S=!0,_={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},T={ballX:Math.floor(_.width/2),ballY:Math.floor(_.height/2),players:{a:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},b:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}},isRunning:!1,p0index:"a",p1index:"b"},y={...T},A={paddleY:Math.floor(_.height/2)};function M(i){n(3,_={...i})}async function Z(){for(;f=="game room";){await new Promise(i=>setTimeout(i,v));try{if(T.isRunning)if(o.connected){let i=new Uint8Array(Uint16Array.of(A.paddleY).buffer),h=[1,i[0],i[1]];const V=Uint8Array.of(...h);o.wt.send(V)}else{console.error("Connection not ready");continue}}catch(i){console.error("Error in transmit loop",i)}}}function U(){if(f!="game room"){cancelAnimationFrame(b);return}try{P(a,T),P(r,y)}catch(i){console.error("Error in draw loop",i)}b=requestAnimationFrame(U)}function P(i,h){i.clearRect(0,0,w.width,w.height),i.fillStyle="white",i.beginPath(),i.arc(h.ballX,h.ballY,_.ballRadius,0,Math.PI*2),i.fill(),Object.keys(h?.players??{}).length>0&&(i.fillRect(0,h.players[h.p0index]?.paddleY,_.paddleWidth,_.paddleHeight),i.fillRect(w.width-_.paddleWidth,h.players[h.p1index]?.paddleY,_.paddleWidth,_.paddleHeight),i.strokeStyle="white",i.lineWidth=3,i.setLineDash([20,40]),i.beginPath(),i.moveTo(w.width/2,0),i.lineTo(w.width/2,w.height),i.stroke(),i.fillStyle="white",i.font="bold 50px Arial",i.fillText(h.players[h.p0index]?.score?.toString()??"0",w.width/2-70,70,100),i.fillText(h.players[h.p1index]?.score?.toString()??"0",w.width/2+40,70,100)),h.isRunning||(i.fillStyle="white",i.font="bold 50px Arial",i.fillText("▐▐ ",20,80,200))}Ue(()=>{a=w.getContext("2d"),r=E.getContext("2d")}),ct(()=>{cancelAnimationFrame(b)});function D(i){const h=w.getBoundingClientRect(),V=i.clientY-h.top-_.paddleHeight/2,ae=Math.max(1,Math.min(w.height-_.paddleHeight,V));A.paddleY=ae,n(4,T.players[e.id].paddleY=ae,T)}function g(){console.log("play/pause ing..."),o.connected?o.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function J(){const i={room_id:e.room.id,user_id:e.id},h=`${R}/leave_room`;console.log("Leaving room...",i,h),fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(V=>V.json()).then(V=>{V.status=="success"&&V.user?.id&&V.room?.id?(console.log("Leave room successful, returning to room list..."),Y(ge,e=V.user,e),Y(te,f="room list",f)):console.error("Failed to leave room",V)}).catch(V=>{console.error("Error in leave room request",V)})}function q(i){try{i.players[e.id].paddleY=A.paddleY}catch(h){console.error("Error in converting state",h)}n(4,T=i)}let L=0,p=0,C=0;const j=[0],O=[0];let W=Date.now(),x=Date.now();o.addListener("wt",(i,h)=>{T.isRunning&&(W=h.timestamp),q({...h.state})}),o.addListener("ws",(i,h)=>{T.isRunning&&(x=h.timestamp),y={...h.state}}),setInterval(()=>{if(T.isRunning){j.length>200&&j.shift(),O.length>200&&O.shift();const i=Date.now();j.push(i-W),O.push(i-x)}},50),setInterval(()=>{T.isRunning&&(L=Math.round(j.reduce((i,h)=>i+h,0)/j.length),p=Math.round(O.reduce((i,h)=>i+h,0)/O.length),n(5,C=p-L)),L>3e3&&n(4,T.isRunning=!1,T)},200);function re(){console.log("starting loops"),U(),Z()}te.subscribe(i=>{i=="game room"&&(M({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),q(e.room.gameState),re())});function se(i){Ae[i?"unshift":"push"](()=>{w=i,n(0,w)})}function ie(i){Ae[i?"unshift":"push"](()=>{E=i,n(1,E)})}return[w,E,S,_,T,C,D,g,J,M,q,se,ie]}class bt extends We{constructor(t){super(),Le(this,t,wt,vt,De,{setRoomConfig:9,setState:10},null,[-1,-1])}get setRoomConfig(){return this.$$.ctx[9]}get setState(){return this.$$.ctx[10]}}const nt=globalThis.__sveltekit_1wva3y6.env??(await ut(()=>import(globalThis.__sveltekit_1wva3y6.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function yt(s){let t,n;return{c(){t=d("h2"),n=oe(s[3])},l(e){t=u(e,"H2",{});var o=k(t);n=ne(o,s[3]),o.forEach(m)},m(e,o){le(e,t,o),l(t,n)},p(e,o){o&8&&he(n,e[3])},d(e){e&&m(t)}}}function Et(s){let t,n="PONG",e,o,f,v,H,R,w,E,a=s[2]&&st(s);return{c(){t=d("h1"),t.textContent=n,e=F(),o=d("input"),f=F(),v=d("input"),H=F(),a&&a.c(),R=Ze(),this.h()},l(r){t=u(r,"H1",{class:!0,"data-svelte-h":!0}),de(t)!=="svelte-106hqp2"&&(t.textContent=n),e=B(r),o=u(r,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),f=B(r),v=u(r,"INPUT",{type:!0,class:!0}),H=B(r),a&&a.l(r),R=Ze(),this.h()},h(){c(t,"class","svelte-1av3m61"),c(o,"type","text"),c(o,"placeholder","your nickname"),c(o,"autocomplete","off"),c(o,"spellcheck","false"),c(o,"maxlength","20"),c(o,"class","svelte-1av3m61"),c(v,"type","submit"),v.value="Enter",c(v,"class","svelte-1av3m61")},m(r,b){le(r,t,b),le(r,e,b),le(r,o,b),we(o,s[1]),le(r,f,b),le(r,v,b),le(r,H,b),a&&a.m(r,b),le(r,R,b),w||(E=[ue(o,"input",s[5]),ue(v,"click",s[4])],w=!0)},p(r,b){b&2&&o.value!==r[1]&&we(o,r[1]),r[2]?a?a.p(r,b):(a=st(r),a.c(),a.m(R.parentNode,R)):a&&(a.d(1),a=null)},d(r){r&&(m(t),m(e),m(o),m(f),m(v),m(H),m(R)),a&&a.d(r),w=!1,Oe(E)}}}function st(s){let t,n,e;return{c(){t=d("div"),n=d("p"),e=oe(s[2]),this.h()},l(o){t=u(o,"DIV",{class:!0});var f=k(t);n=u(f,"P",{});var v=k(n);e=ne(v,s[2]),v.forEach(m),f.forEach(m),this.h()},h(){c(t,"class","error-message svelte-1av3m61")},m(o,f){le(o,t,f),l(t,n),l(n,e)},p(o,f){f&4&&he(e,o[2])},d(o){o&&m(t)}}}function Tt(s){let t,n,e,o,f,v,H,R,w,E,a,r;function b(y,A){if(y[3]==="login page")return Et;if(y[3]!=="room list"&&y[3]!=="game room")return yt}let S=b(s),_=S&&S(s);v=new _t({});let T={};return E=new bt({props:T}),s[6](E),{c(){t=d("body"),n=d("div"),_&&_.c(),e=F(),o=d("div"),f=d("div"),Je(v.$$.fragment),R=F(),w=d("div"),Je(E.$$.fragment),this.h()},l(y){t=u(y,"BODY",{class:!0});var A=k(t);n=u(A,"DIV",{class:!0});var M=k(n);_&&_.l(M),M.forEach(m),e=B(A),o=u(A,"DIV",{});var Z=k(o);f=u(Z,"DIV",{class:!0});var U=k(f);Ge(v.$$.fragment,U),U.forEach(m),Z.forEach(m),R=B(A),w=u(A,"DIV",{});var P=k(w);Ge(E.$$.fragment,P),P.forEach(m),A.forEach(m),this.h()},h(){c(n,"class","cent svelte-1av3m61"),c(f,"class","cent svelte-1av3m61"),o.hidden=H=s[3]!=="room list",w.hidden=a=s[3]!=="game room",c(t,"class","svelte-1av3m61")},m(y,A){le(y,t,A),l(t,n),_&&_.m(n,null),l(t,e),l(t,o),l(o,f),Xe(v,f,null),l(t,R),l(t,w),Xe(E,w,null),r=!0},p(y,[A]){S===(S=b(y))&&_?_.p(y,A):(_&&_.d(1),_=S&&S(y),_&&(_.c(),_.m(n,null))),(!r||A&8&&H!==(H=y[3]!=="room list"))&&(o.hidden=H);const M={};E.$set(M),(!r||A&8&&a!==(a=y[3]!=="game room"))&&(w.hidden=a)},i(y){r||(ze(v.$$.fragment,y),ze(E.$$.fragment,y),r=!0)},o(y){Ke(v.$$.fragment,y),Ke(E.$$.fragment,y),r=!1},d(y){y&&m(t),_&&_.d(),Qe(v),s[6](null),Qe(E)}}}const Ct=1,It=2,kt=3e3,St=5e3;async function lt(s){console.log("waiting for registration...",s);const t=St,n=new Promise((o,f)=>{const v=setInterval(()=>{s.register_status==="registered"&&(clearInterval(v),o())},100)}),e=new Promise((o,f)=>{setTimeout(()=>{f(new Error("Registration timeout"))},t)});return await Promise.race([n,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(o=>!1)}function rt(s){const n=new TextDecoder("utf-8").decode(s);return JSON.parse(n)}function Rt(s){return new Promise(t=>setTimeout(t,s))}function Pt(s){let t=s.replace(/:/g,"");if(t.length%2!==0)throw new Error("Invalid hex string");let n=new ArrayBuffer(t.length/2),e=new Uint8Array(n);for(let o=0;o<t.length;o+=2)e[o/2]=parseInt(t.substr(o,2),16);return n}function jt(s,t,n){let e,o,f;ve(s,ce,p=>n(9,e=p)),ve(s,te,p=>n(3,o=p)),ve(s,ge,p=>n(10,f=p));const v=nt.PUBLIC_RECONNECT_INTERVAL??3,H=window.location.origin,R=H,w=H,E=H,a=nt.PUBLIC_HTTP3_CERTIFICATE_FINGERPRINT??"06:B0:F3:64:3A:61:E6:39:82:6F:E5:9E:D5:7E:8D:DC:A0:E6:7C:A9:4E:5D:00:2C:BC:60:13:05:63:1B:3C:78";let r,b="",S=null,_="",T;Ue(()=>{S=localStorage.getItem("user_id"),S&&(console.log("logging in with saved user_id...",S),y())}),it(()=>{_&&(clearTimeout(T),T=setTimeout(()=>{n(2,_="")},kt))});function y(){if(!b&&!S){n(2,_="Please enter your nickname");return}const p=`${R}/login`;S=localStorage.getItem("user_id"),console.log(`logging in... name=${b} id=${S} host=${p}`);const C={name:b,id:S??void 0};Y(te,o="logging in",o),fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)}).then(j=>{if(!j.ok)throw new Error("Network response was not ok");return j.json()}).then(j=>{console.log("logged in with user",j),j.code==200?(Y(te,o="connecting transport",o),ge.set(j.user),D().then(()=>{localStorage.setItem("user_id",f.id)}).catch(O=>{console.error(O),Y(te,o="login page",o)})):(n(2,_=j.message??"Error logging in"),localStorage.clear("user_id"),S=null,ge.set(null),Y(te,o="login page",o))}).catch(j=>{n(2,_=j.message??"Error logging in"),console.error(j),Y(te,o="login page",o)})}async function A(){if(console.log("connecting transport..."),Y(te,o="connecting webTransport",o),await g()){if(console.log("connected webtransport"),Y(te,o="registering webTransport",o),!await M())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),Y(te,o="connecting webSocket",o),await J()){if(console.log("connected webSocket"),Y(te,o="registering webSocket",o),!await Z())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return Y(ce,e.connected=!0,e),Y(te,o="room list",o),2}async function M(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(f.id))),Y(ce,e.wt.register_status="registering",e),await lt(e.wt)}async function Z(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(f.id))),Y(ce,e.ws.register_status="registering",e),await lt(e.ws)}Y(ce,e.addListener=(p,C)=>{e[p+"_listeners"]==null&&Y(ce,e[p+"_listeners"]=[],e);const j=e[p+"_listeners"].length;return e[p+"_listeners"].push(C),j},e),Y(ce,e.removeListener=(p,C)=>{Y(ce,e[p+"_listeners"]=null,e)},e);function U(p,C){p.register_status==="registering"&&(p.register_status="registered",console.log("register messsage received",p)),e[p.protocol+"_listeners"].forEach(j=>{try{j&&j(p,C)}catch(O){console.error("Error calling listener",O)}})}async function P(p){if(e.connected){console.log("webtransport disconnected, handling...");try{delete e.wt,delete e.ws}catch(C){console.log("error deleting transport",C)}Y(ce,e.connected=!1,e),await D()}}async function D(){for(Y(te,o="reconnecting",o);;){console.log("reconnecting...");const p=await A();if(p==Ct)console.log("reconnected, but failed registering. returning to login page..."),window.location.href="/";else if(p==It){console.log("reconnected"),Y(te,o="room list",o);break}console.log(`reconnecting again in ${v} sec...`),await Rt(v*1e3)}}async function g(){const p=`${w}/wt`,C=new WebTransport(p,{serverCertificateHashes:[{algorithm:"sha-256",value:Pt(a)}]});if(C.closed.then(()=>{console.log("WebTransport closed",C),P()}).catch(h=>{console.error("WebTransport connection died:",h,C),P()}),console.log("webtransport connecting...",p),!await C.ready.then(()=>(console.log("WebTransport connected",C),!0)).catch(h=>(console.error("WebTransport connection failed:",h),!1)))return!1;const O={protocol:"wt",register_status:"unregistered",transport:C},W=O.transport.datagrams,x=W.writable.getWriter(),re=W.readable.getReader();O.send=h=>{x.write(h)},async function(){for(;;){const{value:h,done:V}=await re.read();if(V){console.log("Done reading datagram, stop reading...",value);return}U(O,rt(h))}}().catch(h=>{console.error("reading datagram failed, stop reading...:",h)});const se=await C.createBidirectionalStream(),ie=se.writable.getWriter(),i=se.readable.getReader();return O.send_reliable=h=>{ie.write(h)},async function(){for(;;){const{value:h,done:V}=await i.read();if(V){console.log("Done reading stream, stop reading...",value);return}U(O,rt(h))}}().catch(h=>{console.error("reading datagram failed, stop reading...:",h)}),Y(ce,e.wt=O,e),!0}async function J(){const p=`${E}/ws`,C=new WebSocket(p);if(console.log("websocket connecting...",p),!await new Promise((W,x)=>{C.onopen=()=>{console.log(C,"WebSocket connected"),W(!0)},C.onerror_message=re=>{console.error("WebSocket error:",re),x(re)}}).catch(W=>(console.error("WebSocket $connection failed:",W),!1)))return!1;const O={protocol:"ws",register_status:"unregistered",transport:C};return O.send_reliable=W=>{O.transport.send(W)},C.addEventListener("message",W=>{U(O,JSON.parse(W.data))}),C.addEventListener("close",W=>{W.wasClean?console.log("WebSocket closed",W):console.error("WebSocket $connection died",W)}),Y(ce,e.ws=O,e),!0}function q(){b=this.value,n(1,b)}function L(p){Ae[p?"unshift":"push"](()=>{r=p,n(0,r)})}return[r,b,_,o,y,q,L]}class Ut extends We{constructor(t){super(),Le(this,t,jt,Tt,De,{})}}export{Ut as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}