import{s as De,n as Se,r as Oe,e as ve,o as Ue,a as it,f as M,h as ct,b as Ae}from"../chunks/scheduler.CTimOCLo.js";import{S as We,i as Le,g as u,s as L,m as oe,h,j as k,c as V,y as de,n as ne,f as m,k as d,l as _e,a as se,x as l,z as be,A as ue,o as he,B as at,C as dt,r as Xe,u as Je,v as ze,d as Ge,t as Ke,w as Qe,e as Ze}from"../chunks/index.CRnmY6F2.js";import{w as Ve}from"../chunks/index.BXnrS5-F.js";import{_ as ut}from"../chunks/preload-helper.CRk0x-X1.js";function xe(s){return s?.length!==void 0?s:Array.from(s)}const ht={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},ft={id:null,name:"",room:null,player:null},ce=Ve(ht),ge=Ve(ft),te=Ve("login page");function $e(s,t,n){const e=s.slice();return e[21]=t[n],e}function et(s){let t,n,e;return{c(){t=u("div"),n=u("p"),e=oe(s[4]),this.h()},l(o){t=h(o,"DIV",{class:!0});var f=k(t);n=h(f,"P",{});var v=k(n);e=ne(v,s[4]),v.forEach(m),f.forEach(m),this.h()},h(){d(t,"class","error-message svelte-17jni71")},m(o,f){se(o,t,f),l(t,n),l(n,e)},p(o,f){f&16&&he(e,o[4])},d(o){o&&m(t)}}}function tt(s){let t,n,e,o,f=s[21].name+"",v,F,S,b,C=Math.abs(s[21].ballSpeedX)+"",c,i,p,N=Object.keys(s[21].gameState.players).length+"",_,y,E,A,Y,Q,W,R,O,g;function q(){return s[13](s[21])}return{c(){t=u("div"),n=u("div"),e=u("div"),o=u("span"),v=oe(f),F=L(),S=u("span"),b=oe("Ball speed : "),c=oe(C),i=L(),p=u("span"),_=oe(N),y=oe("/2 Players"),E=L(),A=u("div"),Y=u("button"),Q=oe("JOIN"),R=L(),this.h()},l(H){t=h(H,"DIV",{class:!0});var a=k(t);n=h(a,"DIV",{class:!0});var T=k(n);e=h(T,"DIV",{class:!0});var D=k(e);o=h(D,"SPAN",{});var P=k(o);v=ne(P,f),P.forEach(m),D.forEach(m),F=V(T),S=h(T,"SPAN",{class:!0});var U=k(S);b=ne(U,"Ball speed : "),c=ne(U,C),U.forEach(m),i=V(T),p=h(T,"SPAN",{class:!0});var z=k(p);_=ne(z,N),y=ne(z,"/2 Players"),z.forEach(m),T.forEach(m),E=V(a),A=h(a,"DIV",{});var Z=k(A);Y=h(Z,"BUTTON",{class:!0});var re=k(Y);Q=ne(re,"JOIN"),re.forEach(m),Z.forEach(m),R=V(a),a.forEach(m),this.h()},h(){d(e,"class","room__name svelte-17jni71"),d(S,"class","room__detail svelte-17jni71"),d(p,"class","room__detail svelte-17jni71"),d(n,"class","room__info svelte-17jni71"),d(Y,"class","button svelte-17jni71"),Y.disabled=W=Object.keys(s[21].gameState.players).length>=2,d(t,"class","room svelte-17jni71")},m(H,a){se(H,t,a),l(t,n),l(n,e),l(e,o),l(o,v),l(n,F),l(n,S),l(S,b),l(S,c),l(n,i),l(n,p),l(p,_),l(p,y),l(t,E),l(t,A),l(A,Y),l(Y,Q),l(t,R),O||(g=ue(Y,"click",q),O=!0)},p(H,a){s=H,a&1&&f!==(f=s[21].name+"")&&he(v,f),a&1&&C!==(C=Math.abs(s[21].ballSpeedX)+"")&&he(c,C),a&1&&N!==(N=Object.keys(s[21].gameState.players).length+"")&&he(_,N),a&1&&W!==(W=Object.keys(s[21].gameState.players).length>=2)&&(Y.disabled=W)},d(H){H&&m(t),O=!1,g()}}}function ot(s){let t,n="<span>No rooms available</span>";return{c(){t=u("p"),t.innerHTML=n,this.h()},l(e){t=h(e,"P",{style:!0,"data-svelte-h":!0}),de(t)!=="svelte-156qi2m"&&(t.innerHTML=n),this.h()},h(){_e(t,"color","grey")},m(e,o){se(e,t,o)},d(e){e&&m(t)}}}function mt(s){let t,n,e,o="PONG",f,v,F,S=s[5]?.name+"",b,C,c,i,p,N,_="rename user",y,E,A,Y,Q,W,R,O,g,q,H,a="Create Room",T,D,P,U="Refresh",z,Z,re="",le,ie,r,w,B,ae="credit: angls4",me,Ee,G=s[4]&&et(s),fe=xe(s[0]),x=[];for(let j=0;j<fe.length;j+=1)x[j]=tt($e(s,fe,j));let ee=s[0].length==0&&ot();return{c(){t=u("div"),G&&G.c(),n=L(),e=u("h1"),e.textContent=o,f=L(),v=u("h2"),F=oe("Welcome, "),b=oe(S),C=L(),c=u("div"),i=u("input"),p=L(),N=u("button"),N.textContent=_,y=L(),E=u("br"),A=L(),Y=u("br"),Q=L(),W=u("input"),R=L(),O=u("span"),g=u("input"),q=L(),H=u("button"),H.textContent=a,T=L(),D=u("p"),P=u("button"),P.textContent=U,z=L(),Z=u("div"),Z.innerHTML=re,le=L(),ie=u("div");for(let j=0;j<x.length;j+=1)x[j].c();r=L(),ee&&ee.c(),w=L(),B=u("p"),B.textContent=ae,this.h()},l(j){t=h(j,"DIV",{class:!0});var I=k(t);G&&G.l(I),n=V(I),e=h(I,"H1",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1jnr5i3"&&(e.textContent=o),f=V(I),v=h(I,"H2",{class:!0});var X=k(v);F=ne(X,"Welcome, "),b=ne(X,S),X.forEach(m),C=V(I),c=h(I,"DIV",{class:!0,style:!0});var $=k(c);i=h($,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),p=V($),N=h($,"BUTTON",{class:!0,"data-svelte-h":!0}),de(N)!=="svelte-5cerf9"&&(N.textContent=_),y=V($),E=h($,"BR",{}),A=V($),Y=h($,"BR",{}),Q=V($),W=h($,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),R=V($),O=h($,"SPAN",{});var pe=k(O);g=h(pe,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),q=V(pe),H=h(pe,"BUTTON",{class:!0,"data-svelte-h":!0}),de(H)!=="svelte-136z9rb"&&(H.textContent=a),pe.forEach(m),$.forEach(m),T=V(I),D=h(I,"P",{});var we=k(D);P=h(we,"BUTTON",{class:!0,"data-svelte-h":!0}),de(P)!=="svelte-1nuptru"&&(P.textContent=U),we.forEach(m),z=V(I),Z=h(I,"DIV",{class:!0,"data-svelte-h":!0}),de(Z)!=="svelte-1hf6hku"&&(Z.innerHTML=re),le=V(I),ie=h(I,"DIV",{class:!0});var Te=k(ie);for(let J=0;J<x.length;J+=1)x[J].l(Te);Te.forEach(m),r=V(I),ee&&ee.l(I),I.forEach(m),w=V(j),B=h(j,"P",{style:!0,"data-svelte-h":!0}),de(B)!=="svelte-apo9jk"&&(B.textContent=ae),this.h()},h(){d(e,"class","card__title svelte-17jni71"),d(v,"class","svelte-17jni71"),d(i,"type","text"),d(i,"placeholder","New nickname"),d(i,"maxlength","20"),d(i,"class","svelte-17jni71"),d(N,"class","button-small svelte-17jni71"),d(W,"type","text"),W.required=!0,d(W,"placeholder","Enter room name"),d(W,"maxlength","20"),d(W,"class","svelte-17jni71"),d(g,"type","number"),d(g,"min","0"),d(g,"max","100"),g.required=!0,d(g,"placeholder","Ball speed"),_e(g,"width","100px"),_e(g,"margin-left","0"),_e(g,"margin-right","10px"),d(g,"class","svelte-17jni71"),d(H,"class","button-small svelte-17jni71"),d(c,"class","room svelte-17jni71"),_e(c,"display","block"),d(P,"class","button svelte-17jni71"),d(Z,"class","card__header svelte-17jni71"),d(ie,"class","room-list svelte-17jni71"),d(t,"class","card svelte-17jni71"),_e(B,"color","white")},m(j,I){se(j,t,I),G&&G.m(t,null),l(t,n),l(t,e),l(t,f),l(t,v),l(v,F),l(v,b),l(t,C),l(t,c),l(c,i),be(i,s[3]),l(c,p),l(c,N),l(c,y),l(c,E),l(c,A),l(c,Y),l(c,Q),l(c,W),be(W,s[1]),l(c,R),l(c,O),l(O,g),be(g,s[2]),l(O,q),l(O,H),l(t,T),l(t,D),l(D,P),l(t,z),l(t,Z),l(t,le),l(t,ie);for(let X=0;X<x.length;X+=1)x[X]&&x[X].m(ie,null);l(t,r),ee&&ee.m(t,null),se(j,w,I),se(j,B,I),me||(Ee=[ue(i,"input",s[10]),ue(N,"click",s[9]),ue(W,"input",s[11]),ue(g,"input",s[12]),ue(H,"click",s[7]),ue(P,"click",s[6])],me=!0)},p(j,[I]){if(j[4]?G?G.p(j,I):(G=et(j),G.c(),G.m(t,n)):G&&(G.d(1),G=null),I&32&&S!==(S=j[5]?.name+"")&&he(b,S),I&8&&i.value!==j[3]&&be(i,j[3]),I&2&&W.value!==j[1]&&be(W,j[1]),I&4&&at(g.value)!==j[2]&&be(g,j[2]),I&257){fe=xe(j[0]);let X;for(X=0;X<fe.length;X+=1){const $=$e(j,fe,X);x[X]?x[X].p($,I):(x[X]=tt($),x[X].c(),x[X].m(ie,null))}for(;X<x.length;X+=1)x[X].d(1);x.length=fe.length}j[0].length==0?ee||(ee=ot(),ee.c(),ee.m(t,null)):ee&&(ee.d(1),ee=null)},i:Se,o:Se,d(j){j&&(m(t),m(w),m(B)),G&&G.d(),dt(x,j),ee&&ee.d(),me=!1,Oe(Ee)}}}const gt=3e3;function pt(s,t,n){let e,o,f;ve(s,ge,R=>n(5,e=R)),ve(s,te,R=>n(15,o=R)),ve(s,ce,R=>n(16,f=R));const F=window.location.origin;let S=[],b="",C,c=e?.name??"",i="",p;Ue(()=>{te.subscribe(R=>{f.connected&&(e.room?e.room?.id?y(e.room):y({id:e.room}):N())})}),it(()=>{i&&(clearTimeout(p),p=setTimeout(()=>{n(4,i="")},gt))});async function N(){const O=await(await fetch(`${F}/list_room`)).json();O.status=="success"?O.rooms?n(0,S=O.rooms):(console.error("Failed to get rooms",O),n(4,i="Failed to get rooms")):(console.error("Failed to get rooms",O),n(4,i=O.message??"Failed to get rooms")),console.log("room list refreshed",S)}async function _(){if(!b||!C){console.error("Room name and ball speed are required"),n(4,i="Room name and ball speed are required");return}const R={name:b,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:C,ballSpeedY:C},O=`${F}/create_room`;console.log("Creating room...",O,R),await fetch(O,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)}).then(g=>g.json()).then(g=>{console.log("create room",g),g.status=="success"&&g.room?.id?(console.log("Room created successfully, joining...",g.room),y(g.room)):(console.error("Failed to create room",g.message),n(4,i=g.message??"Failed to create room"))}).catch(g=>{console.error("Failed to create room",g),n(4,i=g.message??"Failed to create room")}),console.log("Room created successfully"),N()}async function y(R){console.log("Joining room...",R.id);const O=`${F}/join_room`,g={room_id:R.id,user_id:e.id};await fetch(O,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}).then(q=>q.json()).then(q=>{q.status=="success"&&q.room?.id&&q.user?.id?(console.log("Joined room successfully"),M(ge,e=q.user,e),M(ge,e.room=q.room,e),console.log("Playing room...",R),M(te,o="game room",o)):(console.error("Failed to join room",q),M(ge,e.room=null,e),n(4,i=q.message??"Failed to join room"),N())}).catch(q=>{console.error("Failed to join room",q),n(4,i=q.message??"Failed to join room")})}function E(){if(!c){console.error("Nickname is required"),n(4,i="Nickname is required");return}console.log("Renaming room...",b);const R=`${F}/login`,O={id:e.id,name:c};fetch(R,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)}).then(g=>g.json()).then(g=>{console.log("rename user",g),g.status=="success"&&g.user?.id?(console.log("User renamed successfully"),M(ge,e=g.user,e)):(console.error("Failed to rename user",g),n(4,i=g.message??"Failed to rename user"))}).catch(g=>{console.error("Failed to rename user",g),n(4,i=g.message??"Failed to rename user")})}function A(){c=this.value,n(3,c)}function Y(){b=this.value,n(1,b)}function Q(){C=at(this.value),n(2,C)}return[S,b,C,c,i,e,N,_,y,E,A,Y,Q,R=>y(R)]}class _t extends We{constructor(t){super(),Le(this,t,pt,mt,De,{})}}new TextEncoder;function vt(s){let t,n,e,o,f=(s[4]?.players?.[s[4]?.p0index]?.user?.name??"...")+"",v,F,S,b,C=(s[4]?.players?.[s[4]?.p0index]?.wins??0)+"",c,i,p,N="PONG",_,y,E,A=(s[4]?.players?.[s[4]?.p1index]?.user?.name??"...")+"",Y,Q,W,R,O=(s[4]?.players?.[s[4]?.p1index]?.wins??0)+"",g,q,H,a,T,D,P,U,z,Z="play/pause",re,le,ie="leave",r,w,B,ae,me,Ee="latency difference : ",G,fe,x,ee,j,I,X,$,pe,we,Te;return{c(){t=u("div"),n=u("div"),e=u("div"),o=u("h3"),v=oe(f),F=L(),S=u("p"),b=oe("Wins: "),c=oe(C),i=L(),p=u("h1"),p.textContent=N,_=L(),y=u("div"),E=u("h3"),Y=oe(A),Q=L(),W=u("p"),R=oe("Wins: "),g=oe(O),q=L(),H=u("p"),a=u("canvas"),P=L(),U=u("div"),z=u("button"),z.textContent=Z,re=L(),le=u("button"),le.textContent=ie,r=L(),w=u("div"),B=u("div"),ae=u("div"),me=u("div"),me.textContent=Ee,G=u("div"),fe=oe(s[5]),x=oe(" ms"),ee=L(),j=u("p"),I=u("canvas"),this.h()},l(J){t=h(J,"DIV",{style:!0,class:!0});var K=k(t);n=h(K,"DIV",{class:!0});var ye=k(n);e=h(ye,"DIV",{class:!0});var Ce=k(e);o=h(Ce,"H3",{});var Fe=k(o);v=ne(Fe,f),Fe.forEach(m),F=V(Ce),S=h(Ce,"P",{});var Re=k(S);b=ne(Re,"Wins: "),c=ne(Re,C),Re.forEach(m),Ce.forEach(m),i=V(ye),p=h(ye,"H1",{class:!0,"data-svelte-h":!0}),de(p)!=="svelte-106hqp2"&&(p.textContent=N),_=V(ye),y=h(ye,"DIV",{class:!0});var Ie=k(y);E=h(Ie,"H3",{});var Ye=k(E);Y=ne(Ye,A),Ye.forEach(m),Q=V(Ie),W=h(Ie,"P",{});var Pe=k(W);R=ne(Pe,"Wins: "),g=ne(Pe,O),Pe.forEach(m),Ie.forEach(m),ye.forEach(m),q=V(K),H=h(K,"P",{});var Be=k(H);a=h(Be,"CANVAS",{width:!0,height:!0,style:!0}),k(a).forEach(m),Be.forEach(m),P=V(K),U=h(K,"DIV",{});var ke=k(U);z=h(ke,"BUTTON",{class:!0,"data-svelte-h":!0}),de(z)!=="svelte-18inrs7"&&(z.textContent=Z),re=V(ke),le=h(ke,"BUTTON",{class:!0,"data-svelte-h":!0}),de(le)!=="svelte-101srf3"&&(le.textContent=ie),ke.forEach(m),r=V(K),w=h(K,"DIV",{class:!0});var Me=k(w);B=h(Me,"DIV",{class:!0});var He=k(B);ae=h(He,"DIV",{class:!0});var je=k(ae);me=h(je,"DIV",{"data-svelte-h":!0}),de(me)!=="svelte-4lk6wz"&&(me.textContent=Ee),G=h(je,"DIV",{});var Ne=k(G);fe=ne(Ne,s[5]),x=ne(Ne," ms"),Ne.forEach(m),je.forEach(m),He.forEach(m),Me.forEach(m),ee=V(K),j=h(K,"P",{});var qe=k(j);I=h(qe,"CANVAS",{width:!0,height:!0,style:!0}),k(I).forEach(m),qe.forEach(m),K.forEach(m),this.h()},h(){d(e,"class","player1 svelte-1ay6bd4"),d(p,"class","svelte-1ay6bd4"),d(y,"class","player2 svelte-1ay6bd4"),d(n,"class","scoreboard svelte-1ay6bd4"),d(a,"width",T=s[3].width),d(a,"height",D=s[3].height),_e(a,"background","black"),d(z,"class","game_button svelte-1ay6bd4"),d(le,"class","game_button svelte-1ay6bd4"),d(ae,"class","stats-row svelte-1ay6bd4"),d(B,"class","stats-card svelte-1ay6bd4"),d(w,"class","stats-container svelte-1ay6bd4"),I.hidden=X=!s[2],d(I,"width",$=s[3].width),d(I,"height",pe=s[3].height),_e(I,"background","black"),_e(t,"width","800px"),d(t,"class","cent svelte-1ay6bd4")},m(J,K){se(J,t,K),l(t,n),l(n,e),l(e,o),l(o,v),l(e,F),l(e,S),l(S,b),l(S,c),l(n,i),l(n,p),l(n,_),l(n,y),l(y,E),l(E,Y),l(y,Q),l(y,W),l(W,R),l(W,g),l(t,q),l(t,H),l(H,a),s[11](a),l(t,P),l(t,U),l(U,z),l(U,re),l(U,le),l(t,r),l(t,w),l(w,B),l(B,ae),l(ae,me),l(ae,G),l(G,fe),l(G,x),l(t,ee),l(t,j),l(j,I),s[12](I),we||(Te=[ue(a,"mousemove",s[6]),ue(z,"click",s[7]),ue(le,"click",s[8])],we=!0)},p(J,K){K[0]&16&&f!==(f=(J[4]?.players?.[J[4]?.p0index]?.user?.name??"...")+"")&&he(v,f),K[0]&16&&C!==(C=(J[4]?.players?.[J[4]?.p0index]?.wins??0)+"")&&he(c,C),K[0]&16&&A!==(A=(J[4]?.players?.[J[4]?.p1index]?.user?.name??"...")+"")&&he(Y,A),K[0]&16&&O!==(O=(J[4]?.players?.[J[4]?.p1index]?.wins??0)+"")&&he(g,O),K[0]&8&&T!==(T=J[3].width)&&d(a,"width",T),K[0]&8&&D!==(D=J[3].height)&&d(a,"height",D),K[0]&32&&he(fe,J[5]),K[0]&4&&X!==(X=!J[2])&&(I.hidden=X),K[0]&8&&$!==($=J[3].width)&&d(I,"width",$),K[0]&8&&pe!==(pe=J[3].height)&&d(I,"height",pe)},i:Se,o:Se,d(J){J&&m(t),s[11](null),s[12](null),we=!1,Oe(Te)}}}function bt(s,t,n){let e,o,f;ve(s,ge,r=>n(22,e=r)),ve(s,ce,r=>n(23,o=r)),ve(s,te,r=>n(24,f=r));const v=1e3/60,S=window.location.origin;let b,C,c,i,p,N=!0,_={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},y={ballX:Math.floor(_.width/2),ballY:Math.floor(_.height/2),players:{a:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},b:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}},isRunning:!1,p0index:"a",p1index:"b"},E={...y},A={paddleY:Math.floor(_.height/2)};function Y(r){n(3,_={...r})}async function Q(){for(;f=="game room";){await new Promise(r=>setTimeout(r,v));try{if(y.isRunning)if(o.connected){let r=new Uint8Array(Uint16Array.of(A.paddleY).buffer),w=[1,r[0],r[1]];const B=Uint8Array.of(...w);o.wt.send(B)}else{console.error("Connection not ready");continue}}catch(r){console.error("Error in transmit loop",r)}}}function W(){if(f!="game room"){cancelAnimationFrame(p);return}try{R(c,y),R(i,E)}catch(r){console.error("Error in draw loop",r)}p=requestAnimationFrame(W)}function R(r,w){r.clearRect(0,0,b.width,b.height),r.fillStyle="white",r.beginPath(),r.arc(w.ballX,w.ballY,_.ballRadius,0,Math.PI*2),r.fill(),Object.keys(w?.players??{}).length>0&&(r.fillRect(0,w.players[w.p0index]?.paddleY,_.paddleWidth,_.paddleHeight),r.fillRect(b.width-_.paddleWidth,w.players[w.p1index]?.paddleY,_.paddleWidth,_.paddleHeight),r.strokeStyle="white",r.lineWidth=3,r.setLineDash([20,40]),r.beginPath(),r.moveTo(b.width/2,0),r.lineTo(b.width/2,b.height),r.stroke(),r.fillStyle="white",r.font="bold 50px Arial",r.fillText(w.players[w.p0index]?.score?.toString()??"0",b.width/2-70,70,100),r.fillText(w.players[w.p1index]?.score?.toString()??"0",b.width/2+40,70,100)),w.isRunning||(r.fillStyle="white",r.font="bold 50px Arial",r.fillText("▐▐ ",20,80,200))}Ue(()=>{c=b.getContext("2d"),i=C.getContext("2d")}),ct(()=>{cancelAnimationFrame(p)});function O(r){const w=b.getBoundingClientRect(),B=r.clientY-w.top-_.paddleHeight/2,ae=Math.max(1,Math.min(b.height-_.paddleHeight,B));A.paddleY=ae,n(4,y.players[e.id].paddleY=ae,y)}function g(){console.log("play/pause ing..."),o.connected?o.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function q(){const r={room_id:e.room.id,user_id:e.id},w=`${S}/leave_room`;console.log("Leaving room...",r,w),fetch(w,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(B=>B.json()).then(B=>{B.status=="success"&&B.user?.id&&B.room?.id?(console.log("Leave room successful, returning to room list..."),M(ge,e=B.user,e),M(te,f="room list",f)):console.error("Failed to leave room",B)}).catch(B=>{console.error("Error in leave room request",B)})}function H(r){try{r.players[e.id].paddleY=A.paddleY}catch(w){console.error("Error in converting state",w)}n(4,y=r)}let a=0,T=0,D=0;const P=[0],U=[0];let z=Date.now(),Z=Date.now();o.addListener("wt",(r,w)=>{y.isRunning&&(z=w.timestamp),H({...w.state})}),o.addListener("ws",(r,w)=>{y.isRunning&&(Z=w.timestamp),E={...w.state}}),setInterval(()=>{if(y.isRunning){P.length>200&&P.shift(),U.length>200&&U.shift();const r=Date.now();P.push(r-z),U.push(r-Z)}},50),setInterval(()=>{y.isRunning&&(a=Math.round(P.reduce((r,w)=>r+w,0)/P.length),T=Math.round(U.reduce((r,w)=>r+w,0)/U.length),n(5,D=T-a)),a>3e3&&n(4,y.isRunning=!1,y)},200),setInterval(()=>{y.isRunning&&(console.log("latency difference : ",D,"ms"),console.log("ballX : ",y.ballX,"ballY : ",y.ballY),console.log("ws ballX : ",E.ballX,"ws ballY : ",E.ballY),console.log("ball distance : ",Math.sqrt((y.ballX-E.ballX)**2+(y.ballY-E.ballY)**2)))},1e3);function re(){console.log("starting loops"),W(),Q()}te.subscribe(r=>{r=="game room"&&(Y({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),H(e.room.gameState),re())});function le(r){Ae[r?"unshift":"push"](()=>{b=r,n(0,b)})}function ie(r){Ae[r?"unshift":"push"](()=>{C=r,n(1,C)})}return[b,C,N,_,y,D,O,g,q,Y,H,le,ie]}class wt extends We{constructor(t){super(),Le(this,t,bt,vt,De,{setRoomConfig:9,setState:10},null,[-1,-1])}get setRoomConfig(){return this.$$.ctx[9]}get setState(){return this.$$.ctx[10]}}const nt=globalThis.__sveltekit_1etz0zj.env??(await ut(()=>import(globalThis.__sveltekit_1etz0zj.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function yt(s){let t,n;return{c(){t=u("h2"),n=oe(s[3])},l(e){t=h(e,"H2",{});var o=k(t);n=ne(o,s[3]),o.forEach(m)},m(e,o){se(e,t,o),l(t,n)},p(e,o){o&8&&he(n,e[3])},d(e){e&&m(t)}}}function Et(s){let t,n="PONG",e,o,f,v,F,S,b,C,c=s[2]&&st(s);return{c(){t=u("h1"),t.textContent=n,e=L(),o=u("input"),f=L(),v=u("input"),F=L(),c&&c.c(),S=Ze(),this.h()},l(i){t=h(i,"H1",{class:!0,"data-svelte-h":!0}),de(t)!=="svelte-106hqp2"&&(t.textContent=n),e=V(i),o=h(i,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),f=V(i),v=h(i,"INPUT",{type:!0,class:!0}),F=V(i),c&&c.l(i),S=Ze(),this.h()},h(){d(t,"class","svelte-1av3m61"),d(o,"type","text"),d(o,"placeholder","your nickname"),d(o,"autocomplete","off"),d(o,"spellcheck","false"),d(o,"maxlength","20"),d(o,"class","svelte-1av3m61"),d(v,"type","submit"),v.value="Enter",d(v,"class","svelte-1av3m61")},m(i,p){se(i,t,p),se(i,e,p),se(i,o,p),be(o,s[1]),se(i,f,p),se(i,v,p),se(i,F,p),c&&c.m(i,p),se(i,S,p),b||(C=[ue(o,"input",s[5]),ue(v,"click",s[4])],b=!0)},p(i,p){p&2&&o.value!==i[1]&&be(o,i[1]),i[2]?c?c.p(i,p):(c=st(i),c.c(),c.m(S.parentNode,S)):c&&(c.d(1),c=null)},d(i){i&&(m(t),m(e),m(o),m(f),m(v),m(F),m(S)),c&&c.d(i),b=!1,Oe(C)}}}function st(s){let t,n,e;return{c(){t=u("div"),n=u("p"),e=oe(s[2]),this.h()},l(o){t=h(o,"DIV",{class:!0});var f=k(t);n=h(f,"P",{});var v=k(n);e=ne(v,s[2]),v.forEach(m),f.forEach(m),this.h()},h(){d(t,"class","error-message svelte-1av3m61")},m(o,f){se(o,t,f),l(t,n),l(n,e)},p(o,f){f&4&&he(e,o[2])},d(o){o&&m(t)}}}function Tt(s){let t,n,e,o,f,v,F,S,b,C,c,i;function p(E,A){if(E[3]==="login page")return Et;if(E[3]!=="room list"&&E[3]!=="game room")return yt}let N=p(s),_=N&&N(s);v=new _t({});let y={};return C=new wt({props:y}),s[6](C),{c(){t=u("body"),n=u("div"),_&&_.c(),e=L(),o=u("div"),f=u("div"),Xe(v.$$.fragment),S=L(),b=u("div"),Xe(C.$$.fragment),this.h()},l(E){t=h(E,"BODY",{class:!0});var A=k(t);n=h(A,"DIV",{class:!0});var Y=k(n);_&&_.l(Y),Y.forEach(m),e=V(A),o=h(A,"DIV",{});var Q=k(o);f=h(Q,"DIV",{class:!0});var W=k(f);Je(v.$$.fragment,W),W.forEach(m),Q.forEach(m),S=V(A),b=h(A,"DIV",{});var R=k(b);Je(C.$$.fragment,R),R.forEach(m),A.forEach(m),this.h()},h(){d(n,"class","cent svelte-1av3m61"),d(f,"class","cent svelte-1av3m61"),o.hidden=F=s[3]!=="room list",b.hidden=c=s[3]!=="game room",d(t,"class","svelte-1av3m61")},m(E,A){se(E,t,A),l(t,n),_&&_.m(n,null),l(t,e),l(t,o),l(o,f),ze(v,f,null),l(t,S),l(t,b),ze(C,b,null),i=!0},p(E,[A]){N===(N=p(E))&&_?_.p(E,A):(_&&_.d(1),_=N&&N(E),_&&(_.c(),_.m(n,null))),(!i||A&8&&F!==(F=E[3]!=="room list"))&&(o.hidden=F);const Y={};C.$set(Y),(!i||A&8&&c!==(c=E[3]!=="game room"))&&(b.hidden=c)},i(E){i||(Ge(v.$$.fragment,E),Ge(C.$$.fragment,E),i=!0)},o(E){Ke(v.$$.fragment,E),Ke(C.$$.fragment,E),i=!1},d(E){E&&m(t),_&&_.d(),Qe(v),s[6](null),Qe(C)}}}const Ct=1,It=2,kt=3e3,St=5e3;async function lt(s){console.log("waiting for registration...",s);const t=St,n=new Promise((o,f)=>{const v=setInterval(()=>{s.register_status==="registered"&&(clearInterval(v),o())},100)}),e=new Promise((o,f)=>{setTimeout(()=>{f(new Error("Registration timeout"))},t)});return await Promise.race([n,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(o=>!1)}function rt(s){const n=new TextDecoder("utf-8").decode(s);return JSON.parse(n)}function Rt(s){return new Promise(t=>setTimeout(t,s))}function Pt(s,t,n){let e,o,f;ve(s,ce,a=>n(9,e=a)),ve(s,te,a=>n(3,o=a)),ve(s,ge,a=>n(10,f=a));const v=nt.PUBLIC_RECONNECT_INTERVAL??3,F=window.location.origin,S=F,b=F,C=F;nt.PUBLIC_HTTP3_CERTIFICATE_FINGERPRINT;let c,i="",p=null,N="",_;Ue(()=>{p=localStorage.getItem("user_id"),p&&(console.log("logging in with saved user_id...",p),y())}),it(()=>{N&&(clearTimeout(_),_=setTimeout(()=>{n(2,N="")},kt))});function y(){if(!i&&!p){n(2,N="Please enter your nickname");return}const a=`${S}/login`;p=localStorage.getItem("user_id"),console.log(`logging in... name=${i} id=${p} host=${a}`);const T={name:i,id:p??void 0};M(te,o="logging in",o),fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)}).then(D=>{if(!D.ok)throw new Error("Network response was not ok");return D.json()}).then(D=>{console.log("logged in with user",D),D.code==200?(M(te,o="connecting transport",o),ge.set(D.user),R().then(()=>{localStorage.setItem("user_id",f.id)}).catch(P=>{console.error(P),M(te,o="login page",o)})):(n(2,N=D.message??"Error logging in"),localStorage.clear("user_id"),p=null,ge.set(null),M(te,o="login page",o))}).catch(D=>{n(2,N=D.message??"Error logging in"),console.error(D),M(te,o="login page",o)})}async function E(){console.log("connecting transport..."),M(te,o="connecting webTransport",o);let a=2;const T=async()=>{await O()?(console.log("connected webtransport"),M(te,o="registering webTransport",o),await A()||(console.log("failed to register webTransport"),a=1)):(console.log("failed to connect webtransport"),a=0),console.log("Registered webTransport")},D=async()=>{M(te,o="connecting webSocket",o),await g()?(console.log("connected webSocket"),M(te,o="registering webSocket",o),await Y()||(console.log("failed to register webSocket"),a=1)):(console.log("failed to connect webSocket"),a=0)};return await Promise.all([T(),D()]),a==2&&(M(ce,e.connected=!0,e),M(te,o="room list",o)),a}async function A(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(f.id))),M(ce,e.wt.register_status="registering",e),await lt(e.wt)}async function Y(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(f.id))),M(ce,e.ws.register_status="registering",e),await lt(e.ws)}M(ce,e.addListener=(a,T)=>{e[a+"_listeners"]==null&&M(ce,e[a+"_listeners"]=[],e);const D=e[a+"_listeners"].length;return e[a+"_listeners"].push(T),D},e),M(ce,e.removeListener=(a,T)=>{M(ce,e[a+"_listeners"]=null,e)},e);function Q(a,T){a.register_status==="registering"&&(a.register_status="registered",console.log("register messsage received",a)),e[a.protocol+"_listeners"].forEach(D=>{try{D&&D(a,T)}catch(P){console.error("Error calling listener",P)}})}async function W(a){if(e.connected){console.log("webtransport disconnected, handling...");try{delete e.wt,delete e.ws}catch(T){console.log("error deleting transport",T)}M(ce,e.connected=!1,e),await R()}}async function R(){for(M(te,o="reconnecting",o);;){console.log("reconnecting...");const a=await E();if(a==Ct)console.log("reconnected, but failed registering. returning to login page..."),window.location.href="/";else if(a==It){console.log("reconnected"),M(te,o="room list",o);break}console.log(`reconnecting again in ${v} sec...`),await Rt(v*1e3)}}async function O(){const a=`${b}/wt`,T=new WebTransport(a);if(T.closed.then(()=>{console.log("WebTransport closed",T),W()}).catch(r=>{console.error("WebTransport connection died:",r,T),W()}),console.log("webtransport connecting...",a),!await T.ready.then(()=>(console.log("WebTransport connected",T),!0)).catch(r=>(console.error("WebTransport connection failed:",r),!1)))return!1;const P={protocol:"wt",register_status:"unregistered",transport:T},U=P.transport.datagrams,z=U.writable.getWriter(),Z=U.readable.getReader();P.send=r=>{z.write(r)},async function(){for(;;){const{value:r,done:w}=await Z.read();if(w){console.log("Done reading datagram, stop reading...",value);return}Q(P,rt(r))}}().catch(r=>{console.error("reading datagram failed, stop reading...:",r)});const re=await T.createBidirectionalStream(),le=re.writable.getWriter(),ie=re.readable.getReader();return P.send_reliable=r=>{le.write(r)},async function(){for(;;){const{value:r,done:w}=await ie.read();if(w){console.log("Done reading stream, stop reading...",value);return}Q(P,rt(r))}}().catch(r=>{console.error("reading datagram failed, stop reading...:",r)}),M(ce,e.wt=P,e),!0}async function g(){const a=`${C}/ws`,T=new WebSocket(a);if(console.log("websocket connecting...",a),!await new Promise((U,z)=>{T.onopen=()=>{console.log(T,"WebSocket connected"),U(!0)},T.onerror_message=Z=>{console.error("WebSocket error:",Z),z(Z)}}).catch(U=>(console.error("WebSocket $connection failed:",U),!1)))return!1;const P={protocol:"ws",register_status:"unregistered",transport:T};return P.send_reliable=U=>{P.transport.send(U)},T.addEventListener("message",U=>{Q(P,JSON.parse(U.data))}),T.addEventListener("close",U=>{U.wasClean?console.log("WebSocket closed",U):console.error("WebSocket $connection died",U)}),M(ce,e.ws=P,e),!0}function q(){i=this.value,n(1,i)}function H(a){Ae[a?"unshift":"push"](()=>{c=a,n(0,c)})}return[c,i,N,o,y,q,H]}class Ot extends We{constructor(t){super(),Le(this,t,Pt,Tt,De,{})}}export{Ot as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}