import{s as Pe,n as we,r as Ce,e as he,o as Ie,a as xe,f as q,h as et,b as Ee}from"../chunks/scheduler.CTimOCLo.js";import{S as Re,i as Ne,g as f,s as B,h as g,j as W,c as F,y as de,f as p,k as d,l as se,a as oe,x as r,z as ge,A as ae,B as $e,C as tt,m as x,n as $,o as ie,r as Le,u as Be,v as Fe,d as Ye,t as He,w as qe,e as Me}from"../chunks/index.CRnmY6F2.js";import{w as We}from"../chunks/index.BXnrS5-F.js";import{_ as ot}from"../chunks/preload-helper.CRk0x-X1.js";function ze(s){return s?.length!==void 0?s:Array.from(s)}const nt={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},st={id:null,name:"",room:null,player:null},re=We(nt),ce=We(st),Z=We("idle");function Je(s,t,n){const e=s.slice();return e[23]=t[n],e}function Xe(s){let t,n,e;return{c(){t=f("div"),n=f("p"),e=x(s[4]),this.h()},l(o){t=g(o,"DIV",{class:!0});var m=W(t);n=g(m,"P",{});var c=W(n);e=$(c,s[4]),c.forEach(p),m.forEach(p),this.h()},h(){d(t,"class","error-message svelte-18y7b0k")},m(o,m){oe(o,t,m),r(t,n),r(n,e)},p(o,m){m&16&&ie(e,o[4])},d(o){o&&p(t)}}}function Ge(s){let t,n,e,o,m=s[23].name+"",c,b,I,E,U=Math.abs(s[23].ballSpeedX)+"",h,u,w,Y=s[23].gameState.players.length+"",V,_,S,L,v,D="JOIN",M,P,A;function y(){return s[12](s[23])}return{c(){t=f("div"),n=f("div"),e=f("div"),o=f("span"),c=x(m),b=B(),I=f("span"),E=x("Ball speed : "),h=x(U),u=B(),w=f("span"),V=x(Y),_=x("/2 Players"),S=B(),L=f("div"),v=f("button"),v.textContent=D,M=B(),this.h()},l(k){t=g(k,"DIV",{class:!0});var l=W(t);n=g(l,"DIV",{class:!0});var a=W(n);e=g(a,"DIV",{class:!0});var R=W(e);o=g(R,"SPAN",{});var O=W(o);c=$(O,m),O.forEach(p),R.forEach(p),b=F(a),I=g(a,"SPAN",{class:!0});var H=W(I);E=$(H,"Ball speed : "),h=$(H,U),H.forEach(p),u=F(a),w=g(a,"SPAN",{class:!0});var J=W(w);V=$(J,Y),_=$(J,"/2 Players"),J.forEach(p),a.forEach(p),S=F(l),L=g(l,"DIV",{class:!0});var Q=W(L);v=g(Q,"BUTTON",{class:!0,"data-svelte-h":!0}),de(v)!=="svelte-120grqu"&&(v.textContent=D),Q.forEach(p),M=F(l),l.forEach(p),this.h()},h(){d(e,"class","room__name svelte-18y7b0k"),d(I,"class","room__detail svelte-18y7b0k"),d(w,"class","room__detail svelte-18y7b0k"),d(n,"class","room__info svelte-18y7b0k"),d(v,"class","button svelte-18y7b0k"),d(L,"class","room__actions"),d(t,"class","room svelte-18y7b0k")},m(k,l){oe(k,t,l),r(t,n),r(n,e),r(e,o),r(o,c),r(n,b),r(n,I),r(I,E),r(I,h),r(n,u),r(n,w),r(w,V),r(w,_),r(t,S),r(t,L),r(L,v),r(t,M),P||(A=ae(v,"click",y),P=!0)},p(k,l){s=k,l&1&&m!==(m=s[23].name+"")&&ie(c,m),l&1&&U!==(U=Math.abs(s[23].ballSpeedX)+"")&&ie(h,U),l&1&&Y!==(Y=s[23].gameState.players.length+"")&&ie(V,Y)},d(k){k&&p(t),P=!1,A()}}}function lt(s){let t,n,e,o="PONG",m,c,b,I,E,U="rename user",h,u,w,Y,V,_,S,L,v,D,M,P="Create Room",A,y,k,l="Refresh",a,R,O="",H,J,Q,ee,i="s",C,N,z=s[4]&&Xe(s),ue=ze(s[0]),K=[];for(let T=0;T<ue.length;T+=1)K[T]=Ge(Je(s,ue,T));return{c(){t=f("div"),z&&z.c(),n=B(),e=f("h1"),e.textContent=o,m=B(),c=f("div"),b=f("input"),I=B(),E=f("button"),E.textContent=U,h=B(),u=f("br"),w=B(),Y=f("br"),V=B(),_=f("input"),S=B(),L=f("span"),v=f("input"),D=B(),M=f("button"),M.textContent=P,A=B(),y=f("p"),k=f("button"),k.textContent=l,a=B(),R=f("div"),R.innerHTML=O,H=B(),J=f("div");for(let T=0;T<K.length;T+=1)K[T].c();Q=B(),ee=f("p"),ee.textContent=i,this.h()},l(T){t=g(T,"DIV",{class:!0});var X=W(t);z&&z.l(X),n=F(X),e=g(X,"H1",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1jnr5i3"&&(e.textContent=o),m=F(X),c=g(X,"DIV",{class:!0,style:!0});var j=W(c);b=g(j,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),I=F(j),E=g(j,"BUTTON",{class:!0,"data-svelte-h":!0}),de(E)!=="svelte-5cerf9"&&(E.textContent=U),h=F(j),u=g(j,"BR",{}),w=F(j),Y=g(j,"BR",{}),V=F(j),_=g(j,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),S=F(j),L=g(j,"SPAN",{});var le=W(L);v=g(le,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),D=F(le),M=g(le,"BUTTON",{class:!0,"data-svelte-h":!0}),de(M)!=="svelte-136z9rb"&&(M.textContent=P),le.forEach(p),j.forEach(p),A=F(X),y=g(X,"P",{});var ne=W(y);k=g(ne,"BUTTON",{class:!0,"data-svelte-h":!0}),de(k)!=="svelte-s4sqy4"&&(k.textContent=l),ne.forEach(p),a=F(X),R=g(X,"DIV",{class:!0,"data-svelte-h":!0}),de(R)!=="svelte-1hf6hku"&&(R.innerHTML=O),H=F(X),J=g(X,"DIV",{class:!0});var me=W(J);for(let fe=0;fe<K.length;fe+=1)K[fe].l(me);me.forEach(p),X.forEach(p),Q=F(T),ee=g(T,"P",{style:!0,"data-svelte-h":!0}),de(ee)!=="svelte-1fb4tdl"&&(ee.textContent=i),this.h()},h(){d(e,"class","card__title svelte-18y7b0k"),d(b,"type","text"),d(b,"placeholder","New nickname"),d(b,"maxlength","20"),d(b,"class","svelte-18y7b0k"),d(E,"class","button-small svelte-18y7b0k"),d(_,"type","text"),_.required=!0,d(_,"placeholder","Enter room name"),d(_,"maxlength","20"),d(_,"class","svelte-18y7b0k"),d(v,"type","number"),d(v,"min","0"),d(v,"max","100"),v.required=!0,d(v,"placeholder","Ball speed"),se(v,"width","100px"),se(v,"margin-left","0"),se(v,"margin-right","10px"),d(v,"class","svelte-18y7b0k"),d(M,"class","button-small svelte-18y7b0k"),d(c,"class","room svelte-18y7b0k"),se(c,"display","block"),d(k,"class","button svelte-18y7b0k"),d(R,"class","card__header svelte-18y7b0k"),d(J,"class","room-list svelte-18y7b0k"),d(t,"class","card svelte-18y7b0k"),se(ee,"color","white")},m(T,X){oe(T,t,X),z&&z.m(t,null),r(t,n),r(t,e),r(t,m),r(t,c),r(c,b),ge(b,s[3]),r(c,I),r(c,E),r(c,h),r(c,u),r(c,w),r(c,Y),r(c,V),r(c,_),ge(_,s[1]),r(c,S),r(c,L),r(L,v),ge(v,s[2]),r(L,D),r(L,M),r(t,A),r(t,y),r(y,k),r(t,a),r(t,R),r(t,H),r(t,J);for(let j=0;j<K.length;j+=1)K[j]&&K[j].m(J,null);oe(T,Q,X),oe(T,ee,X),C||(N=[ae(b,"input",s[9]),ae(E,"click",s[8]),ae(_,"input",s[10]),ae(v,"input",s[11]),ae(M,"click",s[6]),ae(k,"click",s[5])],C=!0)},p(T,[X]){if(T[4]?z?z.p(T,X):(z=Xe(T),z.c(),z.m(t,n)):z&&(z.d(1),z=null),X&8&&b.value!==T[3]&&ge(b,T[3]),X&2&&_.value!==T[1]&&ge(_,T[1]),X&4&&$e(v.value)!==T[2]&&ge(v,T[2]),X&129){ue=ze(T[0]);let j;for(j=0;j<ue.length;j+=1){const le=Je(T,ue,j);K[j]?K[j].p(le,X):(K[j]=Ge(le),K[j].c(),K[j].m(J,null))}for(;j<K.length;j+=1)K[j].d(1);K.length=ue.length}},i:we,o:we,d(T){T&&(p(t),p(Q),p(ee)),z&&z.d(),tt(K,T),C=!1,Ce(N)}}}function rt(s,t,n){let e,o,m;he(s,ce,y=>n(14,e=y)),he(s,Z,y=>n(15,o=y)),he(s,re,y=>n(16,m=y));const b=window.location.origin;let I=[],E="",U,h=e?.name??"",u="",w;Ie(()=>{console.log("Rooms page mounted"),Z.subscribe(y=>{console.log("State changed",y),(y=m.connected)&&(console.log("User",e),e.room?e.room?.id?S(e.room):S({id:e.room}):Y())})}),xe(()=>{u&&(clearTimeout(w),w=setTimeout(()=>{n(4,u="")},3e3))});async function Y(){const k=await(await fetch(`${b}/list_room`)).json();console.log("resJson",k),k.status=="success"?k.rooms?n(0,I=k.rooms):(console.error("Failed to get rooms",k),n(4,u="Failed to get rooms")):(console.error("Failed to get rooms",k),n(4,u=k.message??"Failed to get rooms")),console.log("got rooms",I)}function V(){Y()}async function _(){if(!E||!U){console.error("Room name and ball speed are required"),n(4,u="Room name and ball speed are required");return}const y={name:E,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:U,ballSpeedY:U},k=`${b}/create_room`;console.log("Creating room...",k,y),await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).then(l=>l.json()).then(l=>{console.log("create room",l),l.status=="success"&&l.room?.id?(console.log("Room created successfully, joining...",l.room),S(l.room)):(console.error("Failed to create room",l.message),n(4,u=l.message??"Failed to create room"))}).catch(l=>{console.error("Failed to create room",l),n(4,u=l.message??"Failed to create room")}),console.log("Room created successfully"),Y()}async function S(y){console.log("Joining room...",y.id);const k=`${b}/join_room`,l={room_id:y.id,user_id:e.id};await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(a=>a.json()).then(a=>{console.log("joining room",a),a.status=="success"&&a.room?.id&&a.user?.id?(console.log("Joined room successfully"),q(ce,e=a.user,e),q(ce,e.room=a.room,e),console.log("User",e),L(y)):(console.error("Failed to join room",a),q(ce,e.room=null,e),n(4,u=a.message??"Failed to join room"),Y())}).catch(a=>{console.error("Failed to join room",a),n(4,u=a.message??"Failed to join room")})}function L(y){console.log("Playing room...",y),q(Z,o="play",o)}function v(){if(!h){console.error("Nickname is required"),n(4,u="Nickname is required");return}console.log("Renaming room...",E);const y=`${b}/login`,k={id:e.id,name:h};fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}).then(l=>l.json()).then(l=>{console.log("rename user",l),l.status=="success"&&l.user?.id?(console.log("User renamed successfully"),q(ce,e=l.user,e)):(console.error("Failed to rename user",l),n(4,u=l.message??"Failed to rename user"))}).catch(l=>{console.error("Failed to rename user",l),n(4,u=l.message??"Failed to rename user")})}function D(){h=this.value,n(3,h)}function M(){E=this.value,n(1,E)}function P(){U=$e(this.value),n(2,U)}return[I,E,U,h,u,V,_,S,v,D,M,P,y=>S(y)]}class at extends Re{constructor(t){super(),Ne(this,t,rt,lt,Pe,{})}}new TextEncoder;function it(s){let t,n,e,o,m=s[4]?.players?.[0]?.user?.name+"",c,b,I,E,U=s[4]?.players?.[0]?.wins+"",h,u,w,Y="PONG",V,_,S,L=(s[4]?.players?.[1]?.user?.name??"...")+"",v,D,M,P,A=(s[4]?.players?.[1]?.wins??0)+"",y,k,l,a,R,O,H,J,Q=s[4]?.isRunning?"pause":"start",ee,i,C,N=s[2]?"hide":"show",z,ue,K,T,X="leave",j,le,ne,me,fe,_e,ye,Ue;return{c(){t=f("div"),n=f("div"),e=f("div"),o=f("h3"),c=x(m),b=B(),I=f("p"),E=x("Wins: "),h=x(U),u=B(),w=f("h1"),w.textContent=Y,V=B(),_=f("div"),S=f("h3"),v=x(L),D=B(),M=f("p"),P=x("Wins: "),y=x(A),k=B(),l=f("p"),a=f("canvas"),H=B(),J=f("button"),ee=x(Q),i=B(),C=f("button"),z=x(N),ue=x(" WS"),K=B(),T=f("button"),T.textContent=X,j=B(),le=f("p"),ne=f("canvas"),this.h()},l(te){t=g(te,"DIV",{style:!0,class:!0});var G=W(t);n=g(G,"DIV",{class:!0});var pe=W(n);e=g(pe,"DIV",{class:!0});var ve=W(e);o=g(ve,"H3",{});var Ae=W(o);c=$(Ae,m),Ae.forEach(p),b=F(ve),I=g(ve,"P",{});var ke=W(I);E=$(ke,"Wins: "),h=$(ke,U),ke.forEach(p),ve.forEach(p),u=F(pe),w=g(pe,"H1",{class:!0,"data-svelte-h":!0}),de(w)!=="svelte-106hqp2"&&(w.textContent=Y),V=F(pe),_=g(pe,"DIV",{class:!0});var be=W(_);S=g(be,"H3",{});var De=W(S);v=$(De,L),De.forEach(p),D=F(be),M=g(be,"P",{});var Se=W(M);P=$(Se,"Wins: "),y=$(Se,A),Se.forEach(p),be.forEach(p),pe.forEach(p),k=F(G),l=g(G,"P",{});var je=W(l);a=g(je,"CANVAS",{width:!0,height:!0,style:!0}),W(a).forEach(p),je.forEach(p),H=F(G),J=g(G,"BUTTON",{style:!0,class:!0});var Oe=W(J);ee=$(Oe,Q),Oe.forEach(p),i=F(G),C=g(G,"BUTTON",{style:!0,class:!0});var Te=W(C);z=$(Te,N),ue=$(Te," WS"),Te.forEach(p),K=F(G),T=g(G,"BUTTON",{style:!0,class:!0,"data-svelte-h":!0}),de(T)!=="svelte-1j2tb4n"&&(T.textContent=X),j=F(G),le=g(G,"P",{});var Ve=W(le);ne=g(Ve,"CANVAS",{width:!0,height:!0,style:!0}),W(ne).forEach(p),Ve.forEach(p),G.forEach(p),this.h()},h(){d(e,"class","player1 svelte-1x1n3za"),d(w,"class","svelte-1x1n3za"),d(_,"class","player2 svelte-1x1n3za"),d(n,"class","scoreboard svelte-1x1n3za"),d(a,"width",R=s[3].width),d(a,"height",O=s[3].height),se(a,"background","black"),se(J,"margin-right","5px"),se(J,"margin-left","5px"),d(J,"class","svelte-1x1n3za"),se(C,"margin-right","5px"),se(C,"margin-left","5px"),d(C,"class","svelte-1x1n3za"),se(T,"margin-right","5px"),se(T,"margin-left","5px"),d(T,"class","svelte-1x1n3za"),ne.hidden=me=!s[2],d(ne,"width",fe=s[3].width),d(ne,"height",_e=s[3].height),se(ne,"background","black"),se(t,"width","800px"),d(t,"class","cent svelte-1x1n3za")},m(te,G){oe(te,t,G),r(t,n),r(n,e),r(e,o),r(o,c),r(e,b),r(e,I),r(I,E),r(I,h),r(n,u),r(n,w),r(n,V),r(n,_),r(_,S),r(S,v),r(_,D),r(_,M),r(M,P),r(M,y),r(t,k),r(t,l),r(l,a),s[13](a),r(t,H),r(t,J),r(J,ee),r(t,i),r(t,C),r(C,z),r(C,ue),r(t,K),r(t,T),r(t,j),r(t,le),r(le,ne),s[14](ne),ye||(Ue=[ae(a,"mousemove",s[5]),ae(J,"click",s[6]),ae(C,"click",s[8]),ae(T,"click",s[7])],ye=!0)},p(te,G){G[0]&16&&m!==(m=te[4]?.players?.[0]?.user?.name+"")&&ie(c,m),G[0]&16&&U!==(U=te[4]?.players?.[0]?.wins+"")&&ie(h,U),G[0]&16&&L!==(L=(te[4]?.players?.[1]?.user?.name??"...")+"")&&ie(v,L),G[0]&16&&A!==(A=(te[4]?.players?.[1]?.wins??0)+"")&&ie(y,A),G[0]&8&&R!==(R=te[3].width)&&d(a,"width",R),G[0]&8&&O!==(O=te[3].height)&&d(a,"height",O),G[0]&16&&Q!==(Q=te[4]?.isRunning?"pause":"start")&&ie(ee,Q),G[0]&4&&N!==(N=te[2]?"hide":"show")&&ie(z,N),G[0]&4&&me!==(me=!te[2])&&(ne.hidden=me),G[0]&8&&fe!==(fe=te[3].width)&&d(ne,"width",fe),G[0]&8&&_e!==(_e=te[3].height)&&d(ne,"height",_e)},i:we,o:we,d(te){te&&p(t),s[13](null),s[14](null),ye=!1,Ce(Ue)}}}function ct(s,t,n){let e,o,m;he(s,ce,i=>n(21,e=i)),he(s,re,i=>n(22,o=i)),he(s,Z,i=>n(23,m=i));let c,b,I,E,U,h=!1;const u=1e3/30,Y=window.location.origin;let V=0,_={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},S={ballX:Math.floor(_.width/2),ballY:Math.floor(_.height/2),players:[{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}],isRunning:!1},L={...S},v={paddleY:Math.floor(_.height/2)};function D(){console.log("Initializing game"),I=c.getContext("2d"),E=b.getContext("2d"),a(I,S),a(E,L),l(),k()}function M(){const i=S.players.findIndex(C=>C.user.id==e.id);i>-1?V=i:console.error("Player not found in game state",S.players,e.id)}function P(i){try{i.players[V].paddleY=v.paddleY}catch(C){console.error("Error in converting state",C)}n(4,S={...i})}function A(i){n(3,_={...i})}function y(i){n(4,S.isRunning=i,S)}async function k(){for(;;){await new Promise(i=>setTimeout(i,u));try{if(S.isRunning)if(o.connected){let i=new Uint8Array(Uint16Array.of(v.paddleY).buffer),C=[1,i[0],i[1]];const N=Uint8Array.of(...C);o.wt.send(N)}else{console.error("Connection not ready");continue}}catch(i){console.error("Error in transmit loop",i)}}}function l(){try{a(I,S),a(E,L)}catch(i){console.error("Error in draw loop",i)}U=requestAnimationFrame(l)}function a(i,C){i.clearRect(0,0,c.width,c.height),i.fillStyle="white",i.beginPath(),i.arc(C.ballX,C.ballY,_.ballRadius,0,Math.PI*2),i.fill(),i.fillRect(0,C.players?.[0]?.paddleY,_.paddleWidth,_.paddleHeight),i.fillRect(c.width-_.paddleWidth,C.players?.[1]?.paddleY,_.paddleWidth,_.paddleHeight),i.strokeStyle="white",i.lineWidth=3,i.setLineDash([20,40]),i.beginPath(),i.moveTo(c.width/2,0),i.lineTo(c.width/2,c.height),i.stroke(),C.players&&C.players.length>0&&(i.fillStyle="white",i.font="bold 50px Arial",i.fillText(C.players[0]?.score?.toString()??"0",c.width/2-70,70,100),i.fillText(C.players[1]?.score?.toString()??"0",c.width/2+40,70,100)),C.isRunning||(i.fillStyle="white",i.font="bold 50px Arial",i.fillText("▐▐ ",20,80,200))}Ie(()=>{D()}),et(()=>{cancelAnimationFrame(U)});function R(i){const C=c.getBoundingClientRect(),N=i.clientY-C.top-_.paddleHeight/2,z=Math.max(1,Math.min(c.height-_.paddleHeight,N));v.paddleY=z,n(4,S.players[V].paddleY=z,S)}function O(){console.log(o),o.connected?o.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function H(){const i={room_id:e.room.id,user_id:e.id},C=`${Y}/leave_room`;console.log("Leaving room...",i,C),fetch(C,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(N=>N.json()).then(N=>{N.status=="success"&&N.user?.id&&N.room?.id?(console.log("Leave room successful"),q(ce,e=N.user,e),q(Z,m="harusnya mainmenu",m)):console.error("Failed to leave room",N)}).catch(N=>{console.error("Error in leave room request",N)})}o.addListener("wt",(i,C)=>{P(C)}),o.addListener("ws",(i,C)=>{L=C}),Z.subscribe(i=>{i=="play"&&(A({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),P(e.room.gameState),M())});function J(){n(2,h=!h)}function Q(i){Ee[i?"unshift":"push"](()=>{c=i,n(0,c)})}function ee(i){Ee[i?"unshift":"push"](()=>{b=i,n(1,b)})}return[c,b,h,_,S,R,O,H,J,M,P,A,y,Q,ee]}class ut extends Re{constructor(t){super(),Ne(this,t,ct,it,Pe,{setPlayerSide:9,setState:10,setRoomConfig:11,setRunning:12},null,[-1,-1])}get setPlayerSide(){return this.$$.ctx[9]}get setState(){return this.$$.ctx[10]}get setRoomConfig(){return this.$$.ctx[11]}get setRunning(){return this.$$.ctx[12]}}globalThis.__sveltekit_17emkux.env??(await ot(()=>import(globalThis.__sveltekit_17emkux.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function dt(s){let t,n;return{c(){t=f("h2"),n=x(s[3])},l(e){t=g(e,"H2",{});var o=W(t);n=$(o,s[3]),o.forEach(p)},m(e,o){oe(e,t,o),r(t,n)},p(e,o){o&8&&ie(n,e[3])},d(e){e&&p(t)}}}function ht(s){let t,n="username",e,o,m,c,b,I,E,U,h=s[2]&&Ke(s);return{c(){t=f("h1"),t.textContent=n,e=B(),o=f("input"),m=B(),c=f("input"),b=B(),h&&h.c(),I=Me(),this.h()},l(u){t=g(u,"H1",{class:!0,"data-svelte-h":!0}),de(t)!=="svelte-18bhqtc"&&(t.textContent=n),e=F(u),o=g(u,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),m=F(u),c=g(u,"INPUT",{type:!0,class:!0}),b=F(u),h&&h.l(u),I=Me(),this.h()},h(){d(t,"class","svelte-1264fyt"),d(o,"type","text"),d(o,"placeholder","your nickname"),d(o,"autocomplete","off"),d(o,"spellcheck","false"),d(o,"maxlength","20"),d(o,"class","svelte-1264fyt"),d(c,"type","submit"),c.value="Enter",d(c,"class","svelte-1264fyt")},m(u,w){oe(u,t,w),oe(u,e,w),oe(u,o,w),ge(o,s[1]),oe(u,m,w),oe(u,c,w),oe(u,b,w),h&&h.m(u,w),oe(u,I,w),E||(U=[ae(o,"input",s[5]),ae(c,"click",s[4])],E=!0)},p(u,w){w&2&&o.value!==u[1]&&ge(o,u[1]),u[2]?h?h.p(u,w):(h=Ke(u),h.c(),h.m(I.parentNode,I)):h&&(h.d(1),h=null)},d(u){u&&(p(t),p(e),p(o),p(m),p(c),p(b),p(I)),h&&h.d(u),E=!1,Ce(U)}}}function Ke(s){let t,n,e;return{c(){t=f("div"),n=f("p"),e=x(s[2]),this.h()},l(o){t=g(o,"DIV",{class:!0});var m=W(t);n=g(m,"P",{});var c=W(n);e=$(c,s[2]),c.forEach(p),m.forEach(p),this.h()},h(){d(t,"class","error-message svelte-1264fyt")},m(o,m){oe(o,t,m),r(t,n),r(n,e)},p(o,m){m&4&&ie(e,o[2])},d(o){o&&p(t)}}}function ft(s){let t,n,e,o,m,c,b,I,E,U,h,u,w,Y,V,_,S;function L(P,A){if(P[3]==="idle")return ht;if(P[3]!=="harusnya mainmenu"&&P[3]!=="play")return dt}let v=L(s),D=v&&v(s);h=new at({});let M={};return V=new ut({props:M}),s[6](V),{c(){t=f("body"),n=f("div"),e=f("p"),o=x("state = "),m=x(s[3]),c=B(),b=f("div"),D&&D.c(),I=B(),E=f("div"),U=f("div"),Le(h.$$.fragment),w=B(),Y=f("div"),Le(V.$$.fragment),this.h()},l(P){t=g(P,"BODY",{class:!0});var A=W(t);n=g(A,"DIV",{});var y=W(n);e=g(y,"P",{});var k=W(e);o=$(k,"state = "),m=$(k,s[3]),k.forEach(p),y.forEach(p),c=F(A),b=g(A,"DIV",{class:!0});var l=W(b);D&&D.l(l),l.forEach(p),I=F(A),E=g(A,"DIV",{});var a=W(E);U=g(a,"DIV",{class:!0});var R=W(U);Be(h.$$.fragment,R),R.forEach(p),a.forEach(p),w=F(A),Y=g(A,"DIV",{});var O=W(Y);Be(V.$$.fragment,O),O.forEach(p),A.forEach(p),this.h()},h(){d(b,"class","cent svelte-1264fyt"),d(U,"class","cent svelte-1264fyt"),E.hidden=u=s[3]!=="harusnya mainmenu",Y.hidden=_=s[3]!=="play",d(t,"class","svelte-1264fyt")},m(P,A){oe(P,t,A),r(t,n),r(n,e),r(e,o),r(e,m),r(t,c),r(t,b),D&&D.m(b,null),r(t,I),r(t,E),r(E,U),Fe(h,U,null),r(t,w),r(t,Y),Fe(V,Y,null),S=!0},p(P,[A]){(!S||A&8)&&ie(m,P[3]),v===(v=L(P))&&D?D.p(P,A):(D&&D.d(1),D=v&&v(P),D&&(D.c(),D.m(b,null))),(!S||A&8&&u!==(u=P[3]!=="harusnya mainmenu"))&&(E.hidden=u);const y={};V.$set(y),(!S||A&8&&_!==(_=P[3]!=="play"))&&(Y.hidden=_)},i(P){S||(Ye(h.$$.fragment,P),Ye(V.$$.fragment,P),S=!0)},o(P){He(h.$$.fragment,P),He(V.$$.fragment,P),S=!1},d(P){P&&p(t),D&&D.d(),qe(h),s[6](null),qe(V)}}}async function Qe(s){console.log("waiting for registration...",s);const t=5e3,n=new Promise((o,m)=>{const c=setInterval(()=>{s.register_status==="registered"&&(clearInterval(c),o())},100)}),e=new Promise((o,m)=>{setTimeout(()=>{m(new Error("Registration timeout"))},t)});return await Promise.race([n,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(o=>!1)}function Ze(s){const n=new TextDecoder("utf-8").decode(s);return JSON.parse(n)}function gt(s){return new Promise(t=>setTimeout(t,s))}function mt(s,t,n){let e,o,m;he(s,re,l=>n(9,e=l)),he(s,Z,l=>n(3,o=l)),he(s,ce,l=>n(10,m=l));let c;const b=window.location.origin,I=b,E=b+"/wt",U=b+"/ws";let h="",u=null;q(Z,o="idle",o);let w="",Y;Ie(()=>{console.log("mounted"),u=localStorage.getItem("id_user"),console.log("saved id_user",u),u&&V(),ce.subscribe(l=>{console.log("user changed",l)})}),xe(()=>{w&&(clearTimeout(Y),Y=setTimeout(()=>{n(2,w="")},3e3))});function V(){if(!h&&!u){n(2,w="Please enter your nickname");return}const l=`${I}/login`;u=localStorage.getItem("id_user"),console.log(`logging in... name=${h} id=${u} host=${l}`);const a={name:h,id:u??void 0};q(Z,o="logging in",o),fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(R=>{if(!R.ok)throw new Error("Network response was not ok");return R.json()}).then(R=>{console.log("logged in with user",R),R.code==200?(q(Z,o="connecting transport",o),ce.set(R.user),M().then(()=>{localStorage.setItem("id_user",m.id)}).catch(O=>{console.error(O),q(Z,o="idle",o)})):(n(2,w=R.message??"Error logging in"),localStorage.clear("id_user"),u=null,ce.set(null),q(Z,o="idle",o))}).catch(R=>{n(2,w=R.message??"Error logging in"),console.error(R),q(Z,o="idle",o)})}async function _(){if(console.log("connecting transport..."),q(Z,o="connecting webTransport",o),await P()){if(console.log("connected webtransport"),q(Z,o="registering webTransport",o),!await S())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),q(Z,o="connecting webSocket",o),await A()){if(console.log("connected webSocket"),q(Z,o="registering webSocket",o),!await L())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return q(re,e.connected=!0,e),q(Z,o="harusnya mainmenu",o),2}async function S(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(m.id))),q(re,e.wt.register_status="registering",e),await Qe(e.wt)}async function L(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(m.id))),q(re,e.ws.register_status="registering",e),await Qe(e.ws)}q(re,e.addListener=(l,a)=>{e[l+"_listeners"]==null&&q(re,e[l+"_listeners"]=[],e);const R=e[l+"_listeners"].length;return e[l+"_listeners"].push(a),R},e),q(re,e.removeListener=(l,a)=>{q(re,e[l+"_listeners"]=null,e)},e);function v(l,a){console.log("handling message",a),l.register_status==="registering"&&(l.register_status="registered",console.log("register messsage received",l)),e[l.protocol+"_listeners"].forEach(R=>{try{R&&R(l,a)}catch(O){console.error("Error calling listener",O)}})}async function D(l){if(e.connected){console.log("handling disconnect",l);try{delete e[l?.protocol],delete e.ws}catch(a){console.log("error deleting transport",a)}q(re,e.connected=!1,e),await M()}}async function M(){for(console.log("reconnecting..."),q(Z,o="reconnecting",o);;){console.log("reconnecting...");const l=await _();if(l===2||l===1){l===1?(console.log("reconnected, but failed registering"),window.location.href="/"):console.log("reconnected"),q(Z,o="harusnya mainmenu",o);break}console.log("reconnecting again in 3 sec..."),await gt(3e3)}}async function P(){const l=`${E}/wt`,a=new WebTransport(l);if(a.closed.then(()=>{console.log("WebTransport closed",a),D(a)}).catch(N=>{console.error("WebTransport $connection died:",N,a),D(a)}),console.log("webtransport connecting...",l),!await a.ready.then(()=>(console.log("WebTransport connected",a),!0)).catch(N=>(console.error("WebTransport $connection failed:",N),!1)))return!1;const O={protocol:"wt",register_status:"unregistered",transport:a,isReading:!1},H=O.transport.datagrams,J=H.writable.getWriter(),Q=H.readable.getReader();O.send=N=>{J.write(N)},async function(){for(;;){const{value:N,done:z}=await Q.read();if(z){console.log("Done reading datagram, stop reading...",value);return}v(O,Ze(N))}}().catch(N=>{console.error("reading datagram failed, stop reading...:",N)});const ee=await a.createBidirectionalStream(),i=ee.writable.getWriter(),C=ee.readable.getReader();return O.send_reliable=N=>{i.write(N)},async function(){for(;;){const{value:N,done:z}=await C.read();if(z){console.log("Done reading stream, stop reading...",value);return}v(O,Ze(N))}}().catch(N=>{console.error("reading datagram failed, stop reading...:",N)}),q(re,e.wt=O,e),!0}async function A(){const l=`${U}/ws`,a=new WebSocket(l);if(console.log("websocket connecting...",l),!await new Promise((H,J)=>{a.onopen=()=>{console.log(a,"WebSocket connected"),H(!0)},a.onerror_message=Q=>{console.error("WebSocket error:",Q),J(Q)}}).catch(H=>(console.error("WebSocket $connection failed:",H),!1)))return!1;const O={protocol:"ws",register_status:"unregistered",transport:a,isReading:!1};return O.send=H=>{O.transport.send(H)},O.send_reliable=H=>{O.transport.send(H)},a.addEventListener("message",H=>{v(O,JSON.parse(H.data))}),a.addEventListener("close",H=>{H.wasClean?console.log("WebSocket closed",H):console.error("WebSocket $connection died",H)}),q(re,e.ws=O,e),!0}function y(){h=this.value,n(1,h)}function k(l){Ee[l?"unshift":"push"](()=>{c=l,n(0,c)})}return[c,h,w,o,V,y,k]}class wt extends Re{constructor(t){super(),Ne(this,t,mt,ft,Pe,{})}}export{wt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}