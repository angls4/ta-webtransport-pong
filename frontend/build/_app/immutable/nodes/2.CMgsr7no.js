import{s as Pe,n as Ee,r as Re,e as me,o as je,a as et,f as J,h as nt,b as ke}from"../chunks/scheduler.CTimOCLo.js";import{S as Ne,i as Ae,g,s as F,m as ee,h as p,j as P,c as B,y as ge,n as te,f as m,k as u,l as ie,a as le,x as l,z as _e,A as ue,o as de,B as tt,C as ot,r as Fe,u as Be,v as Ve,d as He,t as Ye,w as Me,e as qe}from"../chunks/index.CRnmY6F2.js";import{w as Ue}from"../chunks/index.BXnrS5-F.js";import{_ as st}from"../chunks/preload-helper.CRk0x-X1.js";function Je(s){return s?.length!==void 0?s:Array.from(s)}const lt={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},rt={id:null,name:"",room:null,player:null},ce=Ue(lt),he=Ue(rt),oe=Ue("login page");function ze(s,t,o){const e=s.slice();return e[23]=t[o],e}function Ge(s){let t,o,e;return{c(){t=g("div"),o=g("p"),e=ee(s[4]),this.h()},l(n){t=p(n,"DIV",{class:!0});var d=P(t);o=p(d,"P",{});var a=P(o);e=te(a,s[4]),a.forEach(m),d.forEach(m),this.h()},h(){u(t,"class","error-message svelte-17jni71")},m(n,d){le(n,t,d),l(t,o),l(o,e)},p(n,d){d&16&&de(e,n[4])},d(n){n&&m(t)}}}function Xe(s){let t,o,e,n,d=s[23].name+"",a,W,T,R,S=Math.abs(s[23].ballSpeedX)+"",c,i,b,I=Object.keys(s[23].gameState.players).length+"",_,U,w,j,M,x,N,K,X,v;function q(){return s[13](s[23])}return{c(){t=g("div"),o=g("div"),e=g("div"),n=g("span"),a=ee(d),W=F(),T=g("span"),R=ee("Ball speed : "),c=ee(S),i=F(),b=g("span"),_=ee(I),U=ee("/2 Players"),w=F(),j=g("div"),M=g("button"),x=ee("JOIN"),K=F(),this.h()},l(h){t=p(h,"DIV",{class:!0});var y=P(t);o=p(y,"DIV",{class:!0});var f=P(o);e=p(f,"DIV",{class:!0});var C=P(e);n=p(C,"SPAN",{});var O=P(n);a=te(O,d),O.forEach(m),C.forEach(m),W=B(f),T=p(f,"SPAN",{class:!0});var D=P(T);R=te(D,"Ball speed : "),c=te(D,S),D.forEach(m),i=B(f),b=p(f,"SPAN",{class:!0});var Y=P(b);_=te(Y,I),U=te(Y,"/2 Players"),Y.forEach(m),f.forEach(m),w=B(y),j=p(y,"DIV",{});var r=P(j);M=p(r,"BUTTON",{class:!0});var E=P(M);x=te(E,"JOIN"),E.forEach(m),r.forEach(m),K=B(y),y.forEach(m),this.h()},h(){u(e,"class","room__name svelte-17jni71"),u(T,"class","room__detail svelte-17jni71"),u(b,"class","room__detail svelte-17jni71"),u(o,"class","room__info svelte-17jni71"),u(M,"class","button svelte-17jni71"),M.disabled=N=Object.keys(s[23].gameState.players).length>=2,u(t,"class","room svelte-17jni71")},m(h,y){le(h,t,y),l(t,o),l(o,e),l(e,n),l(n,a),l(o,W),l(o,T),l(T,R),l(T,c),l(o,i),l(o,b),l(b,_),l(b,U),l(t,w),l(t,j),l(j,M),l(M,x),l(t,K),X||(v=ue(M,"click",q),X=!0)},p(h,y){s=h,y&1&&d!==(d=s[23].name+"")&&de(a,d),y&1&&S!==(S=Math.abs(s[23].ballSpeedX)+"")&&de(c,S),y&1&&I!==(I=Object.keys(s[23].gameState.players).length+"")&&de(_,I),y&1&&N!==(N=Object.keys(s[23].gameState.players).length>=2)&&(M.disabled=N)},d(h){h&&m(t),X=!1,v()}}}function Ke(s){let t,o="<span>No rooms available</span>";return{c(){t=g("p"),t.innerHTML=o,this.h()},l(e){t=p(e,"P",{style:!0,"data-svelte-h":!0}),ge(t)!=="svelte-156qi2m"&&(t.innerHTML=o),this.h()},h(){ie(t,"color","grey")},m(e,n){le(e,t,n)},d(e){e&&m(t)}}}function it(s){let t,o,e,n="PONG",d,a,W,T=s[5]?.name+"",R,S,c,i,b,I,_="rename user",U,w,j,M,x,N,K,X,v,q,h,y="Create Room",f,C,O,D="Refresh",Y,r,E="",V,se,fe,z,re,ae="s",we,be,Q=s[4]&&Ge(s),ne=Je(s[0]),Z=[];for(let k=0;k<ne.length;k+=1)Z[k]=Xe(ze(s,ne,k));let $=s[0].length==0&&Ke();return{c(){t=g("div"),Q&&Q.c(),o=F(),e=g("h1"),e.textContent=n,d=F(),a=g("h2"),W=ee("Welcome, "),R=ee(T),S=F(),c=g("div"),i=g("input"),b=F(),I=g("button"),I.textContent=_,U=F(),w=g("br"),j=F(),M=g("br"),x=F(),N=g("input"),K=F(),X=g("span"),v=g("input"),q=F(),h=g("button"),h.textContent=y,f=F(),C=g("p"),O=g("button"),O.textContent=D,Y=F(),r=g("div"),r.innerHTML=E,V=F(),se=g("div");for(let k=0;k<Z.length;k+=1)Z[k].c();fe=F(),$&&$.c(),z=F(),re=g("p"),re.textContent=ae,this.h()},l(k){t=p(k,"DIV",{class:!0});var L=P(t);Q&&Q.l(L),o=B(L),e=p(L,"H1",{class:!0,"data-svelte-h":!0}),ge(e)!=="svelte-1jnr5i3"&&(e.textContent=n),d=B(L),a=p(L,"H2",{class:!0});var G=P(a);W=te(G,"Welcome, "),R=te(G,T),G.forEach(m),S=B(L),c=p(L,"DIV",{class:!0,style:!0});var A=P(c);i=p(A,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),b=B(A),I=p(A,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(I)!=="svelte-5cerf9"&&(I.textContent=_),U=B(A),w=p(A,"BR",{}),j=B(A),M=p(A,"BR",{}),x=B(A),N=p(A,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),K=B(A),X=p(A,"SPAN",{});var H=P(X);v=p(H,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),q=B(H),h=p(H,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(h)!=="svelte-136z9rb"&&(h.textContent=y),H.forEach(m),A.forEach(m),f=B(L),C=p(L,"P",{});var pe=P(C);O=p(pe,"BUTTON",{class:!0,"data-svelte-h":!0}),ge(O)!=="svelte-s4sqy4"&&(O.textContent=D),pe.forEach(m),Y=B(L),r=p(L,"DIV",{class:!0,"data-svelte-h":!0}),ge(r)!=="svelte-1hf6hku"&&(r.innerHTML=E),V=B(L),se=p(L,"DIV",{class:!0});var ve=P(se);for(let ye=0;ye<Z.length;ye+=1)Z[ye].l(ve);ve.forEach(m),fe=B(L),$&&$.l(L),L.forEach(m),z=B(k),re=p(k,"P",{style:!0,"data-svelte-h":!0}),ge(re)!=="svelte-1fb4tdl"&&(re.textContent=ae),this.h()},h(){u(e,"class","card__title svelte-17jni71"),u(a,"class","svelte-17jni71"),u(i,"type","text"),u(i,"placeholder","New nickname"),u(i,"maxlength","20"),u(i,"class","svelte-17jni71"),u(I,"class","button-small svelte-17jni71"),u(N,"type","text"),N.required=!0,u(N,"placeholder","Enter room name"),u(N,"maxlength","20"),u(N,"class","svelte-17jni71"),u(v,"type","number"),u(v,"min","0"),u(v,"max","100"),v.required=!0,u(v,"placeholder","Ball speed"),ie(v,"width","100px"),ie(v,"margin-left","0"),ie(v,"margin-right","10px"),u(v,"class","svelte-17jni71"),u(h,"class","button-small svelte-17jni71"),u(c,"class","room svelte-17jni71"),ie(c,"display","block"),u(O,"class","button svelte-17jni71"),u(r,"class","card__header svelte-17jni71"),u(se,"class","room-list svelte-17jni71"),u(t,"class","card svelte-17jni71"),ie(re,"color","white")},m(k,L){le(k,t,L),Q&&Q.m(t,null),l(t,o),l(t,e),l(t,d),l(t,a),l(a,W),l(a,R),l(t,S),l(t,c),l(c,i),_e(i,s[3]),l(c,b),l(c,I),l(c,U),l(c,w),l(c,j),l(c,M),l(c,x),l(c,N),_e(N,s[1]),l(c,K),l(c,X),l(X,v),_e(v,s[2]),l(X,q),l(X,h),l(t,f),l(t,C),l(C,O),l(t,Y),l(t,r),l(t,V),l(t,se);for(let G=0;G<Z.length;G+=1)Z[G]&&Z[G].m(se,null);l(t,fe),$&&$.m(t,null),le(k,z,L),le(k,re,L),we||(be=[ue(i,"input",s[10]),ue(I,"click",s[9]),ue(N,"input",s[11]),ue(v,"input",s[12]),ue(h,"click",s[7]),ue(O,"click",s[6])],we=!0)},p(k,[L]){if(k[4]?Q?Q.p(k,L):(Q=Ge(k),Q.c(),Q.m(t,o)):Q&&(Q.d(1),Q=null),L&32&&T!==(T=k[5]?.name+"")&&de(R,T),L&8&&i.value!==k[3]&&_e(i,k[3]),L&2&&N.value!==k[1]&&_e(N,k[1]),L&4&&tt(v.value)!==k[2]&&_e(v,k[2]),L&257){ne=Je(k[0]);let G;for(G=0;G<ne.length;G+=1){const A=ze(k,ne,G);Z[G]?Z[G].p(A,L):(Z[G]=Xe(A),Z[G].c(),Z[G].m(se,null))}for(;G<Z.length;G+=1)Z[G].d(1);Z.length=ne.length}k[0].length==0?$||($=Ke(),$.c(),$.m(t,null)):$&&($.d(1),$=null)},i:Ee,o:Ee,d(k){k&&(m(t),m(z),m(re)),Q&&Q.d(),ot(Z,k),$&&$.d(),we=!1,Re(be)}}}function at(s,t,o){let e,n,d;me(s,he,v=>o(5,e=v)),me(s,oe,v=>o(15,n=v)),me(s,ce,v=>o(16,d=v));const W=window.location.origin;let T=[],R="",S,c=e?.name??"",i="",b;je(()=>{console.log("Rooms page mounted"),oe.subscribe(v=>{console.log("State changed",v),(v=d.connected)&&(console.log("User",e),e.room?e.room?.id?w(e.room):w({id:e.room}):I())})}),et(()=>{i&&(clearTimeout(b),b=setTimeout(()=>{o(4,i="")},3e3))});async function I(){const q=await(await fetch(`${W}/list_room`)).json();console.log("resJson",q),q.status=="success"?q.rooms?o(0,T=q.rooms):(console.error("Failed to get rooms",q),o(4,i="Failed to get rooms")):(console.error("Failed to get rooms",q),o(4,i=q.message??"Failed to get rooms")),console.log("got rooms",T)}function _(){I()}async function U(){if(!R||!S){console.error("Room name and ball speed are required"),o(4,i="Room name and ball speed are required");return}const v={name:R,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:S,ballSpeedY:S},q=`${W}/create_room`;console.log("Creating room...",q,v),await fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}).then(h=>h.json()).then(h=>{console.log("create room",h),h.status=="success"&&h.room?.id?(console.log("Room created successfully, joining...",h.room),w(h.room)):(console.error("Failed to create room",h.message),o(4,i=h.message??"Failed to create room"))}).catch(h=>{console.error("Failed to create room",h),o(4,i=h.message??"Failed to create room")}),console.log("Room created successfully"),I()}async function w(v){console.log("Joining room...",v.id);const q=`${W}/join_room`,h={room_id:v.id,user_id:e.id};await fetch(q,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).then(y=>y.json()).then(y=>{console.log("joining room",y),y.status=="success"&&y.room?.id&&y.user?.id?(console.log("Joined room successfully"),J(he,e=y.user,e),J(he,e.room=y.room,e),console.log("User",e),j(v)):(console.error("Failed to join room",y),J(he,e.room=null,e),o(4,i=y.message??"Failed to join room"),I())}).catch(y=>{console.error("Failed to join room",y),o(4,i=y.message??"Failed to join room")})}function j(v){console.log("Playing room...",v),J(oe,n="game room",n)}function M(){if(!c){console.error("Nickname is required"),o(4,i="Nickname is required");return}console.log("Renaming room...",R);const v=`${W}/login`,q={id:e.id,name:c};fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)}).then(h=>h.json()).then(h=>{console.log("rename user",h),h.status=="success"&&h.user?.id?(console.log("User renamed successfully"),J(he,e=h.user,e)):(console.error("Failed to rename user",h),o(4,i=h.message??"Failed to rename user"))}).catch(h=>{console.error("Failed to rename user",h),o(4,i=h.message??"Failed to rename user")})}function x(){c=this.value,o(3,c)}function N(){R=this.value,o(1,R)}function K(){S=tt(this.value),o(2,S)}return[T,R,S,c,i,e,_,U,w,M,x,N,K,v=>w(v)]}class ct extends Ne{constructor(t){super(),Ae(this,t,at,it,Pe,{})}}new TextEncoder;function ut(s){let t,o,e,n,d=(s[4]?.players?.[s[4]?.p0index]?.user?.name??"...")+"",a,W,T,R,S=(s[4]?.players?.[s[4]?.p0index]?.wins??0)+"",c,i,b,I="PONG",_,U,w,j=(s[4]?.players?.[s[4]?.p1index]?.user?.name??"...")+"",M,x,N,K,X=(s[4]?.players?.[s[4]?.p1index]?.wins??0)+"",v,q,h,y,f,C,O,D,Y=s[4]?.isRunning?"pause":"start",r,E,V,se=s[2]?"hide":"show",fe,z,re,ae,we="leave",be,Q,ne,Z,$,k,L,G;return{c(){t=g("div"),o=g("div"),e=g("div"),n=g("h3"),a=ee(d),W=F(),T=g("p"),R=ee("Wins: "),c=ee(S),i=F(),b=g("h1"),b.textContent=I,_=F(),U=g("div"),w=g("h3"),M=ee(j),x=F(),N=g("p"),K=ee("Wins: "),v=ee(X),q=F(),h=g("p"),y=g("canvas"),O=F(),D=g("button"),r=ee(Y),E=F(),V=g("button"),fe=ee(se),z=ee(" WS"),re=F(),ae=g("button"),ae.textContent=we,be=F(),Q=g("p"),ne=g("canvas"),this.h()},l(A){t=p(A,"DIV",{style:!0,class:!0});var H=P(t);o=p(H,"DIV",{class:!0});var pe=P(o);e=p(pe,"DIV",{class:!0});var ve=P(e);n=p(ve,"H3",{});var ye=P(n);a=te(ye,d),ye.forEach(m),W=B(ve),T=p(ve,"P",{});var Ce=P(T);R=te(Ce,"Wins: "),c=te(Ce,S),Ce.forEach(m),ve.forEach(m),i=B(pe),b=p(pe,"H1",{class:!0,"data-svelte-h":!0}),ge(b)!=="svelte-106hqp2"&&(b.textContent=I),_=B(pe),U=p(pe,"DIV",{class:!0});var Te=P(U);w=p(Te,"H3",{});var Oe=P(w);M=te(Oe,j),Oe.forEach(m),x=B(Te),N=p(Te,"P",{});var Se=P(N);K=te(Se,"Wins: "),v=te(Se,X),Se.forEach(m),Te.forEach(m),pe.forEach(m),q=B(H),h=p(H,"P",{});var We=P(h);y=p(We,"CANVAS",{width:!0,height:!0,style:!0}),P(y).forEach(m),We.forEach(m),O=B(H),D=p(H,"BUTTON",{style:!0,class:!0});var De=P(D);r=te(De,Y),De.forEach(m),E=B(H),V=p(H,"BUTTON",{style:!0,class:!0});var Ie=P(V);fe=te(Ie,se),z=te(Ie," WS"),Ie.forEach(m),re=B(H),ae=p(H,"BUTTON",{style:!0,class:!0,"data-svelte-h":!0}),ge(ae)!=="svelte-1j2tb4n"&&(ae.textContent=we),be=B(H),Q=p(H,"P",{});var Le=P(Q);ne=p(Le,"CANVAS",{width:!0,height:!0,style:!0}),P(ne).forEach(m),Le.forEach(m),H.forEach(m),this.h()},h(){u(e,"class","player1 svelte-1x1n3za"),u(b,"class","svelte-1x1n3za"),u(U,"class","player2 svelte-1x1n3za"),u(o,"class","scoreboard svelte-1x1n3za"),u(y,"width",f=s[3].width),u(y,"height",C=s[3].height),ie(y,"background","black"),ie(D,"margin-right","5px"),ie(D,"margin-left","5px"),u(D,"class","svelte-1x1n3za"),ie(V,"margin-right","5px"),ie(V,"margin-left","5px"),u(V,"class","svelte-1x1n3za"),ie(ae,"margin-right","5px"),ie(ae,"margin-left","5px"),u(ae,"class","svelte-1x1n3za"),ne.hidden=Z=!s[2],u(ne,"width",$=s[3].width),u(ne,"height",k=s[3].height),ie(ne,"background","black"),ie(t,"width","800px"),u(t,"class","cent svelte-1x1n3za")},m(A,H){le(A,t,H),l(t,o),l(o,e),l(e,n),l(n,a),l(e,W),l(e,T),l(T,R),l(T,c),l(o,i),l(o,b),l(o,_),l(o,U),l(U,w),l(w,M),l(U,x),l(U,N),l(N,K),l(N,v),l(t,q),l(t,h),l(h,y),s[13](y),l(t,O),l(t,D),l(D,r),l(t,E),l(t,V),l(V,fe),l(V,z),l(t,re),l(t,ae),l(t,be),l(t,Q),l(Q,ne),s[14](ne),L||(G=[ue(y,"mousemove",s[5]),ue(D,"click",s[6]),ue(V,"click",s[8]),ue(ae,"click",s[7])],L=!0)},p(A,H){H[0]&16&&d!==(d=(A[4]?.players?.[A[4]?.p0index]?.user?.name??"...")+"")&&de(a,d),H[0]&16&&S!==(S=(A[4]?.players?.[A[4]?.p0index]?.wins??0)+"")&&de(c,S),H[0]&16&&j!==(j=(A[4]?.players?.[A[4]?.p1index]?.user?.name??"...")+"")&&de(M,j),H[0]&16&&X!==(X=(A[4]?.players?.[A[4]?.p1index]?.wins??0)+"")&&de(v,X),H[0]&8&&f!==(f=A[3].width)&&u(y,"width",f),H[0]&8&&C!==(C=A[3].height)&&u(y,"height",C),H[0]&16&&Y!==(Y=A[4]?.isRunning?"pause":"start")&&de(r,Y),H[0]&4&&se!==(se=A[2]?"hide":"show")&&de(fe,se),H[0]&4&&Z!==(Z=!A[2])&&(ne.hidden=Z),H[0]&8&&$!==($=A[3].width)&&u(ne,"width",$),H[0]&8&&k!==(k=A[3].height)&&u(ne,"height",k)},i:Ee,o:Ee,d(A){A&&m(t),s[13](null),s[14](null),L=!1,Re(G)}}}function dt(s,t,o){let e,n,d;me(s,he,r=>o(21,e=r)),me(s,ce,r=>o(22,n=r)),me(s,oe,r=>o(23,d=r));let a,W,T,R,S,c=!1;const i=1e3/30,I=window.location.origin;let _={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},U={ballX:Math.floor(_.width/2),ballY:Math.floor(_.height/2),players:{a:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},b:{paddleY:Math.floor(_.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}},isRunning:!1,p0index:"a",p1index:"b"},w={...U},j={paddleY:Math.floor(_.height/2)};function M(){console.log("Initializing game"),T=a.getContext("2d"),R=W.getContext("2d"),h(T,U),h(R,w),q(),v()}function x(){U.players.findIndex(E=>E.user.id==e.id)>-1||console.error("Player not found in game state",U.players,e.id)}function N(r){try{r.players[e.id].paddleY=j.paddleY}catch(E){console.error("Error in converting state",E)}o(4,U={...r})}function K(r){o(3,_={...r})}function X(r){o(4,U.isRunning=r,U)}async function v(){for(;;){await new Promise(r=>setTimeout(r,i));try{if(U.isRunning)if(n.connected){let r=new Uint8Array(Uint16Array.of(j.paddleY).buffer),E=[1,r[0],r[1]];const V=Uint8Array.of(...E);n.wt.send(V)}else{console.error("Connection not ready");continue}}catch(r){console.error("Error in transmit loop",r)}}}function q(){try{h(T,U),h(R,w)}catch(r){console.error("Error in draw loop",r)}S=requestAnimationFrame(q)}function h(r,E){r.clearRect(0,0,a.width,a.height),r.fillStyle="white",r.beginPath(),r.arc(E.ballX,E.ballY,_.ballRadius,0,Math.PI*2),r.fill(),Object.keys(E?.players??{}).length>0&&(r.fillRect(0,E.players[E.p0index]?.paddleY,_.paddleWidth,_.paddleHeight),r.fillRect(a.width-_.paddleWidth,E.players[E.p1index]?.paddleY,_.paddleWidth,_.paddleHeight),r.strokeStyle="white",r.lineWidth=3,r.setLineDash([20,40]),r.beginPath(),r.moveTo(a.width/2,0),r.lineTo(a.width/2,a.height),r.stroke(),r.fillStyle="white",r.font="bold 50px Arial",r.fillText(E.players[E.p0index]?.score?.toString()??"0",a.width/2-70,70,100),r.fillText(E.players[E.p1index]?.score?.toString()??"0",a.width/2+40,70,100)),E.isRunning||(r.fillStyle="white",r.font="bold 50px Arial",r.fillText("▐▐ ",20,80,200))}je(()=>{M()}),nt(()=>{cancelAnimationFrame(S)});function y(r){const E=a.getBoundingClientRect(),V=r.clientY-E.top-_.paddleHeight/2,se=Math.max(1,Math.min(a.height-_.paddleHeight,V));j.paddleY=se,o(4,U.players[e.id].paddleY=se,U)}function f(){console.log(n),n.connected?n.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function C(){const r={room_id:e.room.id,user_id:e.id},E=`${I}/leave_room`;console.log("Leaving room...",r,E),fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(V=>V.json()).then(V=>{V.status=="success"&&V.user?.id&&V.room?.id?(console.log("Leave room successful"),J(he,e=V.user,e),J(oe,d="room list",d)):console.error("Failed to leave room",V)}).catch(V=>{console.error("Error in leave room request",V)})}n.addListener("wt",(r,E)=>{N(E)}),n.addListener("ws",(r,E)=>{w={...E}}),oe.subscribe(r=>{r=="game room"&&(K({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),N(e.room.gameState))});function O(){o(2,c=!c)}function D(r){ke[r?"unshift":"push"](()=>{a=r,o(0,a)})}function Y(r){ke[r?"unshift":"push"](()=>{W=r,o(1,W)})}return[a,W,c,_,U,y,f,C,O,x,N,K,X,D,Y]}class ht extends Ne{constructor(t){super(),Ae(this,t,dt,ut,Pe,{setPlayerSide:9,setState:10,setRoomConfig:11,setRunning:12},null,[-1,-1])}get setPlayerSide(){return this.$$.ctx[9]}get setState(){return this.$$.ctx[10]}get setRoomConfig(){return this.$$.ctx[11]}get setRunning(){return this.$$.ctx[12]}}const Qe=globalThis.__sveltekit_1netxy3.env??(await st(()=>import(globalThis.__sveltekit_1netxy3.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function ft(s){let t,o;return{c(){t=g("h2"),o=ee(s[3])},l(e){t=p(e,"H2",{});var n=P(t);o=te(n,s[3]),n.forEach(m)},m(e,n){le(e,t,n),l(t,o)},p(e,n){n&8&&de(o,e[3])},d(e){e&&m(t)}}}function gt(s){let t,o="PONG",e,n,d,a,W,T,R,S,c=s[2]&&Ze(s);return{c(){t=g("h1"),t.textContent=o,e=F(),n=g("input"),d=F(),a=g("input"),W=F(),c&&c.c(),T=qe(),this.h()},l(i){t=p(i,"H1",{class:!0,"data-svelte-h":!0}),ge(t)!=="svelte-106hqp2"&&(t.textContent=o),e=B(i),n=p(i,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),d=B(i),a=p(i,"INPUT",{type:!0,class:!0}),W=B(i),c&&c.l(i),T=qe(),this.h()},h(){u(t,"class","svelte-1av3m61"),u(n,"type","text"),u(n,"placeholder","your nickname"),u(n,"autocomplete","off"),u(n,"spellcheck","false"),u(n,"maxlength","20"),u(n,"class","svelte-1av3m61"),u(a,"type","submit"),a.value="Enter",u(a,"class","svelte-1av3m61")},m(i,b){le(i,t,b),le(i,e,b),le(i,n,b),_e(n,s[1]),le(i,d,b),le(i,a,b),le(i,W,b),c&&c.m(i,b),le(i,T,b),R||(S=[ue(n,"input",s[5]),ue(a,"click",s[4])],R=!0)},p(i,b){b&2&&n.value!==i[1]&&_e(n,i[1]),i[2]?c?c.p(i,b):(c=Ze(i),c.c(),c.m(T.parentNode,T)):c&&(c.d(1),c=null)},d(i){i&&(m(t),m(e),m(n),m(d),m(a),m(W),m(T)),c&&c.d(i),R=!1,Re(S)}}}function Ze(s){let t,o,e;return{c(){t=g("div"),o=g("p"),e=ee(s[2]),this.h()},l(n){t=p(n,"DIV",{class:!0});var d=P(t);o=p(d,"P",{});var a=P(o);e=te(a,s[2]),a.forEach(m),d.forEach(m),this.h()},h(){u(t,"class","error-message svelte-1av3m61")},m(n,d){le(n,t,d),l(t,o),l(o,e)},p(n,d){d&4&&de(e,n[2])},d(n){n&&m(t)}}}function pt(s){let t,o,e,n,d,a,W,T,R,S,c,i;function b(w,j){if(w[3]==="login page")return gt;if(w[3]!=="room list"&&w[3]!=="game room")return ft}let I=b(s),_=I&&I(s);a=new ct({});let U={};return S=new ht({props:U}),s[6](S),{c(){t=g("body"),o=g("div"),_&&_.c(),e=F(),n=g("div"),d=g("div"),Fe(a.$$.fragment),T=F(),R=g("div"),Fe(S.$$.fragment),this.h()},l(w){t=p(w,"BODY",{class:!0});var j=P(t);o=p(j,"DIV",{class:!0});var M=P(o);_&&_.l(M),M.forEach(m),e=B(j),n=p(j,"DIV",{});var x=P(n);d=p(x,"DIV",{class:!0});var N=P(d);Be(a.$$.fragment,N),N.forEach(m),x.forEach(m),T=B(j),R=p(j,"DIV",{});var K=P(R);Be(S.$$.fragment,K),K.forEach(m),j.forEach(m),this.h()},h(){u(o,"class","cent svelte-1av3m61"),u(d,"class","cent svelte-1av3m61"),n.hidden=W=s[3]!=="room list",R.hidden=c=s[3]!=="game room",u(t,"class","svelte-1av3m61")},m(w,j){le(w,t,j),l(t,o),_&&_.m(o,null),l(t,e),l(t,n),l(n,d),Ve(a,d,null),l(t,T),l(t,R),Ve(S,R,null),i=!0},p(w,[j]){I===(I=b(w))&&_?_.p(w,j):(_&&_.d(1),_=I&&I(w),_&&(_.c(),_.m(o,null))),(!i||j&8&&W!==(W=w[3]!=="room list"))&&(n.hidden=W);const M={};S.$set(M),(!i||j&8&&c!==(c=w[3]!=="game room"))&&(R.hidden=c)},i(w){i||(He(a.$$.fragment,w),He(S.$$.fragment,w),i=!0)},o(w){Ye(a.$$.fragment,w),Ye(S.$$.fragment,w),i=!1},d(w){w&&m(t),_&&_.d(),Me(a),s[6](null),Me(S)}}}const mt=1,_t=2,vt=3e3,wt=5e3;async function xe(s){console.log("waiting for registration...",s);const t=wt,o=new Promise((n,d)=>{const a=setInterval(()=>{s.register_status==="registered"&&(clearInterval(a),n())},100)}),e=new Promise((n,d)=>{setTimeout(()=>{d(new Error("Registration timeout"))},t)});return await Promise.race([o,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(n=>!1)}function $e(s){const o=new TextDecoder("utf-8").decode(s);return JSON.parse(o)}function bt(s){return new Promise(t=>setTimeout(t,s))}function yt(s){let t=s.replace(/:/g,"");if(t.length%2!==0)throw new Error("Invalid hex string");let o=new ArrayBuffer(t.length/2),e=new Uint8Array(o);for(let n=0;n<t.length;n+=2)e[n/2]=parseInt(t.substr(n,2),16);return o}function Tt(s,t,o){let e,n,d;me(s,ce,f=>o(9,e=f)),me(s,oe,f=>o(3,n=f)),me(s,he,f=>o(10,d=f));let a;const W=Qe.PUBLIC_RECONNECT_INTERVAL??3,T=window.location.origin,R=T,S=T,c=T,i=Qe.PUBLIC_HTTP3_CERTIFICATE_FINGERPRINT??"43:6E:11:10:0C:94:51:4C:10:FD:D8:F6:46:5F:DD:A4:18:70:EC:11:44:8E:C0:4D:A4:1A:B9:69:23:C3:7B:95";let b="",I=null,_="",U;je(()=>{console.log("mounted"),I=localStorage.getItem("user_id"),console.log("saved user_id",I),I&&w(),he.subscribe(f=>{console.log("user changed",f)})}),et(()=>{_&&(clearTimeout(U),U=setTimeout(()=>{o(2,_="")},vt))});function w(){if(!b&&!I){o(2,_="Please enter your nickname");return}const f=`${R}/login`;I=localStorage.getItem("user_id"),console.log(`logging in... name=${b} id=${I} host=${f}`);const C={name:b,id:I??void 0};J(oe,n="logging in",n),fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)}).then(O=>{if(!O.ok)throw new Error("Network response was not ok");return O.json()}).then(O=>{console.log("logged in with user",O),O.code==200?(J(oe,n="connecting transport",n),he.set(O.user),X().then(()=>{localStorage.setItem("user_id",d.id)}).catch(D=>{console.error(D),J(oe,n="login page",n)})):(o(2,_=O.message??"Error logging in"),localStorage.clear("user_id"),I=null,he.set(null),J(oe,n="login page",n))}).catch(O=>{o(2,_=O.message??"Error logging in"),console.error(O),J(oe,n="login page",n)})}async function j(){if(console.log("connecting transport..."),J(oe,n="connecting webTransport",n),await v()){if(console.log("connected webtransport"),J(oe,n="registering webTransport",n),!await M())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),J(oe,n="connecting webSocket",n),await q()){if(console.log("connected webSocket"),J(oe,n="registering webSocket",n),!await x())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return J(ce,e.connected=!0,e),J(oe,n="room list",n),2}async function M(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(d.id))),J(ce,e.wt.register_status="registering",e),await xe(e.wt)}async function x(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(d.id))),J(ce,e.ws.register_status="registering",e),await xe(e.ws)}J(ce,e.addListener=(f,C)=>{e[f+"_listeners"]==null&&J(ce,e[f+"_listeners"]=[],e);const O=e[f+"_listeners"].length;return e[f+"_listeners"].push(C),O},e),J(ce,e.removeListener=(f,C)=>{J(ce,e[f+"_listeners"]=null,e)},e);function N(f,C){console.log("handling message",C),f.register_status==="registering"&&(f.register_status="registered",console.log("register messsage received",f)),e[f.protocol+"_listeners"].forEach(O=>{try{O&&O(f,C)}catch(D){console.error("Error calling listener",D)}})}async function K(f){if(e.connected){console.log("webtransport disconnected, handling...");try{delete e.wt,delete e.ws}catch(C){console.log("error deleting transport",C)}J(ce,e.connected=!1,e),await X()}}async function X(){for(J(oe,n="reconnecting",n);;){console.log("reconnecting...");const f=await j();if(f==mt)console.log("reconnected, but failed registering. returning to login page..."),window.location.href="/";else if(f==_t){console.log("reconnected"),J(oe,n="room list",n);break}console.log(`reconnecting again in ${W} sec...`),await bt(W*1e3)}}async function v(){const f=`${S}/wt`,C=new WebTransport(f,{serverCertificateHashes:[{algorithm:"sha-256",value:yt(i)}]});if(C.closed.then(()=>{console.log("WebTransport closed",C),K()}).catch(z=>{console.error("WebTransport connection died:",z,C),K()}),console.log("webtransport connecting...",f),!await C.ready.then(()=>(console.log("WebTransport connected",C),!0)).catch(z=>(console.error("WebTransport connection failed:",z),!1)))return!1;const D={protocol:"wt",register_status:"unregistered",transport:C},Y=D.transport.datagrams,r=Y.writable.getWriter(),E=Y.readable.getReader();D.send=z=>{r.write(z)},async function(){for(;;){const{value:z,done:re}=await E.read();if(re){console.log("Done reading datagram, stop reading...",value);return}N(D,$e(z))}}().catch(z=>{console.error("reading datagram failed, stop reading...:",z)});const V=await C.createBidirectionalStream(),se=V.writable.getWriter(),fe=V.readable.getReader();return D.send_reliable=z=>{se.write(z)},async function(){for(;;){const{value:z,done:re}=await fe.read();if(re){console.log("Done reading stream, stop reading...",value);return}N(D,$e(z))}}().catch(z=>{console.error("reading datagram failed, stop reading...:",z)}),J(ce,e.wt=D,e),!0}async function q(){const f=`${c}/ws`,C=new WebSocket(f);if(console.log("websocket connecting...",f),!await new Promise((Y,r)=>{C.onopen=()=>{console.log(C,"WebSocket connected"),Y(!0)},C.onerror_message=E=>{console.error("WebSocket error:",E),r(E)}}).catch(Y=>(console.error("WebSocket $connection failed:",Y),!1)))return!1;const D={protocol:"ws",register_status:"unregistered",transport:C};return D.send_reliable=Y=>{D.transport.send(Y)},C.addEventListener("message",Y=>{N(D,JSON.parse(Y.data))}),C.addEventListener("close",Y=>{Y.wasClean?console.log("WebSocket closed",Y):console.error("WebSocket $connection died",Y)}),J(ce,e.ws=D,e),!0}function h(){b=this.value,o(1,b)}function y(f){ke[f?"unshift":"push"](()=>{a=f,o(0,a)})}return[a,b,_,n,w,h,y]}class kt extends Ne{constructor(t){super(),Ae(this,t,Tt,pt,Pe,{})}}export{kt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}