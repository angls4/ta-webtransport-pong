import{s as Se,n as Ee,r as Pe,e as me,o as Re,a as xe,f as q,h as et,b as ke}from"../chunks/scheduler.CTimOCLo.js";import{S as je,i as Ne,g as h,s as L,m as ee,h as f,j as A,c as F,y as ue,n as te,f as m,k as u,l as fe,a as oe,x as l,z as pe,A as le,o as ie,B as $e,C as tt,r as We,u as Le,v as Fe,d as Be,t as Ve,w as He,e as Ye}from"../chunks/index.CRnmY6F2.js";import{w as Ae}from"../chunks/index.BXnrS5-F.js";import{_ as ot}from"../chunks/preload-helper.CRk0x-X1.js";function Me(s){return s?.length!==void 0?s:Array.from(s)}const nt={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},st={id:null,name:"",room:null,player:null},se=Ae(nt),de=Ae(st),$=Ae("login page");function qe(s,t,n){const e=s.slice();return e[21]=t[n],e}function Je(s){let t,n,e;return{c(){t=h("div"),n=h("p"),e=ee(s[4]),this.h()},l(o){t=f(o,"DIV",{class:!0});var c=A(t);n=f(c,"P",{});var v=A(n);e=te(v,s[4]),v.forEach(m),c.forEach(m),this.h()},h(){u(t,"class","error-message svelte-17jni71")},m(o,c){oe(o,t,c),l(t,n),l(n,e)},p(o,c){c&16&&ie(e,o[4])},d(o){o&&m(t)}}}function Ge(s){let t,n,e,o,c=s[21].name+"",v,B,S,w,T=Math.abs(s[21].ballSpeedX)+"",a,i,b,E=Object.keys(s[21].gameState.players).length+"",g,O,y,R,V,Q,D,P,j,d;function J(){return s[13](s[21])}return{c(){t=h("div"),n=h("div"),e=h("div"),o=h("span"),v=ee(c),B=L(),S=h("span"),w=ee("Ball speed : "),a=ee(T),i=L(),b=h("span"),g=ee(E),O=ee("/2 Players"),y=L(),R=h("div"),V=h("button"),Q=ee("JOIN"),P=L(),this.h()},l(G){t=f(G,"DIV",{class:!0});var H=A(t);n=f(H,"DIV",{class:!0});var p=A(n);e=f(p,"DIV",{class:!0});var k=A(e);o=f(k,"SPAN",{});var U=A(o);v=te(U,c),U.forEach(m),k.forEach(m),B=F(p),S=f(p,"SPAN",{class:!0});var r=A(S);w=te(r,"Ball speed : "),a=te(r,T),r.forEach(m),i=F(p),b=f(p,"SPAN",{class:!0});var _=A(b);g=te(_,E),O=te(_,"/2 Players"),_.forEach(m),p.forEach(m),y=F(H),R=f(H,"DIV",{});var W=A(R);V=f(W,"BUTTON",{class:!0});var z=A(V);Q=te(z,"JOIN"),z.forEach(m),W.forEach(m),P=F(H),H.forEach(m),this.h()},h(){u(e,"class","room__name svelte-17jni71"),u(S,"class","room__detail svelte-17jni71"),u(b,"class","room__detail svelte-17jni71"),u(n,"class","room__info svelte-17jni71"),u(V,"class","button svelte-17jni71"),V.disabled=D=Object.keys(s[21].gameState.players).length>=2,u(t,"class","room svelte-17jni71")},m(G,H){oe(G,t,H),l(t,n),l(n,e),l(e,o),l(o,v),l(n,B),l(n,S),l(S,w),l(S,a),l(n,i),l(n,b),l(b,g),l(b,O),l(t,y),l(t,R),l(R,V),l(V,Q),l(t,P),j||(d=le(V,"click",J),j=!0)},p(G,H){s=G,H&1&&c!==(c=s[21].name+"")&&ie(v,c),H&1&&T!==(T=Math.abs(s[21].ballSpeedX)+"")&&ie(a,T),H&1&&E!==(E=Object.keys(s[21].gameState.players).length+"")&&ie(g,E),H&1&&D!==(D=Object.keys(s[21].gameState.players).length>=2)&&(V.disabled=D)},d(G){G&&m(t),j=!1,d()}}}function Xe(s){let t,n="<span>No rooms available</span>";return{c(){t=h("p"),t.innerHTML=n,this.h()},l(e){t=f(e,"P",{style:!0,"data-svelte-h":!0}),ue(t)!=="svelte-156qi2m"&&(t.innerHTML=n),this.h()},h(){fe(t,"color","grey")},m(e,o){oe(e,t,o)},d(e){e&&m(t)}}}function lt(s){let t,n,e,o="PONG",c,v,B,S=s[5]?.name+"",w,T,a,i,b,E,g="rename user",O,y,R,V,Q,D,P,j,d,J,G,H="Create Room",p,k,U,r="Refresh",_,W,z="",re,ne,he,X,Z,be="credit: angls4",_e,ge,M=s[4]&&Je(s),ae=Me(s[0]),K=[];for(let N=0;N<ae.length;N+=1)K[N]=Ge(qe(s,ae,N));let x=s[0].length==0&&Xe();return{c(){t=h("div"),M&&M.c(),n=L(),e=h("h1"),e.textContent=o,c=L(),v=h("h2"),B=ee("Welcome, "),w=ee(S),T=L(),a=h("div"),i=h("input"),b=L(),E=h("button"),E.textContent=g,O=L(),y=h("br"),R=L(),V=h("br"),Q=L(),D=h("input"),P=L(),j=h("span"),d=h("input"),J=L(),G=h("button"),G.textContent=H,p=L(),k=h("p"),U=h("button"),U.textContent=r,_=L(),W=h("div"),W.innerHTML=z,re=L(),ne=h("div");for(let N=0;N<K.length;N+=1)K[N].c();he=L(),x&&x.c(),X=L(),Z=h("p"),Z.textContent=be,this.h()},l(N){t=f(N,"DIV",{class:!0});var Y=A(t);M&&M.l(Y),n=F(Y),e=f(Y,"H1",{class:!0,"data-svelte-h":!0}),ue(e)!=="svelte-1jnr5i3"&&(e.textContent=o),c=F(Y),v=f(Y,"H2",{class:!0});var C=A(v);B=te(C,"Welcome, "),w=te(C,S),C.forEach(m),T=F(Y),a=f(Y,"DIV",{class:!0,style:!0});var I=A(a);i=f(I,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),b=F(I),E=f(I,"BUTTON",{class:!0,"data-svelte-h":!0}),ue(E)!=="svelte-5cerf9"&&(E.textContent=g),O=F(I),y=f(I,"BR",{}),R=F(I),V=f(I,"BR",{}),Q=F(I),D=f(I,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),P=F(I),j=f(I,"SPAN",{});var ce=A(j);d=f(ce,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),J=F(ce),G=f(ce,"BUTTON",{class:!0,"data-svelte-h":!0}),ue(G)!=="svelte-136z9rb"&&(G.textContent=H),ce.forEach(m),I.forEach(m),p=F(Y),k=f(Y,"P",{});var ve=A(k);U=f(ve,"BUTTON",{class:!0,"data-svelte-h":!0}),ue(U)!=="svelte-1nuptru"&&(U.textContent=r),ve.forEach(m),_=F(Y),W=f(Y,"DIV",{class:!0,"data-svelte-h":!0}),ue(W)!=="svelte-1hf6hku"&&(W.innerHTML=z),re=F(Y),ne=f(Y,"DIV",{class:!0});var ye=A(ne);for(let we=0;we<K.length;we+=1)K[we].l(ye);ye.forEach(m),he=F(Y),x&&x.l(Y),Y.forEach(m),X=F(N),Z=f(N,"P",{style:!0,"data-svelte-h":!0}),ue(Z)!=="svelte-apo9jk"&&(Z.textContent=be),this.h()},h(){u(e,"class","card__title svelte-17jni71"),u(v,"class","svelte-17jni71"),u(i,"type","text"),u(i,"placeholder","New nickname"),u(i,"maxlength","20"),u(i,"class","svelte-17jni71"),u(E,"class","button-small svelte-17jni71"),u(D,"type","text"),D.required=!0,u(D,"placeholder","Enter room name"),u(D,"maxlength","20"),u(D,"class","svelte-17jni71"),u(d,"type","number"),u(d,"min","0"),u(d,"max","100"),d.required=!0,u(d,"placeholder","Ball speed"),fe(d,"width","100px"),fe(d,"margin-left","0"),fe(d,"margin-right","10px"),u(d,"class","svelte-17jni71"),u(G,"class","button-small svelte-17jni71"),u(a,"class","room svelte-17jni71"),fe(a,"display","block"),u(U,"class","button svelte-17jni71"),u(W,"class","card__header svelte-17jni71"),u(ne,"class","room-list svelte-17jni71"),u(t,"class","card svelte-17jni71"),fe(Z,"color","white")},m(N,Y){oe(N,t,Y),M&&M.m(t,null),l(t,n),l(t,e),l(t,c),l(t,v),l(v,B),l(v,w),l(t,T),l(t,a),l(a,i),pe(i,s[3]),l(a,b),l(a,E),l(a,O),l(a,y),l(a,R),l(a,V),l(a,Q),l(a,D),pe(D,s[1]),l(a,P),l(a,j),l(j,d),pe(d,s[2]),l(j,J),l(j,G),l(t,p),l(t,k),l(k,U),l(t,_),l(t,W),l(t,re),l(t,ne);for(let C=0;C<K.length;C+=1)K[C]&&K[C].m(ne,null);l(t,he),x&&x.m(t,null),oe(N,X,Y),oe(N,Z,Y),_e||(ge=[le(i,"input",s[10]),le(E,"click",s[9]),le(D,"input",s[11]),le(d,"input",s[12]),le(G,"click",s[7]),le(U,"click",s[6])],_e=!0)},p(N,[Y]){if(N[4]?M?M.p(N,Y):(M=Je(N),M.c(),M.m(t,n)):M&&(M.d(1),M=null),Y&32&&S!==(S=N[5]?.name+"")&&ie(w,S),Y&8&&i.value!==N[3]&&pe(i,N[3]),Y&2&&D.value!==N[1]&&pe(D,N[1]),Y&4&&$e(d.value)!==N[2]&&pe(d,N[2]),Y&257){ae=Me(N[0]);let C;for(C=0;C<ae.length;C+=1){const I=qe(N,ae,C);K[C]?K[C].p(I,Y):(K[C]=Ge(I),K[C].c(),K[C].m(ne,null))}for(;C<K.length;C+=1)K[C].d(1);K.length=ae.length}N[0].length==0?x||(x=Xe(),x.c(),x.m(t,null)):x&&(x.d(1),x=null)},i:Ee,o:Ee,d(N){N&&(m(t),m(X),m(Z)),M&&M.d(),tt(K,N),x&&x.d(),_e=!1,Pe(ge)}}}const rt=3e3;function it(s,t,n){let e,o,c;me(s,de,P=>n(5,e=P)),me(s,$,P=>n(15,o=P)),me(s,se,P=>n(16,c=P));const B=window.location.origin;let S=[],w="",T,a=e?.name??"",i="",b;Re(()=>{$.subscribe(P=>{c.connected&&(e.room?e.room?.id?O(e.room):O({id:e.room}):E())})}),xe(()=>{i&&(clearTimeout(b),b=setTimeout(()=>{n(4,i="")},rt))});async function E(){const j=await(await fetch(`${B}/list_room`)).json();j.status=="success"?j.rooms?n(0,S=j.rooms):(console.error("Failed to get rooms",j),n(4,i="Failed to get rooms")):(console.error("Failed to get rooms",j),n(4,i=j.message??"Failed to get rooms")),console.log("room list refreshed",S)}async function g(){if(!w||!T){console.error("Room name and ball speed are required"),n(4,i="Room name and ball speed are required");return}const P={name:w,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:T,ballSpeedY:T},j=`${B}/create_room`;console.log("Creating room...",j,P),await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)}).then(d=>d.json()).then(d=>{console.log("create room",d),d.status=="success"&&d.room?.id?(console.log("Room created successfully, joining...",d.room),O(d.room)):(console.error("Failed to create room",d.message),n(4,i=d.message??"Failed to create room"))}).catch(d=>{console.error("Failed to create room",d),n(4,i=d.message??"Failed to create room")}),console.log("Room created successfully"),E()}async function O(P){console.log("Joining room...",P.id);const j=`${B}/join_room`,d={room_id:P.id,user_id:e.id};await fetch(j,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then(J=>J.json()).then(J=>{J.status=="success"&&J.room?.id&&J.user?.id?(console.log("Joined room successfully"),q(de,e=J.user,e),q(de,e.room=J.room,e),console.log("Playing room...",P),q($,o="game room",o)):(console.error("Failed to join room",J),q(de,e.room=null,e),n(4,i=J.message??"Failed to join room"),E())}).catch(J=>{console.error("Failed to join room",J),n(4,i=J.message??"Failed to join room")})}function y(){if(!a){console.error("Nickname is required"),n(4,i="Nickname is required");return}console.log("Renaming room...",w);const P=`${B}/login`,j={id:e.id,name:a};fetch(P,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)}).then(d=>d.json()).then(d=>{console.log("rename user",d),d.status=="success"&&d.user?.id?(console.log("User renamed successfully"),q(de,e=d.user,e)):(console.error("Failed to rename user",d),n(4,i=d.message??"Failed to rename user"))}).catch(d=>{console.error("Failed to rename user",d),n(4,i=d.message??"Failed to rename user")})}function R(){a=this.value,n(3,a)}function V(){w=this.value,n(1,w)}function Q(){T=$e(this.value),n(2,T)}return[S,w,T,a,i,e,E,g,O,y,R,V,Q,P=>O(P)]}class at extends je{constructor(t){super(),Ne(this,t,it,lt,Se,{})}}new TextEncoder;function ct(s){let t,n,e,o,c=(s[4]?.players?.[s[4]?.p0index]?.user?.name??"...")+"",v,B,S,w,T=(s[4]?.players?.[s[4]?.p0index]?.wins??0)+"",a,i,b,E="PONG",g,O,y,R=(s[4]?.players?.[s[4]?.p1index]?.user?.name??"...")+"",V,Q,D,P,j=(s[4]?.players?.[s[4]?.p1index]?.wins??0)+"",d,J,G,H,p,k,U,r,_="play/pause",W,z,re=s[2]?"hide":"show",ne,he,X,Z,be="leave",_e,ge,M,ae,K,x,N,Y;return{c(){t=h("div"),n=h("div"),e=h("div"),o=h("h3"),v=ee(c),B=L(),S=h("p"),w=ee("Wins: "),a=ee(T),i=L(),b=h("h1"),b.textContent=E,g=L(),O=h("div"),y=h("h3"),V=ee(R),Q=L(),D=h("p"),P=ee("Wins: "),d=ee(j),J=L(),G=h("p"),H=h("canvas"),U=L(),r=h("button"),r.textContent=_,W=L(),z=h("button"),ne=ee(re),he=ee(" ws"),X=L(),Z=h("button"),Z.textContent=be,_e=L(),ge=h("p"),M=h("canvas"),this.h()},l(C){t=f(C,"DIV",{style:!0,class:!0});var I=A(t);n=f(I,"DIV",{class:!0});var ce=A(n);e=f(ce,"DIV",{class:!0});var ve=A(e);o=f(ve,"H3",{});var ye=A(o);v=te(ye,c),ye.forEach(m),B=F(ve),S=f(ve,"P",{});var we=A(S);w=te(we,"Wins: "),a=te(we,T),we.forEach(m),ve.forEach(m),i=F(ce),b=f(ce,"H1",{class:!0,"data-svelte-h":!0}),ue(b)!=="svelte-106hqp2"&&(b.textContent=E),g=F(ce),O=f(ce,"DIV",{class:!0});var Te=A(O);y=f(Te,"H3",{});var Oe=A(y);V=te(Oe,R),Oe.forEach(m),Q=F(Te),D=f(Te,"P",{});var Ce=A(D);P=te(Ce,"Wins: "),d=te(Ce,j),Ce.forEach(m),Te.forEach(m),ce.forEach(m),J=F(I),G=f(I,"P",{});var Ue=A(G);H=f(Ue,"CANVAS",{width:!0,height:!0,style:!0}),A(H).forEach(m),Ue.forEach(m),U=F(I),r=f(I,"BUTTON",{class:!0,"data-svelte-h":!0}),ue(r)!=="svelte-1f8r5w0"&&(r.textContent=_),W=F(I),z=f(I,"BUTTON",{class:!0});var Ie=A(z);ne=te(Ie,re),he=te(Ie," ws"),Ie.forEach(m),X=F(I),Z=f(I,"BUTTON",{class:!0,"data-svelte-h":!0}),ue(Z)!=="svelte-101srf3"&&(Z.textContent=be),_e=F(I),ge=f(I,"P",{});var De=A(ge);M=f(De,"CANVAS",{width:!0,height:!0,style:!0}),A(M).forEach(m),De.forEach(m),I.forEach(m),this.h()},h(){u(e,"class","player1 svelte-c69nol"),u(b,"class","svelte-c69nol"),u(O,"class","player2 svelte-c69nol"),u(n,"class","scoreboard svelte-c69nol"),u(H,"width",p=s[3].width),u(H,"height",k=s[3].height),fe(H,"background","black"),u(r,"class","game_button svelte-c69nol"),u(z,"class","game_button svelte-c69nol"),u(Z,"class","game_button svelte-c69nol"),M.hidden=ae=!s[2],u(M,"width",K=s[3].width),u(M,"height",x=s[3].height),fe(M,"background","black"),fe(t,"width","800px"),u(t,"class","cent svelte-c69nol")},m(C,I){oe(C,t,I),l(t,n),l(n,e),l(e,o),l(o,v),l(e,B),l(e,S),l(S,w),l(S,a),l(n,i),l(n,b),l(n,g),l(n,O),l(O,y),l(y,V),l(O,Q),l(O,D),l(D,P),l(D,d),l(t,J),l(t,G),l(G,H),s[11](H),l(t,U),l(t,r),l(t,W),l(t,z),l(z,ne),l(z,he),l(t,X),l(t,Z),l(t,_e),l(t,ge),l(ge,M),s[12](M),N||(Y=[le(H,"mousemove",s[5]),le(r,"click",s[6]),le(z,"click",s[8]),le(Z,"click",s[7])],N=!0)},p(C,[I]){I&16&&c!==(c=(C[4]?.players?.[C[4]?.p0index]?.user?.name??"...")+"")&&ie(v,c),I&16&&T!==(T=(C[4]?.players?.[C[4]?.p0index]?.wins??0)+"")&&ie(a,T),I&16&&R!==(R=(C[4]?.players?.[C[4]?.p1index]?.user?.name??"...")+"")&&ie(V,R),I&16&&j!==(j=(C[4]?.players?.[C[4]?.p1index]?.wins??0)+"")&&ie(d,j),I&8&&p!==(p=C[3].width)&&u(H,"width",p),I&8&&k!==(k=C[3].height)&&u(H,"height",k),I&4&&re!==(re=C[2]?"hide":"show")&&ie(ne,re),I&4&&ae!==(ae=!C[2])&&(M.hidden=ae),I&8&&K!==(K=C[3].width)&&u(M,"width",K),I&8&&x!==(x=C[3].height)&&u(M,"height",x)},i:Ee,o:Ee,d(C){C&&m(t),s[11](null),s[12](null),N=!1,Pe(Y)}}}function ut(s,t,n){let e,o,c;me(s,de,r=>n(18,e=r)),me(s,se,r=>n(19,o=r)),me(s,$,r=>n(20,c=r));const v=1e3/30,S=window.location.origin;let w,T,a,i,b,E=!1,g={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},O={ballX:Math.floor(g.width/2),ballY:Math.floor(g.height/2),players:{a:{paddleY:Math.floor(g.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},b:{paddleY:Math.floor(g.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}},isRunning:!1,p0index:"a",p1index:"b"},y={...O},R={paddleY:Math.floor(g.height/2)};function V(r){try{r.players[e.id].paddleY=R.paddleY}catch(_){console.error("Error in converting state",_)}n(4,O={...r})}function Q(r){n(3,g={...r})}async function D(){for(;c=="game room";){await new Promise(r=>setTimeout(r,v));try{if(O.isRunning)if(o.connected){let r=new Uint8Array(Uint16Array.of(R.paddleY).buffer),_=[1,r[0],r[1]];const W=Uint8Array.of(..._);o.wt.send(W)}else{console.error("Connection not ready");continue}}catch(r){console.error("Error in transmit loop",r)}}}function P(){if(c!="game room"){cancelAnimationFrame(b);return}try{j(a,O),j(i,y)}catch(r){console.error("Error in draw loop",r)}b=requestAnimationFrame(P)}function j(r,_){r.clearRect(0,0,w.width,w.height),r.fillStyle="white",r.beginPath(),r.arc(_.ballX,_.ballY,g.ballRadius,0,Math.PI*2),r.fill(),Object.keys(_?.players??{}).length>0&&(r.fillRect(0,_.players[_.p0index]?.paddleY,g.paddleWidth,g.paddleHeight),r.fillRect(w.width-g.paddleWidth,_.players[_.p1index]?.paddleY,g.paddleWidth,g.paddleHeight),r.strokeStyle="white",r.lineWidth=3,r.setLineDash([20,40]),r.beginPath(),r.moveTo(w.width/2,0),r.lineTo(w.width/2,w.height),r.stroke(),r.fillStyle="white",r.font="bold 50px Arial",r.fillText(_.players[_.p0index]?.score?.toString()??"0",w.width/2-70,70,100),r.fillText(_.players[_.p1index]?.score?.toString()??"0",w.width/2+40,70,100)),_.isRunning||(r.fillStyle="white",r.font="bold 50px Arial",r.fillText("▐▐ ",20,80,200))}Re(()=>{a=w.getContext("2d"),i=T.getContext("2d")}),et(()=>{cancelAnimationFrame(b)});function d(r){const _=w.getBoundingClientRect(),W=r.clientY-_.top-g.paddleHeight/2,z=Math.max(1,Math.min(w.height-g.paddleHeight,W));R.paddleY=z,n(4,O.players[e.id].paddleY=z,O)}function J(){console.log(o),o.connected?o.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function G(){const r={room_id:e.room.id,user_id:e.id},_=`${S}/leave_room`;console.log("Leaving room...",r,_),fetch(_,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(W=>W.json()).then(W=>{W.status=="success"&&W.user?.id&&W.room?.id?(console.log("Leave room successful"),q(de,e=W.user,e),q($,c="room list",c)):console.error("Failed to leave room",W)}).catch(W=>{console.error("Error in leave room request",W)})}o.addListener("wt",(r,_)=>{V(_)}),o.addListener("ws",(r,_)=>{y={..._}});function H(){console.log("starting loops"),P(),D()}$.subscribe(r=>{r=="game room"&&(Q({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),V(e.room.gameState),H())});function p(){n(2,E=!E)}function k(r){ke[r?"unshift":"push"](()=>{w=r,n(0,w)})}function U(r){ke[r?"unshift":"push"](()=>{T=r,n(1,T)})}return[w,T,E,g,O,d,J,G,p,V,Q,k,U]}class dt extends je{constructor(t){super(),Ne(this,t,ut,ct,Se,{setState:9,setRoomConfig:10})}get setState(){return this.$$.ctx[9]}get setRoomConfig(){return this.$$.ctx[10]}}const ze=globalThis.__sveltekit_1f7sa50.env??(await ot(()=>import(globalThis.__sveltekit_1f7sa50.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function ht(s){let t,n;return{c(){t=h("h2"),n=ee(s[3])},l(e){t=f(e,"H2",{});var o=A(t);n=te(o,s[3]),o.forEach(m)},m(e,o){oe(e,t,o),l(t,n)},p(e,o){o&8&&ie(n,e[3])},d(e){e&&m(t)}}}function ft(s){let t,n="PONG",e,o,c,v,B,S,w,T,a=s[2]&&Ke(s);return{c(){t=h("h1"),t.textContent=n,e=L(),o=h("input"),c=L(),v=h("input"),B=L(),a&&a.c(),S=Ye(),this.h()},l(i){t=f(i,"H1",{class:!0,"data-svelte-h":!0}),ue(t)!=="svelte-106hqp2"&&(t.textContent=n),e=F(i),o=f(i,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),c=F(i),v=f(i,"INPUT",{type:!0,class:!0}),B=F(i),a&&a.l(i),S=Ye(),this.h()},h(){u(t,"class","svelte-1av3m61"),u(o,"type","text"),u(o,"placeholder","your nickname"),u(o,"autocomplete","off"),u(o,"spellcheck","false"),u(o,"maxlength","20"),u(o,"class","svelte-1av3m61"),u(v,"type","submit"),v.value="Enter",u(v,"class","svelte-1av3m61")},m(i,b){oe(i,t,b),oe(i,e,b),oe(i,o,b),pe(o,s[1]),oe(i,c,b),oe(i,v,b),oe(i,B,b),a&&a.m(i,b),oe(i,S,b),w||(T=[le(o,"input",s[5]),le(v,"click",s[4])],w=!0)},p(i,b){b&2&&o.value!==i[1]&&pe(o,i[1]),i[2]?a?a.p(i,b):(a=Ke(i),a.c(),a.m(S.parentNode,S)):a&&(a.d(1),a=null)},d(i){i&&(m(t),m(e),m(o),m(c),m(v),m(B),m(S)),a&&a.d(i),w=!1,Pe(T)}}}function Ke(s){let t,n,e;return{c(){t=h("div"),n=h("p"),e=ee(s[2]),this.h()},l(o){t=f(o,"DIV",{class:!0});var c=A(t);n=f(c,"P",{});var v=A(n);e=te(v,s[2]),v.forEach(m),c.forEach(m),this.h()},h(){u(t,"class","error-message svelte-1av3m61")},m(o,c){oe(o,t,c),l(t,n),l(n,e)},p(o,c){c&4&&ie(e,o[2])},d(o){o&&m(t)}}}function mt(s){let t,n,e,o,c,v,B,S,w,T,a,i;function b(y,R){if(y[3]==="login page")return ft;if(y[3]!=="room list"&&y[3]!=="game room")return ht}let E=b(s),g=E&&E(s);v=new at({});let O={};return T=new dt({props:O}),s[6](T),{c(){t=h("body"),n=h("div"),g&&g.c(),e=L(),o=h("div"),c=h("div"),We(v.$$.fragment),S=L(),w=h("div"),We(T.$$.fragment),this.h()},l(y){t=f(y,"BODY",{class:!0});var R=A(t);n=f(R,"DIV",{class:!0});var V=A(n);g&&g.l(V),V.forEach(m),e=F(R),o=f(R,"DIV",{});var Q=A(o);c=f(Q,"DIV",{class:!0});var D=A(c);Le(v.$$.fragment,D),D.forEach(m),Q.forEach(m),S=F(R),w=f(R,"DIV",{});var P=A(w);Le(T.$$.fragment,P),P.forEach(m),R.forEach(m),this.h()},h(){u(n,"class","cent svelte-1av3m61"),u(c,"class","cent svelte-1av3m61"),o.hidden=B=s[3]!=="room list",w.hidden=a=s[3]!=="game room",u(t,"class","svelte-1av3m61")},m(y,R){oe(y,t,R),l(t,n),g&&g.m(n,null),l(t,e),l(t,o),l(o,c),Fe(v,c,null),l(t,S),l(t,w),Fe(T,w,null),i=!0},p(y,[R]){E===(E=b(y))&&g?g.p(y,R):(g&&g.d(1),g=E&&E(y),g&&(g.c(),g.m(n,null))),(!i||R&8&&B!==(B=y[3]!=="room list"))&&(o.hidden=B);const V={};T.$set(V),(!i||R&8&&a!==(a=y[3]!=="game room"))&&(w.hidden=a)},i(y){i||(Be(v.$$.fragment,y),Be(T.$$.fragment,y),i=!0)},o(y){Ve(v.$$.fragment,y),Ve(T.$$.fragment,y),i=!1},d(y){y&&m(t),g&&g.d(),He(v),s[6](null),He(T)}}}const gt=1,pt=2,_t=3e3,vt=5e3;async function Qe(s){console.log("waiting for registration...",s);const t=vt,n=new Promise((o,c)=>{const v=setInterval(()=>{s.register_status==="registered"&&(clearInterval(v),o())},100)}),e=new Promise((o,c)=>{setTimeout(()=>{c(new Error("Registration timeout"))},t)});return await Promise.race([n,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(o=>!1)}function Ze(s){const n=new TextDecoder("utf-8").decode(s);return JSON.parse(n)}function wt(s){return new Promise(t=>setTimeout(t,s))}function bt(s){let t=s.replace(/:/g,"");if(t.length%2!==0)throw new Error("Invalid hex string");let n=new ArrayBuffer(t.length/2),e=new Uint8Array(n);for(let o=0;o<t.length;o+=2)e[o/2]=parseInt(t.substr(o,2),16);return n}function yt(s,t,n){let e,o,c;me(s,se,p=>n(9,e=p)),me(s,$,p=>n(3,o=p)),me(s,de,p=>n(10,c=p));const v=ze.PUBLIC_RECONNECT_INTERVAL??3,B=window.location.origin,S=B,w=B,T=B,a=ze.PUBLIC_HTTP3_CERTIFICATE_FINGERPRINT??"43:6E:11:10:0C:94:51:4C:10:FD:D8:F6:46:5F:DD:A4:18:70:EC:11:44:8E:C0:4D:A4:1A:B9:69:23:C3:7B:95";let i,b="",E=null,g="",O;Re(()=>{E=localStorage.getItem("user_id"),E&&(console.log("logging in with saved user_id...",E),y())}),xe(()=>{g&&(clearTimeout(O),O=setTimeout(()=>{n(2,g="")},_t))});function y(){if(!b&&!E){n(2,g="Please enter your nickname");return}const p=`${S}/login`;E=localStorage.getItem("user_id"),console.log(`logging in... name=${b} id=${E} host=${p}`);const k={name:b,id:E??void 0};q($,o="logging in",o),fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}).then(U=>{if(!U.ok)throw new Error("Network response was not ok");return U.json()}).then(U=>{console.log("logged in with user",U),U.code==200?(q($,o="connecting transport",o),de.set(U.user),j().then(()=>{localStorage.setItem("user_id",c.id)}).catch(r=>{console.error(r),q($,o="login page",o)})):(n(2,g=U.message??"Error logging in"),localStorage.clear("user_id"),E=null,de.set(null),q($,o="login page",o))}).catch(U=>{n(2,g=U.message??"Error logging in"),console.error(U),q($,o="login page",o)})}async function R(){if(console.log("connecting transport..."),q($,o="connecting webTransport",o),await d()){if(console.log("connected webtransport"),q($,o="registering webTransport",o),!await V())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),q($,o="connecting webSocket",o),await J()){if(console.log("connected webSocket"),q($,o="registering webSocket",o),!await Q())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return q(se,e.connected=!0,e),q($,o="room list",o),2}async function V(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(c.id))),q(se,e.wt.register_status="registering",e),await Qe(e.wt)}async function Q(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(c.id))),q(se,e.ws.register_status="registering",e),await Qe(e.ws)}q(se,e.addListener=(p,k)=>{e[p+"_listeners"]==null&&q(se,e[p+"_listeners"]=[],e);const U=e[p+"_listeners"].length;return e[p+"_listeners"].push(k),U},e),q(se,e.removeListener=(p,k)=>{q(se,e[p+"_listeners"]=null,e)},e);function D(p,k){p.register_status==="registering"&&(p.register_status="registered",console.log("register messsage received",p)),e[p.protocol+"_listeners"].forEach(U=>{try{U&&U(p,k)}catch(r){console.error("Error calling listener",r)}})}async function P(p){if(e.connected){console.log("webtransport disconnected, handling...");try{delete e.wt,delete e.ws}catch(k){console.log("error deleting transport",k)}q(se,e.connected=!1,e),await j()}}async function j(){for(q($,o="reconnecting",o);;){console.log("reconnecting...");const p=await R();if(p==gt)console.log("reconnected, but failed registering. returning to login page..."),window.location.href="/";else if(p==pt){console.log("reconnected"),q($,o="room list",o);break}console.log(`reconnecting again in ${v} sec...`),await wt(v*1e3)}}async function d(){const p=`${w}/wt`,k=new WebTransport(p,{serverCertificateHashes:[{algorithm:"sha-256",value:bt(a)}]});if(k.closed.then(()=>{console.log("WebTransport closed",k),P()}).catch(X=>{console.error("WebTransport connection died:",X,k),P()}),console.log("webtransport connecting...",p),!await k.ready.then(()=>(console.log("WebTransport connected",k),!0)).catch(X=>(console.error("WebTransport connection failed:",X),!1)))return!1;const r={protocol:"wt",register_status:"unregistered",transport:k},_=r.transport.datagrams,W=_.writable.getWriter(),z=_.readable.getReader();r.send=X=>{W.write(X)},async function(){for(;;){const{value:X,done:Z}=await z.read();if(Z){console.log("Done reading datagram, stop reading...",value);return}D(r,Ze(X))}}().catch(X=>{console.error("reading datagram failed, stop reading...:",X)});const re=await k.createBidirectionalStream(),ne=re.writable.getWriter(),he=re.readable.getReader();return r.send_reliable=X=>{ne.write(X)},async function(){for(;;){const{value:X,done:Z}=await he.read();if(Z){console.log("Done reading stream, stop reading...",value);return}D(r,Ze(X))}}().catch(X=>{console.error("reading datagram failed, stop reading...:",X)}),q(se,e.wt=r,e),!0}async function J(){const p=`${T}/ws`,k=new WebSocket(p);if(console.log("websocket connecting...",p),!await new Promise((_,W)=>{k.onopen=()=>{console.log(k,"WebSocket connected"),_(!0)},k.onerror_message=z=>{console.error("WebSocket error:",z),W(z)}}).catch(_=>(console.error("WebSocket $connection failed:",_),!1)))return!1;const r={protocol:"ws",register_status:"unregistered",transport:k};return r.send_reliable=_=>{r.transport.send(_)},k.addEventListener("message",_=>{D(r,JSON.parse(_.data))}),k.addEventListener("close",_=>{_.wasClean?console.log("WebSocket closed",_):console.error("WebSocket $connection died",_)}),q(se,e.ws=r,e),!0}function G(){b=this.value,n(1,b)}function H(p){ke[p?"unshift":"push"](()=>{i=p,n(0,i)})}return[i,b,g,o,y,G,H]}class kt extends je{constructor(t){super(),Ne(this,t,yt,mt,Se,{})}}export{kt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}