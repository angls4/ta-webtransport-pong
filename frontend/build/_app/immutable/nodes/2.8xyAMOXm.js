import{s as Ee,n as we,r as Ce,e as he,o as Ie,a as xe,f as F,h as et,b as Pe}from"../chunks/scheduler.CTimOCLo.js";import{S as Re,i as Ne,g as f,s as V,h as g,j as W,c as B,y as de,f as _,k as d,l as se,a as te,x as r,z as ge,A as ae,B as $e,C as tt,m as Q,n as Z,o as ie,r as Ve,u as Be,v as Fe,d as Ye,t as He,w as qe,e as Me}from"../chunks/index.CRnmY6F2.js";import{w as We}from"../chunks/index.BXnrS5-F.js";import{_ as ot}from"../chunks/preload-helper.CRk0x-X1.js";function ze(s){return s?.length!==void 0?s:Array.from(s)}const nt={wt:null,ws:null,connected:!1,wt_listeners:[],ws_listeners:[],addListener:()=>{}},st={id:null,name:"",room:null,player:null},re=We(nt),ce=We(st),K=We("idle");function Je(s,t,n){const e=s.slice();return e[22]=t[n],e}function Xe(s){let t,n,e;return{c(){t=f("div"),n=f("p"),e=Q(s[4]),this.h()},l(o){t=g(o,"DIV",{class:!0});var m=W(t);n=g(m,"P",{});var i=W(n);e=Z(i,s[4]),i.forEach(_),m.forEach(_),this.h()},h(){d(t,"class","error-message svelte-18y7b0k")},m(o,m){te(o,t,m),r(t,n),r(n,e)},p(o,m){m&16&&ie(e,o[4])},d(o){o&&_(t)}}}function Ge(s){let t,n,e,o,m=s[22].name+"",i,S,T,C,I=Math.abs(s[22].ballSpeedX)+"",u,p,b,Y=s[22].gameState.players.length+"",P,v,H,j,y,D="JOIN",q,R,h;function A(){return s[12](s[22])}return{c(){t=f("div"),n=f("div"),e=f("div"),o=f("span"),i=Q(m),S=V(),T=f("span"),C=Q("Ball speed : "),u=Q(I),p=V(),b=f("span"),P=Q(Y),v=Q("/2 Players"),H=V(),j=f("div"),y=f("button"),y.textContent=D,q=V(),this.h()},l(l){t=g(l,"DIV",{class:!0});var c=W(t);n=g(c,"DIV",{class:!0});var w=W(n);e=g(w,"DIV",{class:!0});var N=W(e);o=g(N,"SPAN",{});var L=W(o);i=Z(L,m),L.forEach(_),N.forEach(_),S=B(w),T=g(w,"SPAN",{class:!0});var $=W(T);C=Z($,"Ball speed : "),u=Z($,I),$.forEach(_),p=B(w),b=g(w,"SPAN",{class:!0});var M=W(b);P=Z(M,Y),v=Z(M,"/2 Players"),M.forEach(_),w.forEach(_),H=B(c),j=g(c,"DIV",{class:!0});var x=W(j);y=g(x,"BUTTON",{class:!0,"data-svelte-h":!0}),de(y)!=="svelte-120grqu"&&(y.textContent=D),x.forEach(_),q=B(c),c.forEach(_),this.h()},h(){d(e,"class","room__name svelte-18y7b0k"),d(T,"class","room__detail svelte-18y7b0k"),d(b,"class","room__detail svelte-18y7b0k"),d(n,"class","room__info svelte-18y7b0k"),d(y,"class","button svelte-18y7b0k"),d(j,"class","room__actions"),d(t,"class","room svelte-18y7b0k")},m(l,c){te(l,t,c),r(t,n),r(n,e),r(e,o),r(o,i),r(n,S),r(n,T),r(T,C),r(T,u),r(n,p),r(n,b),r(b,P),r(b,v),r(t,H),r(t,j),r(j,y),r(t,q),R||(h=ae(y,"click",A),R=!0)},p(l,c){s=l,c&1&&m!==(m=s[22].name+"")&&ie(i,m),c&1&&I!==(I=Math.abs(s[22].ballSpeedX)+"")&&ie(u,I),c&1&&Y!==(Y=s[22].gameState.players.length+"")&&ie(P,Y)},d(l){l&&_(t),R=!1,h()}}}function lt(s){let t,n,e,o="PONG",m,i,S,T,C,I="rename user",u,p,b,Y,P,v,H,j,y,D,q,R="Create Room",h,A,l,c="Refresh",w,N,L="",$,M,x,a,O="s",k,oe,X=s[4]&&Xe(s),ue=ze(s[0]),G=[];for(let E=0;E<ue.length;E+=1)G[E]=Ge(Je(s,ue,E));return{c(){t=f("div"),X&&X.c(),n=V(),e=f("h1"),e.textContent=o,m=V(),i=f("div"),S=f("input"),T=V(),C=f("button"),C.textContent=I,u=V(),p=f("br"),b=V(),Y=f("br"),P=V(),v=f("input"),H=V(),j=f("span"),y=f("input"),D=V(),q=f("button"),q.textContent=R,h=V(),A=f("p"),l=f("button"),l.textContent=c,w=V(),N=f("div"),N.innerHTML=L,$=V(),M=f("div");for(let E=0;E<G.length;E+=1)G[E].c();x=V(),a=f("p"),a.textContent=O,this.h()},l(E){t=g(E,"DIV",{class:!0});var z=W(t);X&&X.l(z),n=B(z),e=g(z,"H1",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-1jnr5i3"&&(e.textContent=o),m=B(z),i=g(z,"DIV",{class:!0,style:!0});var U=W(i);S=g(U,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),T=B(U),C=g(U,"BUTTON",{class:!0,"data-svelte-h":!0}),de(C)!=="svelte-5cerf9"&&(C.textContent=I),u=B(U),p=g(U,"BR",{}),b=B(U),Y=g(U,"BR",{}),P=B(U),v=g(U,"INPUT",{type:!0,placeholder:!0,maxlength:!0,class:!0}),H=B(U),j=g(U,"SPAN",{});var le=W(j);y=g(le,"INPUT",{type:!0,min:!0,max:!0,placeholder:!0,style:!0,class:!0}),D=B(le),q=g(le,"BUTTON",{class:!0,"data-svelte-h":!0}),de(q)!=="svelte-136z9rb"&&(q.textContent=R),le.forEach(_),U.forEach(_),h=B(z),A=g(z,"P",{});var ne=W(A);l=g(ne,"BUTTON",{class:!0,"data-svelte-h":!0}),de(l)!=="svelte-s4sqy4"&&(l.textContent=c),ne.forEach(_),w=B(z),N=g(z,"DIV",{class:!0,"data-svelte-h":!0}),de(N)!=="svelte-1hf6hku"&&(N.innerHTML=L),$=B(z),M=g(z,"DIV",{class:!0});var me=W(M);for(let fe=0;fe<G.length;fe+=1)G[fe].l(me);me.forEach(_),z.forEach(_),x=B(E),a=g(E,"P",{style:!0,"data-svelte-h":!0}),de(a)!=="svelte-1fb4tdl"&&(a.textContent=O),this.h()},h(){d(e,"class","card__title svelte-18y7b0k"),d(S,"type","text"),d(S,"placeholder","New nickname"),d(S,"maxlength","20"),d(S,"class","svelte-18y7b0k"),d(C,"class","button-small svelte-18y7b0k"),d(v,"type","text"),v.required=!0,d(v,"placeholder","Enter room name"),d(v,"maxlength","20"),d(v,"class","svelte-18y7b0k"),d(y,"type","number"),d(y,"min","0"),d(y,"max","100"),y.required=!0,d(y,"placeholder","Ball speed"),se(y,"width","100px"),se(y,"margin-left","0"),se(y,"margin-right","10px"),d(y,"class","svelte-18y7b0k"),d(q,"class","button-small svelte-18y7b0k"),d(i,"class","room svelte-18y7b0k"),se(i,"display","block"),d(l,"class","button svelte-18y7b0k"),d(N,"class","card__header svelte-18y7b0k"),d(M,"class","room-list svelte-18y7b0k"),d(t,"class","card svelte-18y7b0k"),se(a,"color","white")},m(E,z){te(E,t,z),X&&X.m(t,null),r(t,n),r(t,e),r(t,m),r(t,i),r(i,S),ge(S,s[3]),r(i,T),r(i,C),r(i,u),r(i,p),r(i,b),r(i,Y),r(i,P),r(i,v),ge(v,s[1]),r(i,H),r(i,j),r(j,y),ge(y,s[2]),r(j,D),r(j,q),r(t,h),r(t,A),r(A,l),r(t,w),r(t,N),r(t,$),r(t,M);for(let U=0;U<G.length;U+=1)G[U]&&G[U].m(M,null);te(E,x,z),te(E,a,z),k||(oe=[ae(S,"input",s[9]),ae(C,"click",s[8]),ae(v,"input",s[10]),ae(y,"input",s[11]),ae(q,"click",s[6]),ae(l,"click",s[5])],k=!0)},p(E,[z]){if(E[4]?X?X.p(E,z):(X=Xe(E),X.c(),X.m(t,n)):X&&(X.d(1),X=null),z&8&&S.value!==E[3]&&ge(S,E[3]),z&2&&v.value!==E[1]&&ge(v,E[1]),z&4&&$e(y.value)!==E[2]&&ge(y,E[2]),z&129){ue=ze(E[0]);let U;for(U=0;U<ue.length;U+=1){const le=Je(E,ue,U);G[U]?G[U].p(le,z):(G[U]=Ge(le),G[U].c(),G[U].m(M,null))}for(;U<G.length;U+=1)G[U].d(1);G.length=ue.length}},i:we,o:we,d(E){E&&(_(t),_(x),_(a)),X&&X.d(),tt(G,E),k=!1,Ce(oe)}}}function rt(s,t,n){let e,o,m;he(s,ce,h=>n(14,e=h)),he(s,K,h=>n(15,o=h)),he(s,re,h=>n(16,m=h));const i="http://localhost";let S=[],T="",C,I=e?.name??"",u="",p;Ie(()=>{console.log("Rooms page mounted"),K.subscribe(h=>{console.log("State changed",h),(h=m.connected)&&(console.log("User",e),e.room?e.room?.id?v(e.room):v({id:e.room}):b())})}),xe(()=>{u&&(clearTimeout(p),p=setTimeout(()=>{n(4,u="")},3e3))});async function b(){const A=await(await fetch(`${i}/list_room`)).json();console.log("resJson",A),A.status=="success"?A.rooms?n(0,S=A.rooms):(console.error("Failed to get rooms",A),n(4,u="Failed to get rooms")):(console.error("Failed to get rooms",A),n(4,u=A.message??"Failed to get rooms")),console.log("got rooms",S)}function Y(){b()}async function P(){if(!T||!C){console.error("Room name and ball speed are required"),n(4,u="Room name and ball speed are required");return}const h={name:T,width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:C,ballSpeedY:C},A=`${i}/create_room`;console.log("Creating room...",A,h),await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).then(l=>l.json()).then(l=>{console.log("create room",l),l.status=="success"&&l.room?.id?(console.log("Room created successfully, joining...",l.room),v(l.room)):(console.error("Failed to create room",l.message),n(4,u=l.message??"Failed to create room"))}).catch(l=>{console.error("Failed to create room",l),n(4,u=l.message??"Failed to create room")}),console.log("Room created successfully"),b()}async function v(h){console.log("Joining room...",h.id);const A=`${i}/join_room`,l={room_id:h.id,user_id:e.id};await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(c=>c.json()).then(c=>{console.log("joining room",c),c.status=="success"&&c.room?.id&&c.user?.id?(console.log("Joined room successfully"),F(ce,e=c.user,e),F(ce,e.room=c.room,e),console.log("User",e),H(h)):(console.error("Failed to join room",c),F(ce,e.room=null,e),n(4,u=c.message??"Failed to join room"),b())}).catch(c=>{console.error("Failed to join room",c),n(4,u=c.message??"Failed to join room")})}function H(h){console.log("Playing room...",h),F(K,o="play",o)}function j(){if(!I){console.error("Nickname is required"),n(4,u="Nickname is required");return}console.log("Renaming room...",T);const h=`${i}/login`,A={id:e.id,name:I};fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)}).then(l=>l.json()).then(l=>{console.log("rename user",l),l.status=="success"&&l.user?.id?(console.log("User renamed successfully"),F(ce,e=l.user,e)):(console.error("Failed to rename user",l),n(4,u=l.message??"Failed to rename user"))}).catch(l=>{console.error("Failed to rename user",l),n(4,u=l.message??"Failed to rename user")})}function y(){I=this.value,n(3,I)}function D(){T=this.value,n(1,T)}function q(){C=$e(this.value),n(2,C)}return[S,T,C,I,u,Y,P,v,j,y,D,q,h=>v(h)]}class at extends Re{constructor(t){super(),Ne(this,t,rt,lt,Ee,{})}}new TextEncoder;function it(s){let t,n,e,o,m=s[4]?.players?.[0]?.user?.name+"",i,S,T,C,I=s[4]?.players?.[0]?.wins+"",u,p,b,Y="PONG",P,v,H,j=(s[4]?.players?.[1]?.user?.name??"...")+"",y,D,q,R,h=(s[4]?.players?.[1]?.wins??0)+"",A,l,c,w,N,L,$,M,x=s[4]?.isRunning?"pause":"start",a,O,k,oe=s[2]?"hide":"show",X,ue,G,E,z="leave",U,le,ne,me,fe,_e,ye,Ae;return{c(){t=f("div"),n=f("div"),e=f("div"),o=f("h3"),i=Q(m),S=V(),T=f("p"),C=Q("Wins: "),u=Q(I),p=V(),b=f("h1"),b.textContent=Y,P=V(),v=f("div"),H=f("h3"),y=Q(j),D=V(),q=f("p"),R=Q("Wins: "),A=Q(h),l=V(),c=f("p"),w=f("canvas"),$=V(),M=f("button"),a=Q(x),O=V(),k=f("button"),X=Q(oe),ue=Q(" WS"),G=V(),E=f("button"),E.textContent=z,U=V(),le=f("p"),ne=f("canvas"),this.h()},l(ee){t=g(ee,"DIV",{style:!0,class:!0});var J=W(t);n=g(J,"DIV",{class:!0});var pe=W(n);e=g(pe,"DIV",{class:!0});var ve=W(e);o=g(ve,"H3",{});var De=W(o);i=Z(De,m),De.forEach(_),S=B(ve),T=g(ve,"P",{});var ke=W(T);C=Z(ke,"Wins: "),u=Z(ke,I),ke.forEach(_),ve.forEach(_),p=B(pe),b=g(pe,"H1",{class:!0,"data-svelte-h":!0}),de(b)!=="svelte-106hqp2"&&(b.textContent=Y),P=B(pe),v=g(pe,"DIV",{class:!0});var be=W(v);H=g(be,"H3",{});var Ue=W(H);y=Z(Ue,j),Ue.forEach(_),D=B(be),q=g(be,"P",{});var Se=W(q);R=Z(Se,"Wins: "),A=Z(Se,h),Se.forEach(_),be.forEach(_),pe.forEach(_),l=B(J),c=g(J,"P",{});var je=W(c);w=g(je,"CANVAS",{width:!0,height:!0,style:!0}),W(w).forEach(_),je.forEach(_),$=B(J),M=g(J,"BUTTON",{style:!0,class:!0});var Oe=W(M);a=Z(Oe,x),Oe.forEach(_),O=B(J),k=g(J,"BUTTON",{style:!0,class:!0});var Te=W(k);X=Z(Te,oe),ue=Z(Te," WS"),Te.forEach(_),G=B(J),E=g(J,"BUTTON",{style:!0,class:!0,"data-svelte-h":!0}),de(E)!=="svelte-1j2tb4n"&&(E.textContent=z),U=B(J),le=g(J,"P",{});var Le=W(le);ne=g(Le,"CANVAS",{width:!0,height:!0,style:!0}),W(ne).forEach(_),Le.forEach(_),J.forEach(_),this.h()},h(){d(e,"class","player1 svelte-1x1n3za"),d(b,"class","svelte-1x1n3za"),d(v,"class","player2 svelte-1x1n3za"),d(n,"class","scoreboard svelte-1x1n3za"),d(w,"width",N=s[3].width),d(w,"height",L=s[3].height),se(w,"background","black"),se(M,"margin-right","5px"),se(M,"margin-left","5px"),d(M,"class","svelte-1x1n3za"),se(k,"margin-right","5px"),se(k,"margin-left","5px"),d(k,"class","svelte-1x1n3za"),se(E,"margin-right","5px"),se(E,"margin-left","5px"),d(E,"class","svelte-1x1n3za"),ne.hidden=me=!s[2],d(ne,"width",fe=s[3].width),d(ne,"height",_e=s[3].height),se(ne,"background","black"),se(t,"width","800px"),d(t,"class","cent svelte-1x1n3za")},m(ee,J){te(ee,t,J),r(t,n),r(n,e),r(e,o),r(o,i),r(e,S),r(e,T),r(T,C),r(T,u),r(n,p),r(n,b),r(n,P),r(n,v),r(v,H),r(H,y),r(v,D),r(v,q),r(q,R),r(q,A),r(t,l),r(t,c),r(c,w),s[13](w),r(t,$),r(t,M),r(M,a),r(t,O),r(t,k),r(k,X),r(k,ue),r(t,G),r(t,E),r(t,U),r(t,le),r(le,ne),s[14](ne),ye||(Ae=[ae(w,"mousemove",s[5]),ae(M,"click",s[6]),ae(k,"click",s[8]),ae(E,"click",s[7])],ye=!0)},p(ee,[J]){J&16&&m!==(m=ee[4]?.players?.[0]?.user?.name+"")&&ie(i,m),J&16&&I!==(I=ee[4]?.players?.[0]?.wins+"")&&ie(u,I),J&16&&j!==(j=(ee[4]?.players?.[1]?.user?.name??"...")+"")&&ie(y,j),J&16&&h!==(h=(ee[4]?.players?.[1]?.wins??0)+"")&&ie(A,h),J&8&&N!==(N=ee[3].width)&&d(w,"width",N),J&8&&L!==(L=ee[3].height)&&d(w,"height",L),J&16&&x!==(x=ee[4]?.isRunning?"pause":"start")&&ie(a,x),J&4&&oe!==(oe=ee[2]?"hide":"show")&&ie(X,oe),J&4&&me!==(me=!ee[2])&&(ne.hidden=me),J&8&&fe!==(fe=ee[3].width)&&d(ne,"width",fe),J&8&&_e!==(_e=ee[3].height)&&d(ne,"height",_e)},i:we,o:we,d(ee){ee&&_(t),s[13](null),s[14](null),ye=!1,Ce(Ae)}}}function ct(s,t,n){let e,o,m;he(s,ce,a=>n(21,e=a)),he(s,re,a=>n(22,o=a)),he(s,K,a=>n(23,m=a));let i,S,T,C,I,u=!1;const p=1e3/30,b="http://localhost";let Y=0,P={name:"placeholder",width:800,height:400,paddleWidth:10,paddleHeight:100,ballRadius:10,ballSpeedX:10,ballSpeedY:10},v={ballX:Math.floor(P.width/2),ballY:Math.floor(P.height/2),players:[{paddleY:Math.floor(P.height/2),score:0,wins:0,user:{id:"",name:"",room:""}},{paddleY:Math.floor(P.height/2),score:0,wins:0,user:{id:"",name:"",room:""}}],isRunning:!1},H={...v},j={paddleY:Math.floor(P.height/2)};function y(){console.log("Initializing game"),T=i.getContext("2d"),C=S.getContext("2d"),c(T,v),c(C,H),l(),A()}function D(){const a=v.players.findIndex(O=>O.user.id==e.id);a>-1?Y=a:console.error("Player not found in game state",v.players,e.id)}function q(a){try{a.players[Y].paddleY=j.paddleY}catch(O){console.error("Error in converting state",O)}n(4,v={...a})}function R(a){n(3,P={...a})}function h(a){n(4,v.isRunning=a,v)}async function A(){for(;;){await new Promise(a=>setTimeout(a,p));try{if(v.isRunning)if(o.connected){let a=new Uint8Array(Uint16Array.of(j.paddleY).buffer),O=[1,a[0],a[1]];const k=Uint8Array.of(...O);o.wt.send(k)}else{console.error("Connection not ready");continue}}catch(a){console.error("Error in transmit loop",a)}}}function l(){try{c(T,v),c(C,H)}catch(a){console.error("Error in draw loop",a)}I=requestAnimationFrame(l)}function c(a,O){a.clearRect(0,0,i.width,i.height),a.fillStyle="white",a.beginPath(),a.arc(O.ballX,O.ballY,P.ballRadius,0,Math.PI*2),a.fill(),a.fillRect(0,O.players?.[0]?.paddleY,P.paddleWidth,P.paddleHeight),a.fillRect(i.width-P.paddleWidth,O.players?.[1]?.paddleY,P.paddleWidth,P.paddleHeight),a.strokeStyle="white",a.lineWidth=3,a.setLineDash([20,40]),a.beginPath(),a.moveTo(i.width/2,0),a.lineTo(i.width/2,i.height),a.stroke(),O.players&&O.players.length>0&&(a.fillStyle="white",a.font="bold 50px Arial",a.fillText(O.players[0]?.score?.toString()??"0",i.width/2-70,70,100),a.fillText(O.players[1]?.score?.toString()??"0",i.width/2+40,70,100)),O.isRunning||(a.fillStyle="white",a.font="bold 50px Arial",a.fillText("▐▐ ",20,80,200))}Ie(()=>{y()}),et(()=>{cancelAnimationFrame(I)});function w(a){const O=i.getBoundingClientRect(),k=a.clientY-O.top-P.paddleHeight/2,oe=Math.max(1,Math.min(i.height-P.paddleHeight,k));j.paddleY=oe,n(4,v.players[Y].paddleY=oe,v)}function N(){console.log(o),o.connected?o.wt.send_reliable(Uint8Array.of(2)):console.error("Connection not ready")}function L(){const a={room_id:e.room.id,user_id:e.id},O=`${b}/leave_room`;console.log("Leaving room...",a,O),fetch(O,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(k=>k.json()).then(k=>{k.status=="success"&&k.user?.id&&k.room?.id?(console.log("Leave room successful"),F(ce,e=k.user,e),F(K,m="harusnya mainmenu",m)):console.error("Failed to leave room",k)}).catch(k=>{console.error("Error in leave room request",k)})}o.addListener("wt",(a,O)=>{q(O)}),o.addListener("ws",(a,O)=>{H=O}),K.subscribe(a=>{a=="play"&&(R({name:e.room.name,width:e.room.width,height:e.room.height,paddleWidth:e.room.paddleWidth,paddleHeight:e.room.paddleHeight,ballRadius:e.room.ballRadius,ballSpeedX:e.room.ballSpeedX,ballSpeedY:e.room.ballSpeedY}),q(e.room.gameState),D())});function $(){n(2,u=!u)}function M(a){Pe[a?"unshift":"push"](()=>{i=a,n(0,i)})}function x(a){Pe[a?"unshift":"push"](()=>{S=a,n(1,S)})}return[i,S,u,P,v,w,N,L,$,D,q,R,h,M,x]}class ut extends Re{constructor(t){super(),Ne(this,t,ct,it,Ee,{setPlayerSide:9,setState:10,setRoomConfig:11,setRunning:12})}get setPlayerSide(){return this.$$.ctx[9]}get setState(){return this.$$.ctx[10]}get setRoomConfig(){return this.$$.ctx[11]}get setRunning(){return this.$$.ctx[12]}}const dt=globalThis.__sveltekit_12hd98f.env??(await ot(()=>import(globalThis.__sveltekit_12hd98f.base+"/_app/env.js"),__vite__mapDeps([]),import.meta.url)).env;function ht(s){let t,n;return{c(){t=f("h2"),n=Q(s[3])},l(e){t=g(e,"H2",{});var o=W(t);n=Z(o,s[3]),o.forEach(_)},m(e,o){te(e,t,o),r(t,n)},p(e,o){o&8&&ie(n,e[3])},d(e){e&&_(t)}}}function ft(s){let t,n="username",e,o,m,i,S,T,C,I,u=s[2]&&Ke(s);return{c(){t=f("h1"),t.textContent=n,e=V(),o=f("input"),m=V(),i=f("input"),S=V(),u&&u.c(),T=Me(),this.h()},l(p){t=g(p,"H1",{class:!0,"data-svelte-h":!0}),de(t)!=="svelte-18bhqtc"&&(t.textContent=n),e=B(p),o=g(p,"INPUT",{type:!0,placeholder:!0,autocomplete:!0,spellcheck:!0,maxlength:!0,class:!0}),m=B(p),i=g(p,"INPUT",{type:!0,class:!0}),S=B(p),u&&u.l(p),T=Me(),this.h()},h(){d(t,"class","svelte-1264fyt"),d(o,"type","text"),d(o,"placeholder","your nickname"),d(o,"autocomplete","off"),d(o,"spellcheck","false"),d(o,"maxlength","20"),d(o,"class","svelte-1264fyt"),d(i,"type","submit"),i.value="Enter",d(i,"class","svelte-1264fyt")},m(p,b){te(p,t,b),te(p,e,b),te(p,o,b),ge(o,s[1]),te(p,m,b),te(p,i,b),te(p,S,b),u&&u.m(p,b),te(p,T,b),C||(I=[ae(o,"input",s[5]),ae(i,"click",s[4])],C=!0)},p(p,b){b&2&&o.value!==p[1]&&ge(o,p[1]),p[2]?u?u.p(p,b):(u=Ke(p),u.c(),u.m(T.parentNode,T)):u&&(u.d(1),u=null)},d(p){p&&(_(t),_(e),_(o),_(m),_(i),_(S),_(T)),u&&u.d(p),C=!1,Ce(I)}}}function Ke(s){let t,n,e;return{c(){t=f("div"),n=f("p"),e=Q(s[2]),this.h()},l(o){t=g(o,"DIV",{class:!0});var m=W(t);n=g(m,"P",{});var i=W(n);e=Z(i,s[2]),i.forEach(_),m.forEach(_),this.h()},h(){d(t,"class","error-message svelte-1264fyt")},m(o,m){te(o,t,m),r(t,n),r(n,e)},p(o,m){m&4&&ie(e,o[2])},d(o){o&&_(t)}}}function gt(s){let t,n,e,o,m,i,S,T,C,I,u,p,b,Y,P,v,H;function j(R,h){if(R[3]==="idle")return ft;if(R[3]!=="harusnya mainmenu"&&R[3]!=="play")return ht}let y=j(s),D=y&&y(s);u=new at({});let q={};return P=new ut({props:q}),s[6](P),{c(){t=f("body"),n=f("div"),e=f("p"),o=Q("state = "),m=Q(s[3]),i=V(),S=f("div"),D&&D.c(),T=V(),C=f("div"),I=f("div"),Ve(u.$$.fragment),b=V(),Y=f("div"),Ve(P.$$.fragment),this.h()},l(R){t=g(R,"BODY",{class:!0});var h=W(t);n=g(h,"DIV",{});var A=W(n);e=g(A,"P",{});var l=W(e);o=Z(l,"state = "),m=Z(l,s[3]),l.forEach(_),A.forEach(_),i=B(h),S=g(h,"DIV",{class:!0});var c=W(S);D&&D.l(c),c.forEach(_),T=B(h),C=g(h,"DIV",{});var w=W(C);I=g(w,"DIV",{class:!0});var N=W(I);Be(u.$$.fragment,N),N.forEach(_),w.forEach(_),b=B(h),Y=g(h,"DIV",{});var L=W(Y);Be(P.$$.fragment,L),L.forEach(_),h.forEach(_),this.h()},h(){d(S,"class","cent svelte-1264fyt"),d(I,"class","cent svelte-1264fyt"),C.hidden=p=s[3]!=="harusnya mainmenu",Y.hidden=v=s[3]!=="play",d(t,"class","svelte-1264fyt")},m(R,h){te(R,t,h),r(t,n),r(n,e),r(e,o),r(e,m),r(t,i),r(t,S),D&&D.m(S,null),r(t,T),r(t,C),r(C,I),Fe(u,I,null),r(t,b),r(t,Y),Fe(P,Y,null),H=!0},p(R,[h]){(!H||h&8)&&ie(m,R[3]),y===(y=j(R))&&D?D.p(R,h):(D&&D.d(1),D=y&&y(R),D&&(D.c(),D.m(S,null))),(!H||h&8&&p!==(p=R[3]!=="harusnya mainmenu"))&&(C.hidden=p);const A={};P.$set(A),(!H||h&8&&v!==(v=R[3]!=="play"))&&(Y.hidden=v)},i(R){H||(Ye(u.$$.fragment,R),Ye(P.$$.fragment,R),H=!0)},o(R){He(u.$$.fragment,R),He(P.$$.fragment,R),H=!1},d(R){R&&_(t),D&&D.d(),qe(u),s[6](null),qe(P)}}}async function Qe(s){console.log("waiting for registration...",s);const t=5e3,n=new Promise((o,m)=>{const i=setInterval(()=>{s.register_status==="registered"&&(clearInterval(i),o())},100)}),e=new Promise((o,m)=>{setTimeout(()=>{m(new Error("Registration timeout"))},t)});return await Promise.race([n,e]).then(()=>(console.log("Registered successfully",s),!0)).catch(o=>!1)}function Ze(s){const n=new TextDecoder("utf-8").decode(s);return JSON.parse(n)}function mt(s){return new Promise(t=>setTimeout(t,s))}function pt(s,t,n){let e,o,m;he(s,re,l=>n(9,e=l)),he(s,K,l=>n(3,o=l)),he(s,ce,l=>n(10,m=l));let i;const S=dt.PUBLIC_API,T="https://localhost:4433",C="http://localhost";let I="",u=null;F(K,o="idle",o);let p="",b;Ie(()=>{console.log("mounted"),u=localStorage.getItem("id_user"),console.log("saved id_user",u),u&&Y(),ce.subscribe(l=>{console.log("user changed",l)})}),xe(()=>{p&&(clearTimeout(b),b=setTimeout(()=>{n(2,p="")},3e3))});function Y(){if(!I&&!u){n(2,p="Please enter your nickname");return}const l=`${S}/login`;u=localStorage.getItem("id_user"),console.log(`logging in... name=${I} id=${u} host=${l}`);const c={name:I,id:u??void 0};F(K,o="logging in",o),fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then(w=>{if(!w.ok)throw new Error("Network response was not ok");return w.json()}).then(w=>{console.log("logged in with user",w),w.code==200?(F(K,o="connecting transport",o),ce.set(w.user),D().then(()=>{localStorage.setItem("id_user",m.id)}).catch(N=>{console.error(N),F(K,o="idle",o)})):(n(2,p=w.message??"Error logging in"),localStorage.clear("id_user"),u=null,ce.set(null),F(K,o="idle",o))}).catch(w=>{n(2,p=w.message??"Error logging in"),console.error(w),F(K,o="idle",o)})}async function P(){if(console.log("connecting transport..."),F(K,o="connecting webTransport",o),await q()){if(console.log("connected webtransport"),F(K,o="registering webTransport",o),!await v())return console.log("failed to register webTransport"),1}else return console.log("failed to connect webtransport"),0;if(console.log("Registered webTransport"),F(K,o="connecting webSocket",o),await R()){if(console.log("connected webSocket"),F(K,o="registering webSocket",o),!await H())return console.log("failed to register webSocket"),1}else return console.log("failed to connect webSocket"),0;return F(re,e.connected=!0,e),F(K,o="harusnya mainmenu",o),2}async function v(){return console.log("registering webtransport..."),await e.wt.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(m.id))),F(re,e.wt.register_status="registering",e),await Qe(e.wt)}async function H(){return console.log("registering websocket..."),await e.ws.send_reliable(Uint8Array.of(0,...new TextEncoder().encode(m.id))),F(re,e.ws.register_status="registering",e),await Qe(e.ws)}F(re,e.addListener=(l,c)=>{e[l+"_listeners"]==null&&F(re,e[l+"_listeners"]=[],e);const w=e[l+"_listeners"].length;return e[l+"_listeners"].push(c),w},e),F(re,e.removeListener=(l,c)=>{F(re,e[l+"_listeners"]=null,e)},e);function j(l,c){console.log("handling message",c),l.register_status==="registering"&&(l.register_status="registered",console.log("register messsage received",l)),e[l.protocol+"_listeners"].forEach(w=>{try{w&&w(l,c)}catch(N){console.error("Error calling listener",N)}})}async function y(l){if(e.connected){console.log("handling disconnect",l);try{delete e[l?.protocol],delete e.ws}catch(c){console.log("error deleting transport",c)}F(re,e.connected=!1,e),await D()}}async function D(){for(console.log("reconnecting..."),F(K,o="reconnecting",o);;){console.log("reconnecting...");const l=await P();if(l===2||l===1){l===1?(console.log("reconnected, but failed registering"),window.location.href="/"):console.log("reconnected"),F(K,o="harusnya mainmenu",o);break}console.log("reconnecting again in 3 sec..."),await mt(3e3)}}async function q(){const l=`${T}/wt`,c=new WebTransport(l);if(c.closed.then(()=>{console.log("WebTransport closed",c),y(c)}).catch(k=>{console.error("WebTransport $connection died:",k,c),y(c)}),console.log("webtransport connecting...",l),!await c.ready.then(()=>(console.log("WebTransport connected",c),!0)).catch(k=>(console.error("WebTransport $connection failed:",k),!1)))return!1;const N={protocol:"wt",register_status:"unregistered",transport:c,isReading:!1},L=N.transport.datagrams,$=L.writable.getWriter(),M=L.readable.getReader();N.send=k=>{$.write(k)},async function(){for(;;){const{value:k,done:oe}=await M.read();if(oe){console.log("Done reading datagram, stop reading...",value);return}j(N,Ze(k))}}().catch(k=>{console.error("reading datagram failed, stop reading...:",k)});const x=await c.createBidirectionalStream(),a=x.writable.getWriter(),O=x.readable.getReader();return N.send_reliable=k=>{a.write(k)},async function(){for(;;){const{value:k,done:oe}=await O.read();if(oe){console.log("Done reading stream, stop reading...",value);return}j(N,Ze(k))}}().catch(k=>{console.error("reading datagram failed, stop reading...:",k)}),F(re,e.wt=N,e),!0}async function R(){const l=`${C}/ws`,c=new WebSocket(l);if(console.log("websocket connecting...",l),!await new Promise((L,$)=>{c.onopen=()=>{console.log(c,"WebSocket connected"),L(!0)},c.onerror_message=M=>{console.error("WebSocket error:",M),$(M)}}).catch(L=>(console.error("WebSocket $connection failed:",L),!1)))return!1;const N={protocol:"ws",register_status:"unregistered",transport:c,isReading:!1};return N.send=L=>{N.transport.send(L)},N.send_reliable=L=>{N.transport.send(L)},c.addEventListener("message",L=>{j(N,JSON.parse(L.data))}),c.addEventListener("close",L=>{L.wasClean?console.log("WebSocket closed",L):console.error("WebSocket $connection died",L)}),F(re,e.ws=N,e),!0}function h(){I=this.value,n(1,I)}function A(l){Pe[l?"unshift":"push"](()=>{i=l,n(0,i)})}return[i,I,p,o,Y,h,A]}class yt extends Re{constructor(t){super(),Ne(this,t,pt,gt,Ee,{})}}export{yt as component};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}